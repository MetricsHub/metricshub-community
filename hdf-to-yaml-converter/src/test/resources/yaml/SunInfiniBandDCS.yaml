---
translations:
  LinkStateTranslationTable:
    "1": degraded
    "2": ok
    default: ""
    "3": ok
    "4": ok
  SpeedTranslationTable:
    "1": 2500
    "2": 5000
    default: ""
    "4": 10000
    "8": 30000
  WidthActiveTranslationTable:
    "1": IB Port 1x
    "2": IB Port 4x
    default: ""
    "4": IB Port 8x
    "8": IB Port 12x
connector:
  displayName: Oracle/Sun InfiniBand DCS Switch (Ports)
  platforms: Oracle/Sun Infiniband DCS
  reliesOn: Oracle/Sun ILOM SNMP Agent
  version: 1.0
  information: This connector provides hardware monitoring for Oracle/Sun InfiniBand DCS switches via SNMP
  detection:
    connectionTypes:
    - remote
    appliesTo:
    - Storage
    - Network
    criteria:
    # Need a DCS Ports OID
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
monitors:
  network:
    discovery:
      sources:
        source(1):
          # Source(1) = ibSmaPortInfoEntry SNMP Table
          # PortID;WidthActive;PhysState;Speed;
          type: snmpTable
          oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
          selectColumns: "ID,5,7,10"
          computes:
            # Translate WidthActive
            # PortID;WidthActive;PhysState;Speed;
          - type: translate
            column: 2
            translationTable: WidthActiveTranslationTable
            # Exclude disabled ports
            # PortID;WidthActive;PhysState;Speed;
          - type: excludeMatchingLines
            column: 3
            valueList: 3
            # Translate Speed
            # PortID;WidthActive;PhysState;Speed;
          - type: translate
            column: 4
            translationTable: SpeedTranslationTable
      mapping:
        # Instance Table
        # PortID;WidthActive;PhysState;Speed;
        source: $monitors.network.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          __display_id: $column(1)
          device_type: $column(2)
          hw.parent.type: enclosure
          name: "sprintf(\"%s (%s)\", $column(1), $column(2))"
    collect:
      # Collect type = multi-instance
      type: multiInstance
      sources:
        source(1):
          # Source(1) = ibSmaPortInfoEntry SNMP Table
          # PortID;WidthActive;LinkState;Speed;
          type: snmpTable
          oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
          selectColumns: "ID,5,6,10"
          computes:
            # Need to Add ibPmaExtPortCntrsEntry  and  ibPmaPortCntrsTable when SNMP v2 is available.
            # Translate Speed
            # PortID;WidthActive;LinkState;Speed;
          - type: translate
            column: 4
            translationTable: SpeedTranslationTable
            # Translate LinkState
            # PortID;WidthActive;LinkState;Speed;
          - type: translate
            column: 3
            translationTable: LinkStateTranslationTable
      mapping:
        # ValueTable
        # PortID;WidthActive;LinkState;Speed;
        source: $monitors.network.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.network.up: legacyLinkStatus($column(3))
          hw.network.bandwidth.limit: megaBit2Bit($column(4))
