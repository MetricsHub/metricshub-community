---
extends:
- "EMCIsilon-header"
constants:
  _IsiDevicesCommand: "/usr/bin/isi devices drive list"
  _IsiDrivesCommand: "/usr/bin/isi devices drive list"
  _IsiNetworkCommand: "/usr/bin/isi network interfaces list --verbose --show-inactive"
  _IsiBatteryCommand: "/usr/bin/isi batterystatus list"
  _IsiStatusCommand: "/usr/bin/isi status -v"
embedded:
  EmbeddedFile(3): "{nodeName = $1 ; gsub (/:/,\"\",nodeName);}\nNF > 7 {\n\tif ($0 ~ /.*[Rr]eady, [Ee]nabled, and [Ff]ully [Cc]harged.*/)\n          {\n          \tprint \"MSHW_BATTERY;\" nodeName \";\" nodeName\"-\"$2 \";\" nodeName\"-\"$2 \";\"\"Ready-enabled-fully charged\"\";\"\"Ready-enabled-fully charged\"\";\"\n  \t\t\t\t}\n  else\n  \t\tprint \"MSHW_BATTERY;\" nodeName \";\" nodeName\"-\"$2 \";\" nodeName\"-\"$2 \";\" $3\"-\"$5\";\"$3\"-\"$5\";\"\n\n\t}"
  EmbeddedFile(5): "{nodeName = $1 ; gsub (/:/,\"\",nodeName);}\n\n$3 ~ /^Bay$/  {\n  nodeNumber = $2 ; nodeArray[nodeNumber] = nodeName ;\n  Location = $4 ; Location = \"Bay-\" Location\n\tLnum = $6 ; Lnum = \"Lnum-\" Lnum\n\tStatus = $7 ; gsub(/\\].*$/,\"\",Status);gsub(/^.*\\[/,\"\",Status);\n\tSerialNumber = $8 ; gsub (/^SN:/,\"\",SerialNumber)\n\tif ( Status != \"EMPTY\" ) {\n\t  print \"MSHW_PhysicalDisk;\" nodeName \";\" nodeName \"-\" Location \";\" Location \";\" Lnum \";\" SerialNumber \";\" Status \";\" Status \";\"\n\t  }\n\t}\nEND {\n  for (nodeNumber in nodeArray) {\n    print \"MSHW_Node;\" nodeArray[nodeNumber] \";\" nodeNumber \";\"\n    }\n  }"
  EmbeddedFile(6): "$1 ~ /^IP/ && $2 ~ /Addresses/ {IPAddress = $NF}\n$1 ~ /^LNN/ {NodeNumber = $NF}\n$1 ~ /^Name/ {Interface = $NF }\n$1 ~ /^NIC/ && $2 ~ /Name/ {NICName = $NF}\n$1 ~ /^Status/ {Status = $0 ; gsub (/^.*Status: /,\"\",Status) ; gsub (/ +$/,\"\",Status)\n\t                          print \"MSHW;\" NodeNumber \";\" NICName \";\" NICName \";\" Interface \";\" IPAddress \";\" Status \";\"\n\t                          }"
  EmbeddedFile(9): "BEGIN {FS=\"\\\"\";}\n{\n\tprint $1 $3;\n}"
connector:
  displayName: "EMC Isilon 8 (SSH)"
  platforms: "EMC Isilon"
  reliesOn: "EMC Isilon SSH interface"
  version: "1.0"
  information: "This connector discovers the status of an EMC Isilon Storage Cluster 8"
  detection:
    connectionTypes:
    - "remote"
    appliesTo:
    - "Storage"
    criteria:
      # Check that sudo is working by running /usr/bin/isi status -v
    - type: "osCommand"
      commandLine: "/bin/zsh -c \"%{SUDO:/usr/bin/isi_for_array} /usr/bin/isi_for_array /usr/bin/isi status -v\" "
      errorMessage: "Unable to run /usr/bin/isi status -v.  Check rights / sudo status."
      expectedResult: "Cluster Name:"
