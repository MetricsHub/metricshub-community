---
connector:
  displayName: HP Insight Management Agent (v8.20 or lower) - Memory
  platforms: HP ProLiant
  reliesOn: HP Insight Management Agents
  version: 1.4
  information: This connector provides Memory Information through the HP Insight Manager (Older Server Agents).
  detection:
    connectionTypes:
    - remote
    - local
    appliesTo:
    - NT
    - Linux
    - OSF1
    - VMS
    - OOB
    - Solaris
    criteria:
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.232.2.2.4.5.1
monitors:
  memory:
    discovery:
      sources:
        source(1):
          # Memory discovery
          # ID;Size;Type;Technology;SerialNo
          type: snmpTable
          oid: 1.3.6.1.4.1.232.2.2.4.5.1
          selectColumns: "ID,3,4,6,10"
          computes:
          # Remove modules for which we have no size (means they don't exist)
          - type: excludeMatchingLines
            column: 2
            regExp: ^0$
          # Convert size to MB
          - type: divide
            column: 2
            value: 1024
          # Translate memory type
          - type: translate
            column: 3
            translationTable: "${translation::memoryTypeTranslationTable}"
          # Translate memory technology
          - type: translate
            column: 4
            translationTable: "${translation::memoryTechnologyTranslationTable}"
          # Concat type and technology
          - type: rightConcat
            column: 3
            value: $4
      mapping:
        source: "${source::monitors.memory.discovery.sources.source(1)}"
        attributes:
          id: $1
          type: $3
          serial_number: $5
          hw.parent.type: enclosure
          name: "${awk::sprintf(\"%s (%s - %s MB)\", $1, $3, $2)}"
        metrics:
          hw.memory.limit: mebiByte2Byte($2)
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = The cpqSiMemModuleTable (for older HP ProLiant systems)
          # DeviceID;ECCStatus
          type: snmpTable
          oid: 1.3.6.1.4.1.232.2.2.4.5.1
          selectColumns: "ID,11"
          computes:
            # Duplicate ECCStatus
            # DeviceID;ECCStatus;ECCStatus
          - type: duplicateColumn
            column: 2
            # Translate first ECCStatus into a PATROL Status
            # DeviceID;PATROLStatus;ECCStatus
          - type: translate
            column: 2
            translationTable: "${translation::memoryECCStatusTranslationTable}"
            # Translate second ECCStatus into a more readable string
            # DeviceID;PATROLStatus;statusInformation
          - type: translate
            column: 3
            translationTable: "${translation::memoryECCStatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        # DeviceID;PATROLStatus;statusInformation
        source: "${source::monitors.memory.collect.sources.source(1)}"
        deviceId: $1
        metrics:
          hw.status{hw.type="memory"}: $2
        legacyTextParameters:
          StatusInformation: $3
translations:
  memoryECCStatusTranslationTable:
    "0": ok
    "1": ok
    "2": ok
    "3": degraded
    "4": degraded
    Default: UNKNOWN
  memoryTypeTranslationTable:
    "11": 'SRIMM '
    "12": 'FB-DIMM '
    "13": 'DIMM-DDR '
    "14": 'DIMM-DDR2 '
    "15": 'DIMM-DDR3 '
    "16": 'DIMM-FBD2 '
    "17": 'FB-DIMM-DDR2 '
    "18": 'FB-DIMM-DDR3 '
    "1": ""
    "2": 'Board '
    "3": 'Single-width '
    "4": 'Double-width '
    "5": 'SIMM '
    "6": 'PCMCIA '
    "7": 'Compaq-specific '
    "8": 'DIMM '
    "9": 'DIMM (small outline) '
    "10": 'RIMM '
  memoryECCStatusInformationTranslationTable:
    "0": ""
    "1": ""
    "2": ""
    "3": Too many ECC errors
    "4": Too many ECC errors
    Default: Unknown Status
  memoryTechnologyTranslationTable:
    "1": ""
    "2": Fast-page
    "3": EDO
    "4": Burst-EDO
    "5": Synchronous
    "6": RDRAM
