---
connector:
  displayName: Huawei Storage System (OceanStor)
  platforms: Huawei OceanStor
  reliesOn: Huawei Storage System SNMP Agent
  version: 1.0
  information: "This connector discovers the enclosure(s) and the disks of Huawei Storage Systems as well as the various environment sensors (temperatures, fans, power supplies). It relies on the SNMP protocol."
  detection:
    connectionTypes:
    - remote
    appliesTo:
    - Storage
    criteria:
    # Verify that there is a Huawei Storage System
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.34774.4.1.23.5.6.1
monitors:
  enclosure:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoEnclosureEntry
          # ID,Name,Role,Type,SerialNumber
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.6.1
          selectColumns: "ID,2,3,7,9"
          computes:
            # Translate the Role
            # ID,Name,Role,Type,SerialNumber
          - type: translate
            column: 3
            translationTable: "${translation::RoleTranslationTable}"
            # Translate the Type
            # ID,Name,Role,Type,SerialNumber
          - type: translate
            column: 4
            translationTable: "${translation::TypeTranslationTable}"
          - type: leftConcat
            column: 4
            value: "Role: "
      mapping:
        # Instance Table
        # ID,Name,Role,Type,SerialNumber
        source: "${source::monitors.enclosure.discovery.sources.source(1)}"
        attributes:
          id: $2
          __display_id: $2
          vendor: Huawei
          model: $3
          serial_number: $5
          info: $4
          name: "${awk::sprintf(\"Enclosure: %s (%s %s)\", $2, \"Huawei\", $3)}"
    collect:
      # Collect type is mono-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoEnclosureEntry
          # Name,Status
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.6.1
          selectColumns: "2,4"
          computes:
            # Duplicate the Status column
            # Name;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Name;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # Name;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # Value Table
        # Name;PATROLStatus;StatusInformation;
        source: "${source::monitors.enclosure.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="enclosure"}: $2
        legacyTextParameters:
          StatusInformation: $3
  physical_disk:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.1.1
          selectColumns: "4,5,6,7,8,12,13,14,15,18"
          computes:
            # Convert Size from Mbytes to Bytes
            # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: multiply
            column: 3
            value: 1048576
            # Translate the Role
            # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: translate
            column: 4
            translationTable: "${translation::DiskRoleTranslationTable}"
            # Translate the DiskType
            # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: translate
            column: 4
            translationTable: "${translation::DiskTypeTranslationTable}"
            # Add "Speed: " to the Speed
            # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: leftConcat
            column: 5
            value: "Speed: "
            # Add "Logical Disk: " to the Speed
            # Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: leftConcat
            column: 10
            value: "Logical Disk: "
            # Duplicate the Location
            # Location;Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
          - type: leftConcat
            column: 4
            value: "Type: "
      mapping:
        # InstanceTable = Source(1)
        #     1        2        #  3       4         5    6     7     8       9      10         11       12
        # Enclosure;Location;DisplayID;DiskType;Capacity;Role;Speed;Model;Firmware;Vendor;SerialNumber;LogicalDiskName;
        source: "${source::monitors.physical_disk.discovery.sources.source(1)}"
        attributes:
          id: $2
          __display_id: $3
          model: $8
          serial_number: $11
          firmware_version: $9
          vendor: $10
          info: "${awk::join(\" \", $6, $7, $12)}"
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: "${awk::sprintf(\"%s (%s - %s)\", $3, $10, bytes2HumanFormatBase10($5))}"
        metrics:
          hw.physical_disk.size: $5
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.1.1
          selectColumns: "4,2"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.physical_disk.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="physical_disk"}: $2
        legacyTextParameters:
          StatusInformation: $3
  power_supply:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Vendor;Model;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.3.1
          selectColumns: "2,6,7"
          computes:
            # Duplicate the Location
            # Location;Location;Vendor;Model;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;Vendor;Model;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;Vendor;Model;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;Vendor;Model;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;Vendor;Model;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;Vendor;Model;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
          - type: leftConcat
            column: 4
            value: "Vendor: "
          - type: leftConcat
            column: 5
            value: "Model: "
      mapping:
        # InstanceTable = Source(1)
        # Enclosure;Location;DisplayID;Vendor;Model;
        source: "${source::monitors.power_supply.discovery.sources.source(1)}"
        attributes:
          id: $2
          __display_id: $3
          info: "${awk::join(\" \", $4, $5)}"
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: $3
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.3.1
          selectColumns: "2,3"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.power_supply.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="power_supply"}: $2
        legacyTextParameters:
          StatusInformation: $3
  other_device:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoControllerTable
          # Location;Role;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.2.1
          selectColumns: "5,6"
          computes:
            # Translate the Role
            # Location;Role;
          - type: translate
            column: 2
            translationTable: "${translation::ControllerRoleTranslationTable}"
            # Specify the Type
            # Location;Role;Type;
          - type: rightConcat
            column: 2
            value: ;Controller
        source(2):
          # Source(2) = hwInfoInterfaceModuleTable
          # Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.13.1
          selectColumns: 2
          computes:
            # Specify the Type and add a blank Role
            # Location;Role;Type;
          - type: rightConcat
            column: 1
            value: ;;Interface Module
        source(3):
          # Source(3) = hwInfoExpBoardTable
          # Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.14.1
          selectColumns: 2
          computes:
            # Specify the Type and add a blank Role
            # Location;Role;Type;
          - type: rightConcat
            column: 1
            value: ;;Expansion Board
        source(4):
          # Union 1,2 and 3
          # Location;Role;Type;
          type: tableUnion
          tables:
          - "${source::monitors.other_device.discovery.sources.source(1)}"
          - "${source::monitors.other_device.discovery.sources.source(2)}"
          - "${source::monitors.other_device.discovery.sources.source(3)}"
          computes:
            # Duplicate the Location
            # Location;Role;Type;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;Role;Type;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;Role;Type;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;;Role;Type;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;Role;Type;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;Role;Type;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
          - type: leftConcat
            column: 4
            value: "Role: "
      mapping:
        # InstanceTable = Source(1)
        # Enclosure;Location;DisplayID;Role;Type;
        source: "${source::monitors.other_device.discovery.sources.source(4)}"
        attributes:
          id: $2
          device_type: $5
          __display_id: $3
          info: $4
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: "${awk::sprintf(\"%s: %s\", $5, $3)}"
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoControllerTable
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.2.1
          selectColumns: "5,2"
        source(2):
          # Source(2) = hwInfoInterfaceModuleTable
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.13.1
          selectColumns: "2,3"
        source(3):
          # Source(3) = hwInfoExpBoardTable
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.14.1
          selectColumns: "2,3"
        source(4):
          # Union 1,2 and 3
          # Location;Status;
          type: tableUnion
          tables:
          - "${source::monitors.other_device.collect.sources.source(1)}"
          - "${source::monitors.other_device.collect.sources.source(2)}"
          - "${source::monitors.other_device.collect.sources.source(3)}"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.other_device.collect.sources.source(4)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="other_device"}: $2
        legacyTextParameters:
          StatusInformation: $3
  fan:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.4.1
          selectColumns: 2
          computes:
            # Duplicate the Location
            # Location;Location;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
      mapping:
        # InstanceTable = Source(1)
        # Enclosure;Location;DisplayID;
        source: "${source::monitors.fan.discovery.sources.source(1)}"
        attributes:
          id: $2
          __display_id: $3
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: $3
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.4.1
          selectColumns: "2,3"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.fan.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="fan"}: $2
        legacyTextParameters:
          StatusInformation: $3
  battery:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.5.1
          selectColumns: 2
          computes:
            # Duplicate the Location
            # Location;Location;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
      mapping:
        # InstanceTable = Source(1)
        # Enclosure;Location;DisplayID;
        source: "${source::monitors.battery.discovery.sources.source(1)}"
        attributes:
          id: $2
          __display_id: $3
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: $3
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.5.5.1
          selectColumns: "2,3"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.battery.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="battery"}: $2
        legacyTextParameters:
          StatusInformation: $3
  logical_disk:
    discovery:
      sources:
        source(1):
          # Source(1) = hwInfoDiskDomainEntry
          # Name;Capacity;Free;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.1.1
          selectColumns: "2,5,6"
          computes:
            # Specify the Type
            # Name;Capacity;Free;Type;
          - type: rightConcat
            column: 3
            value: ;DiskDomain
        source(2):
          # Source(2) = hwInfoStoragePoolTable
          # Name;Capacity;Free;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.2.1
          selectColumns: "2,5,9"
          computes:
            # Specify the Type
            # Name;Capacity;Free;Type;
          - type: rightConcat
            column: 3
            value: ;Storage Pool
        source(3):
          # Source(3) = hwInfoStorageTierTable
          # Name;Capacity;Free;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.3.1
          selectColumns: 2
          computes:
            # Specify the Type
            # Name;Capacity;Free;Type;
          - type: rightConcat
            column: 1
            value: ;Storage Tier
        source(4):
          # Union 1,2 and 3
          # Name;Capacity;Free;Type;
          type: tableUnion
          tables:
          - "${source::monitors.logical_disk.discovery.sources.source(1)}"
          - "${source::monitors.logical_disk.discovery.sources.source(2)}"
          - "${source::monitors.logical_disk.discovery.sources.source(3)}"
          computes:
            # Convert Size from Mbytes to Bytes
            # Name;Capacity;Free;Type;
          - type: multiply
            column: 2
            value: 1048576
          - type: leftConcat
            column: 4
            value: "Type: "
      mapping:
        # InstanceTable = Source(1)
        # Name;Capacity;Free;Type;
        source: "${source::monitors.logical_disk.discovery.sources.source(4)}"
        attributes:
          id: $1
          __display_id: $1
          info: $4
          hw.parent.type: enclosure
          hw.parent.id: CTE0
          name: "${awk::sprintf(\"%s (%s)\", $1, bytes2HumanFormatBase2($2))}"
        metrics:
          hw.logical_disk.limit: $2
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskDomainEntry
          # Location;Status;FreeSpace;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.1.1
          selectColumns: "2,3,6"
        source(2):
          # Source(2) = hwInfoStoragePoolTable
          # Location;Status;FreeSpace;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.2.1
          selectColumns: "2,5,9"
        source(3):
          # Source(3) = hwInfoStorageTierTable
          # Location;Status;FreeSpace;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.23.4.3.1
          selectColumns: "2,4,8"
        source(4):
          # Union 1,2 and 3
          # Location;Status;FreeSpace;
          type: tableUnion
          tables:
          - "${source::monitors.logical_disk.collect.sources.source(1)}"
          - "${source::monitors.logical_disk.collect.sources.source(2)}"
          - "${source::monitors.logical_disk.collect.sources.source(3)}"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;FreeSpace;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;FreeSpace;
          - type: translate
            column: 2
            translationTable: "${translation::StatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;FreeSpace;
          - type: translate
            column: 3
            translationTable: "${translation::StatusInformationTranslationTable}"
            # Convert Size from Mbytes to Bytes
            # DiskID;PATROLStatus;StatusInformation;FreeSpace;
          - type: multiply
            column: 4
            value: 1048576
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.logical_disk.collect.sources.source(4)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="logical_disk"}: $2
          hw.logical_disk.usage{state="free"}: $4
          hw.logical_disk.usage{state="used"}: collectAllocatedSpace()
        legacyTextParameters:
          StatusInformation: $3
  network:
    discovery:
      sources:
        source(1):
          # Source(1) = hwStorageFrontEndHostPortEntry
          # Location;PhysicalAddress;Type;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.19.8.11.1
          selectColumns: "5,4,2,3"
          computes:
            # Duplicate the Location
            # Location;Location;PhysicalAddress;Type;Status;
          - type: duplicateColumn
            column: 1
            # Extract the Enclosure from the Location
            # Enclosure;Location;PhysicalAddress;Type;Status;
          - type: extract
            column: 1
            subColumn: 1
            subSeparators: .
            # Duplicate the Location
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;Status;
          - type: duplicateColumn
            column: 2
            # Add a dot to the Enclosure
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;Status;
          - type: rightConcat
            column: 1
            value: .
            # Remove the Enclosure from the displayid
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;Status;
          - type: replace
            column: 3
            existingValue: $1
            newValue: ""
            # Remove the dot from the enclosure
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;Status;
          - type: replace
            column: 1
            existingValue: .
            newValue: ""
            # Duplicate the Type
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;Type;Status;
          - type: duplicateColumn
            column: 5
            # Translate the Type
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;AddressType;Status;
          - type: translate
            column: 5
            translationTable: "${translation::PortTypeTranslationTable}"
            # Translate the Address Type
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;AddressType;Status;
          - type: translate
            column: 6
            translationTable: "${translation::AddressTypeTranslationTable}"
            # Exclude ports that do not exist
            # Enclosure;Location;DisplayID;PhysicalAddress;Type;AddressType;Status;
          - type: excludeMatchingLines
            column: 7
            valueList: 2
      mapping:
        # InstanceTable = Source(1)
        # Enclosure;Location;DisplayID;PhysicalAddress;Type;AddressType;Status;
        source: "${source::monitors.network.discovery.sources.source(1)}"
        attributes:
          id: $2
          device_type: $5
          __display_id: $3
          physical_address: $4
          physical_address_type: $6
          hw.parent.type: enclosure
          hw.parent.id: $1
          name: "${awk::sprintf(\"%s (%s)\", $3, $5)}"
    collect:
      # Collect type is multi-instance
      type: multiInstance
      keys:
      - id
      sources:
        source(1):
          # Source(1) = hwInfoDiskEntry
          # Location;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.34774.4.1.19.8.11.1
          selectColumns: "5,3"
          computes:
            # Duplicate the Status column
            # Location;Status;Status;
          - type: duplicateColumn
            column: 2
            # Duplicate the Status column
            # Location;Status;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate the first status column into a PATROLStatus
            # Location;PATROLStatus;Status;Status;
          - type: translate
            column: 2
            translationTable: "${translation::PortStatusTranslationTable}"
            # Translate the second status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;Status;
          - type: translate
            column: 3
            translationTable: "${translation::PortStatusInformationTranslationTable}"
            # Translate the Third status column into a more readable string
            # DiskID;PATROLStatus;StatusInformation;LinkStatus;
          - type: translate
            column: 4
            translationTable: "${translation::LinkStatusTranslationTable}"
      mapping:
        # ValueTable = Source(1)
        source: "${source::monitors.network.collect.sources.source(1)}"
        attributes:
          id: $1
        metrics:
          hw.status{hw.type="network"}: $2
          hw.network.up: legacyLinkStatus($4)
        legacyTextParameters:
          StatusInformation: $3
translations:
  ControllerRoleTranslationTable:
    "0": Ordinary Cluster Member
    "1": Cluster Master
    "2": Cluster Preparation
    Default: ""
  DiskTypeTranslationTable:
    "0": FC
    "1": SAS
    "2": SATA
    "3": SSD
    "4": NL_SAS
    "5": SLC SSD
    "6": MLC SSD
    Default: ""
  DiskRoleTranslationTable:
    "1": "Role: Idle Disk"
    "2": "Role: Member of a Logical Disk"
    "3": "Role: Hot Spare"
    "4": "Role: Cache Disk"
    Default: ""
  PortStatusInformationTranslationTable:
    "0": Link Down
    "1": Link Up
    "2": Missing
    "3": Link Bad
    "4": Hardware Error
    "5": Speed Does Not Match
    "6": Enabled
    "7": Disabled
    "8": MAC Error
    "9": Lane Does Not Match
    Default: ""
  PortTypeTranslationTable:
    "0": SAS
    "1": FC
    "2": iSCSI
    "5": iSCSI
    "8": FCoE
    Default: ""
  TypeTranslationTable:
    "22": SVP
    "23": 2U 12GSAS 12 Disk Controller
    "24": 2U SAS 25 Disk Shelf 2.5inch
    "25": 4U SAS 24 Disk Shelf 3.5inch
    "26": 2U 12GSAS 25 Disk Controller
    "16": 2U SAS 12 Disk Shelf
    "17": 2U SAS 24 Disk Shelf
    "18": 4U SAS 24 Disk Shelf
    "19": 4U FC 24 Disk Shelf
    Default: ""
    "0": BMC Controller
    "1": 2U SAS 12 Disk Controller
    "2": 2U SAS 24 Disk Controller
    "96": 3U 2 Independent Controller Head
    "20": 1U PCIe Data Switch
    "97": 6U 4 Independent Controller Head
    "21": 4U SAS 75 Disk Shelf
  LinkStatusTranslationTable:
    "0": degraded
    "1": ok
    "2": ""
    "3": degraded
    "4": ""
    "5": degraded
    "6": ""
    "7": ""
    "8": ""
    "9": degraded
    Default: ""
  StatusInformationTranslationTable:
    "11": No Input
    "12": Low Battery
    "13": Single Link Fault
    "14": Invalid
    "15": Write Protect
    Default: UNKNOWN
    "0": Unknown Status
    "1": ""
    "2": Fault
    "3": Pre-Fail
    "4": Partially Broken
    "5": Degraded
    "6": Bad Sectors Found
    "7": Bit Errors Found
    "8": Consistent
    "9": Inconsistent
    "10": Busy
  PortStatusTranslationTable:
    "0": ok
    "1": ok
    "2": failed
    "3": degraded
    "4": failed
    "5": degraded
    "6": ok
    "7": ok
    "8": degraded
    "9": degraded
    Default: ""
  StatusTranslationTable:
    "11": degraded
    "12": degraded
    "13": degraded
    "14": degraded
    "15": ok
    Default: UNKNOWN
    "0": UNKNOWN
    "1": ok
    "2": failed
    "3": degraded
    "4": degraded
    "5": degraded
    "6": degraded
    "7": degraded
    "8": ok
    "9": degraded
    "10": ok
  RoleTranslationTable:
    "0": Disk Shelf
    "1": Controller
    "2": Data Switch
    "3": Managed Switch
    "4": Management Server
    Default: ""
  AddressTypeTranslationTable:
    "0": WWN
    "1": WWN
    "2": MAC
    "5": MAC
    "8": MAC
    Default: ""
