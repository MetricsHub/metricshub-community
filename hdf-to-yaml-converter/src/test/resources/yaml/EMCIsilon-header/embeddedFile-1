BEGIN {SensorSection = 0 ; DriveSection = 0}

$2 ~ /\[safe.id.*\]/ { SensorSection = 0
    if ($2 ~ "[safe.id.sensors]") { SensorSection = 1 }
    if ($2 ~ "[safe.id.drives]") { DriveSection = 1 }
    }

SensorSection == 1 && NF > 5 {
    nodeName = $1 ; gsub (/:/,"",nodeName);
    if (tolower($3) ~ /chassis/ && $4 ~ /=/) {nodeModelNumber = $5 ;
                                            nodeModel = $6 $7 $8 $9;
                                            gsub(/^[(]/,"",nodeModel);gsub(/[)]$/,"",nodeModel)
                                            print "MSHW_ENCLOSURE;Node;" nodeName ";" nodeModelNumber ";" nodeModel ";"
                                           }
    if (tolower($3) ~ /power/ && $4 ~ /=/) {print "MSHW_POWERSUPPLY;" nodeName ";" nodeName "-Global;Global;"}

    if (tolower($3) ~ /cpu/ && tolower($4) ~ /operation/ && $5 ~ /=/) {print "MSHW_CPU;" nodeName ";" nodeName "-Global;Global;"}

    if ($(NF-5) ~ /\[/ && $(NF-3)~ /\]/ && $(NF-2) ~ /=/) {lowerThreshold = $(NF-5) ; gsub (/\[/,"",lowerThreshold)
                                                                upperThreshold = $(NF-3) ; gsub (/\]/,"",upperThreshold )
                                                                ID = $0 ; gsub (/^.*: +: +/,"",ID);gsub (/ *\[.*$/,"",ID);
                                                                if (tolower($NF) ~ /rpm/) {print "MSHW_FAN;" nodeName ";" nodeName"-"ID ";" ID ";" lowerThreshold ";" upperThreshold ";"}
                                                                if ($NF ~ /C/) {print "MSHW_TEMPERATURE;" nodeName ";" nodeName"-"ID ";" ID ";" lowerThreshold ";" upperThreshold ";"}
                                                                if ($NF ~ /V/) {print "MSHW_VOLTAGE;" nodeName ";" nodeName"-"ID ";" ID ";" lowerThreshold ";" upperThreshold ";"}
                                                               }
    }

DriveSection == 1 && $3 ~ /Bay/ && $4 ~ /^[0-9]+$/ {
    nodeName = $1 ; gsub (/:/,"",nodeName);
    Location = $4 ; Location = "Bay-" Location ;
    Manufacturer = $6 ; Model = $7 ; Firmware = $(NF-3) ;
    Size = $(NF-2) ; gsub (/[(]/,"",Size) ; Size = Size * 512 ; SizeGB = Size / 1000000000 ;
    SerialNumber = $NF ; gsub (/sn:/,"",SerialNumber)
    print "MSHW_PhysicalDisk;" nodeName "-" Location ";" Manufacturer ";" Model ";" Firmware ";" SizeGB ";" SerialNumber ";"
    }