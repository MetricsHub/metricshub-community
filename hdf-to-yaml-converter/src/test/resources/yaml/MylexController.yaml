---
connector:
  displayName: LSI/Mylex GAM Server
  platforms: Fujitsu-Siemens PRIMERGY
  reliesOn: Mylex GAM Server
  version: 1.0
  information: This connector provides disk monitoring through the Mylex SNMP sub-agent which supports all Mylex disk controllers.
  detection:
    connectionTypes:
    - remote
    - local
    appliesTo:
    - NT
    - Linux
    criteria:
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.1608.1.1.1
monitors:
  disk_controller:
    discovery:
      sources:
        source(1):
          type: snmpTable
          oid: 1.3.6.1.4.1.1608.1.1.1.2.1
          selectColumns: "ID,1,2,3,20"
          computes:
          - type: keepOnlyMatchingLines
            column: 3
            valueList: "1,2"
          - type: translate
            column: 5
            translationTable: MylexControllerTranslationTable
      mapping:
        source: $monitors.disk_controller.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          controller_number: $column(2)
          vendor: Mylex
          model: $column(5)
          firmware_version: $column(4)
          hw.parent.type: enclosure
          name: "sprintf(\"Disk Controller: %s (%s %s)\", $column(2), \"Mylex\", $column(5))"
  physical_disk:
    discovery:
      sources:
        source(1):
          type: snmpTable
          oid: 1.3.6.1.4.1.1608.1.1.1.4.1
          selectColumns: "ID,1,6,9,10"
          computes:
          - type: keepOnlyMatchingLines
            column: 5
            valueList: 0
          - type: multiply
            column: 4
            value: 1048576
      mapping:
        source: $monitors.physical_disk.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          vendor: $column(3)
          hw.parent.type: disk_controller
          hw.parent.id: "lookup(\"disk_controller\", \"id\", \"controller_number\", $column(2))"
          name: "sprintf(\"%s (%s - %by10hf.s)\", $column(1), $column(3), $column(4))"
        metrics:
          hw.physical_disk.size: $column(4)
    collect:
      type: monoInstance
      sources:
        source(1):
          type: snmpGet
          oid: 1.3.6.1.4.1.1608.1.1.1.4.1.5.%PhysicalDisk.Collect.DeviceID%
          computes:
          - type: duplicateColumn
            column: 1
          - type: duplicateColumn
            column: 1
          - type: translate
            column: 2
            translationTable: PhysicalDiskStatusTranslationTable
          - type: translate
            column: 3
            translationTable: PhysicalDiskStatusInformationTranslationTable
      mapping:
        source: $monitors.physical_disk.collect.sources.source(1)$
        metrics:
          hw.status{hw.type="physical_disk"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  logical_disk:
    discovery:
      sources:
        source(1):
          # Source(1) = eLogicalDriveInformation SNMP table
          type: snmpTable
          oid: 1.3.6.1.4.1.1608.1.1.1.3.1
          selectColumns: "ID,1,3,4,6"
          computes:
          - type: excludeMatchingLines
            column: 3
            valueList: 128
          - type: multiply
            column: 5
            value: 1048576
      mapping:
        # Instance Table
        source: $monitors.logical_disk.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          raid_level: $column(4)
          hw.parent.type: disk_controller
          hw.parent.id: "lookup(\"disk_controller\", \"id\", \"controller_number\", $column(2))"
          name: "sprintf(\"%s (%s - %by2hf.s)\", $column(1), $column(4), $column(5))"
        metrics:
          hw.logical_disk.limit: $column(5)
    collect:
      # Collect type: MonoInstance
      type: monoInstance
      sources:
        source(1):
          # Source(1) = the a3OperationalState column of the eLogicalDriveInformation SNMP table
          type: snmpGet
          oid: 1.3.6.1.4.1.1608.1.1.1.3.1.3.%LogicalDisk.Collect.DeviceID%
          computes:
          - type: duplicateColumn
            column: 1
          - type: duplicateColumn
            column: 1
          # translate the a3OperationalState into a PATROL status
          - type: translate
            column: 2
            translationTable: LogicalDiskStatusTranslationTable
          # translate the a3OperationalState into a more readable string
          - type: translate
            column: 3
            translationTable: LogicalDiskStatusInformationTranslationTable
      mapping:
        # The value table
        source: $monitors.logical_disk.collect.sources.source(1)$
        metrics:
          hw.status{hw.type="logical_disk"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
translations:
  PhysicalDiskStatusInformationTranslationTable:
    "0": Dead
    "2": Rebuilding
    "3": ""
    "4": Installation Abort
    "5": ""
    "16": Hot spare
    "6": Not present
    Default: Unknown Status
    "130": Rebuild Cancelled
  LogicalDiskStatusInformationTranslationTable:
    "255": Off-line
    "3": ""
    "4": Critical
    "128": Not present
    Default: Unknown Status
  MylexControllerTranslationTable:
    "192": BT930
    "193": BT932
    "150": BT-757
    "194": BT950
    "151": BT-757d
    "195": BT952
    "152": BT-757s
    "153": BT-757cd
    "154": BT-75xc
    "155": BT-747c
    "156": BT-757c
    "96": DAC960s
    "97": DAC960su
    "98": DAC960sx
    "99": DAC960sf
    "16": DAC960pd
    "17": DAC960pl
    "18": DAC960pdu
    "19": DAC960pe
    "160": BT-540
    "161": BT-540c
    "162": BT-542
    "163": BT-542b
    "164": BT-542c
    "165": BT-542d
    "1": DAC960e
    "166": BT-545
    "167": BT-545c
    "168": BT-545s
    "169": BT-54xc
    "8": DAC960m
    "129": BT-440
    "20": DAC960pg
    "21": DAC960pj
    "22": DAC960ptl0
    "23": DAC960pr
    "24": DAC960prl
    "25": DAC960pt
    "26": DAC1164p
    "27": DAC960ptl1
    "28": ExtremeRaid2000
    "29": ExtremeRaid3000
    "130": BT-440c
    "131": BT-445
    "132": BT-445c
    "176": BT-946
    "133": BT-44xc
    "177": BT-946c
    "134": BT-445s
    "178": BT-948
    "179": BT-948c
    "136": BT-640
    "137": BT-640a
    "138": BT-646
    "139": BT-646d
    "30": AcceleRaid352
    "31": AcceleRaid170
    "32": AcceleRaid160
    "180": BT-956
    "181": BT-956c
    "182": BT-958
    "183": BT-958c
    "140": BT-646s
    "184": BT-958d
    Default: ""
    "185": BT-956cd
    "186": BT-958cd
    "100": DAC960ss
    "144": BT-742
    "101": DAC960fl
    "145": BT-742a
    "102": DAC960ll
    "146": BT-747
    "103": DAC960ff
    "147": BT-747d
    "104": FC Array
    "148": BT-747s
    "105": DAC960mfl
    "149": BT-74xc
    "106": DAC960mff
    "107": DAC960ffx
  LogicalDiskStatusTranslationTable:
    "255": failed
    "3": ok
    "4": degraded
    "128": degraded
    Default: UNKNOWN
  PhysicalDiskStatusTranslationTable:
    "0": failed
    "2": degraded
    "3": ok
    "4": ok
    "5": ok
    "16": ok
    "6": degraded
    Default: UNKNOWN
    "130": degraded
