BEGIN {FS=";"; }
{ID = $1; gsub(/.*context./,"",ID); gsub(/..attributes.*$/,"",ID);}
$2 ~ /^address/  { Address[ID] = $3 ;   }
$2 ~ /^enabled/ && Address[ID] != 0 { Enabled[ID] = $3 ; }
$2 ~ /^name/ {
    Name[ID] = $3 ;
    split($4,outputarray,"/")
    Parent[ID]=outputarray[3]
    }
$2 ~ /^operational-status/ { Status[ID] = $3 ; }
$2 ~ /^port-status/  { PortStatus[ID] = $3 ;  }
$2 ~ /^port-wwn/ { PortWWN[ID] = $3 ; }
$2 ~ /^role/ { Role[ID] = $3 ;   }


END{
for ( ID in Name) {
    # if the only error is a no-link, clear the error
    if ( Status[ID] == "error" && PortStatus[ID] == "no-link") { Status[ID] = "ok" }
    print "MSHW;" Address[ID] ";" Enabled[ID] ";" Name[ID] ";" Status[ID] ";" PortStatus[ID] ";" PortWWN[ID] ";" Role[ID] ";" Parent[ID] ";"
    }
}