---
connector:
  displayName: Huawei OceanStor (REST)
  platforms: Huawei OceanStor
  reliesOn: Huawei DeviceManager REST API
  version: 1.0
  information: "This connector discovers environmental sensors, Fans, Controllers, Power Supplies, Battery Backup Units, CPUs, LUNs, Physical Disks and NetworkCards for Huawei OceanStor storage devices. It relies on OceanStor V3 and above."
  detection:
    connectionTypes:
    - remote
    appliesTo:
    - Storage
    criteria:
    # Try and get a token
    - type: http
      method: GET
      url: /
      header: Accept:*/*
      errorMessage: Not an OceanStor V3 system or above.
      resultContent: body
      expectedResult: <html ng-app="com.huawei.ism.ibase">
monitors:
  enclosure:
    discovery:
      sources:
        source(1):
          # Discovery
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.enclosure.discovery.sources.source(2)}"
          - "${source::monitors.enclosure.discovery.sources.source(4)}"
        source(6):
          # System
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/system/
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/NAME;/PRODUCTMODE;/patchVersion;
          - type: translate
            column: 4
            translationTable: "${translation::EnclosureProductModeTranslationTable}"
        source(7):
          # Logical Disk
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/lun
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(8):
          # physical_disk
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/disk
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(9):
          # FC PORT
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/fc_port
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(10):
          # SAS PORT
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/sas_port
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(11):
          # ETH PORT
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/eth_port
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(12):
          # disk_controller
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/controller
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(13):
          # fan
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/fan
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(14):
          # power
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/power
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(15):
          # backup_power
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/backup_power
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(16):
          # cpu
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/cpu
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(17):
          # enclosure
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/enclosure
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
          resultContent: body
        source(18):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.discovery.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.enclosure.discovery.sources.source(5)}"
        source(19):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(17)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../Column(2);/MODEL;/SERIALNUM;
        source(20):
          type: tableJoin
          leftTable: "${source::monitors.enclosure.discovery.sources.source(6)}"
          rightTable: "${source::monitors.enclosure.discovery.sources.source(19)}"
          leftKeyColumn: 2
          rightKeyColumn: 2
          defaultRightLine: ;;;
      mapping:
        source: "${source::monitors.enclosure.discovery.sources.source(20)}"
        attributes:
          id: $2
          __display_id: $3
          model: $4
          bios_version: $5
          serial_number: $9
          vendor: Huawei
          type: Storage
          name: "${awk::sprintf(\"Storage: %s (%s %s)\", $3, \"Huawei\", $4)}"
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.enclosure.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.enclosure.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.enclosure.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.enclosure.collect.sources.source(2)}"
          - "${source::monitors.enclosure.collect.sources.source(4)}"
        source(6):
          # Query System
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/system/
          header: "${source::monitors.enclosure.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.enclosure.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.enclosure.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.enclosure.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="enclosure"}: $3
        legacyTextParameters:
          StatusInformation: $4
  cpu:
    discovery:
      sources:
        source(1):
          # HTTP: /cpu
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(16)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;/WORKFREQUENCY;
          - type: leftConcat
            column: 4
            value: "CPU: "
      mapping:
        source: "${source::monitors.cpu.discovery.sources.source(1)}"
        attributes:
          id: $3
          __display_id: $4
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: "${awk::sprintf(\"%s (%s)\", $4, megaHertz2HumanFormat($5))}"
        metrics:
          hw.cpu.speed.limit{limit_type="max"}: megaHertz2Hertz($5)
    collect:
      # Collect
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.cpu.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.cpu.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.cpu.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.cpu.collect.sources.source(2)}"
          - "${source::monitors.cpu.collect.sources.source(4)}"
        source(6):
          # Query System
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.cpu.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/cpu
          header: "${source::monitors.cpu.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/CURRENTFREQUENCY;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.cpu.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.cpu.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.cpu.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="cpu"}: $3
          hw.cpu.speed: megaHertz2Hertz($5)
        legacyTextParameters:
          StatusInformation: $4
  temperature:
    discovery:
      sources:
        source(1):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(16)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;/CORETEMP;
          - type: rightConcat
            column: 5
            value: ;CPU Core
        source(2):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(8)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;/TEMPERATURE;
          - type: rightConcat
            column: 5
            value: ;Disk
        source(3):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(17)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);../../Column(2);../../Column(2);/TEMPERATURE;
          # TemperatureType:AttachedToDeviceType
          - type: rightConcat
            column: 5
            value: ;Enclosure
        source(4):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(14)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;/TEMPERATURE;
          # TemperatureType:AttachedToDeviceType
          - type: rightConcat
            column: 5
            value: ;Controller
        source(5):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(12)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;/TEMPERATURE;
          # TemperatureType:AttachedToDeviceType
          - type: rightConcat
            column: 5
            value: ;PSU
        source(6):
          type: tableUnion
          tables:
          - "${source::monitors.temperature.discovery.sources.source(1)}"
          - "${source::monitors.temperature.discovery.sources.source(2)}"
          - "${source::monitors.temperature.discovery.sources.source(3)}"
          - "${source::monitors.temperature.discovery.sources.source(4)}"
          - "${source::monitors.temperature.discovery.sources.source(5)}"
          computes:
          - type: leftConcat
            column: 4
            value: "TEMPERATURE: "
          - type: leftConcat
            column: 3
            value: 'TEMP:'
          - type: replace
            column: 5
            existingValue: 0
            newValue: ""
          - type: replace
            column: 5
            existingValue: -1
            newValue: ""
      mapping:
        source: "${source::monitors.temperature.discovery.sources.source(6)}"
        attributes:
          id: $3
          __display_id: $4
          sensor_location: $6
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: "${awk::sprintf(\"%s (%s)\", $4, $6)}"
    collect:
      type: multiInstance
      sources:
        source(1):
          # cpu
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.temperature.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.temperature.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.temperature.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.temperature.collect.sources.source(2)}"
          - "${source::monitors.temperature.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/cpu
          header: "${source::monitors.temperature.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/CORETEMP;
        source(7):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/disk
          header: "${source::monitors.temperature.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/TEMPERATURE;
        source(8):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/enclosure
          header: "${source::monitors.temperature.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/HEALTHSTATUS;/HEALTHSTATUS;/TEMPERATURE;
        source(9):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/power
          header: "${source::monitors.temperature.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/TEMPERATURE;
        source(10):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/controller
          header: "${source::monitors.temperature.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/TEMPERATURE;
        source(11):
          type: tableUnion
          tables:
          - "${source::monitors.temperature.collect.sources.source(6)}"
          - "${source::monitors.temperature.collect.sources.source(7)}"
          - "${source::monitors.temperature.collect.sources.source(8)}"
          - "${source::monitors.temperature.collect.sources.source(9)}"
          - "${source::monitors.temperature.collect.sources.source(10)}"
          computes:
          - type: leftConcat
            column: 2
            value: 'TEMP:'
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
          - type: replace
            column: 5
            existingValue: 0
            newValue: ""
          - type: replace
            column: 5
            existingValue: -1
            newValue: ""
        source(12):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.temperature.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.temperature.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.temperature.collect.sources.source(11)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="temperature"}: $3
          hw.temperature: $5
        legacyTextParameters:
          StatusInformation: $4
  voltage:
    discovery:
      sources:
        source(1):
          # cpu
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(16)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;
          - type: rightConcat
            column: 4
            value: ;CPU
        source(2):
          # controller
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(12)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/ID;
          - type: rightConcat
            column: 4
            value: ;Controller
        source(3):
          type: tableUnion
          tables:
          - "${source::monitors.voltage.discovery.sources.source(1)}"
          - "${source::monitors.voltage.discovery.sources.source(2)}"
          computes:
          - type: leftConcat
            column: 4
            value: "Voltage: "
          - type: leftConcat
            column: 3
            value: 'VOLT:'
      mapping:
        source: "${source::monitors.voltage.discovery.sources.source(3)}"
        attributes:
          id: $3
          __display_id: $4
          sensor_location: $5
          hw.parent.type: $6
          hw.parent.id: $2
          name: "${awk::sprintf(\"%s (%s)\", $4, $5)}"
    collect:
      type: multiInstance
      sources:
        source(1):
          # cpu
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.voltage.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.voltage.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.voltage.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.voltage.collect.sources.source(2)}"
          - "${source::monitors.voltage.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.voltage.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/cpu
          header: "${source::monitors.voltage.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/VOLTS;
          - type: divide
            column: 5
            value: 10
        source(7):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.voltage.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/controller
          header: "${source::monitors.voltage.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/VOLTAGE;
        source(8):
          type: tableUnion
          tables:
          - "${source::monitors.voltage.collect.sources.source(6)}"
          - "${source::monitors.voltage.collect.sources.source(7)}"
          computes:
          - type: leftConcat
            column: 2
            value: 'VOLT:'
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
          - type: multiply
            column: 5
            value: 1000
        source(9):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.voltage.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.voltage.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.voltage.collect.sources.source(8)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="voltage"}: $3
          hw.voltage: $5
        legacyTextParameters:
          StatusInformation: $4
  disk_controller:
    discovery:
      sources:
        source(1):
          # HTTP: /controller
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(12)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/NAME;/SOFTVER;
      mapping:
        source: "${source::monitors.disk_controller.discovery.sources.source(1)}"
        attributes:
          id: $3
          __display_id: $4
          firmware_version: $5
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: "${awk::sprintf(\"Disk Controller: %s\", $4)}"
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.disk_controller.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.disk_controller.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.disk_controller.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.disk_controller.collect.sources.source(2)}"
          - "${source::monitors.disk_controller.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.disk_controller.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/controller
          header: "${source::monitors.disk_controller.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.disk_controller.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.disk_controller.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.disk_controller.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="disk_controller"}: $3
        legacyTextParameters:
          StatusInformation: $4
  power_supply:
    discovery:
      sources:
        source(1):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(14)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /../../Column(2);/ID;/LOCATION;
      mapping:
        source: "${source::monitors.power_supply.discovery.sources.source(1)}"
        attributes:
          id: $3
          __display_id: $4
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: $4
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.power_supply.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.power_supply.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.power_supply.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.power_supply.collect.sources.source(2)}"
          - "${source::monitors.power_supply.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.power_supply.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/power
          header: "${source::monitors.power_supply.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.power_supply.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.power_supply.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.power_supply.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="power_supply"}: $3
        legacyTextParameters:
          StatusInformation: $4
  battery:
    discovery:
      sources:
        source(1):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(15)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /../../Column(2);/ID;/LOCATION;
          - type: leftConcat
            column: 4
            value: "BBU: "
      mapping:
        source: "${source::monitors.battery.discovery.sources.source(1)}"
        attributes:
          id: $4
          __display_id: $4
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: $4
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.battery.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.battery.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.battery.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.battery.collect.sources.source(2)}"
          - "${source::monitors.battery.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.battery.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/backup_power
          header: "${source::monitors.battery.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /LOCATION;/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
          - type: leftConcat
            column: 2
            value: "BBU: "
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.battery.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.battery.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.battery.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="battery"}: $3
        legacyTextParameters:
          StatusInformation: $4
  fan:
    discovery:
      sources:
        source(1):
          # HTTP: /fan
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(13)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /PARENTTYPE;../../Column(2);/ID;/LOCATION;
          - type: translate
            column: 2
            translationTable: "${translation::TypeTranslationTable}"
          - type: leftConcat
            column: 5
            value: "Fan: "
      mapping:
        source: "${source::monitors.fan.discovery.sources.source(1)}"
        attributes:
          id: $4
          __display_id: $5
          hw.parent.type: $2
          hw.parent.id: $3
          name: $5
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.fan.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.fan.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.fan.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.fan.collect.sources.source(2)}"
          - "${source::monitors.fan.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.fan.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/fan
          header: "${source::monitors.fan.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.fan.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.fan.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.fan.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="fan"}: $3
        legacyTextParameters:
          StatusInformation: $4
  physical_disk:
    discovery:
      sources:
        source(1):
          # HTTP: /disk
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(8)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;DISKTYPE;/MODEL;/FIRMWAREVER;/MANUFACTURER;/SERIALNUMBER;/LOCATION;/SECTORS;/SECTORSIZE;
          - type: translate
            column: 4
            translationTable: "${translation::PhysicalDiskTypeTranslationTable}"
          # Get disk size (sectors * sector size)
          - type: multiply
            column: 10
            value: $11
      mapping:
        source: "${source::monitors.physical_disk.discovery.sources.source(1)}"
        attributes:
          id: $3
          __display_id: $9
          model: $5
          firmware_version: $6
          vendor: $7
          serial_number: $8
          hw.parent.type: enclosure
          hw.parent.id: $2
          name: "${awk::sprintf(\"%s (%s - %s)\", $9, $7, bytes2HumanFormatBase10($10))}"
        metrics:
          hw.physical_disk.size: $10
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.physical_disk.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.physical_disk.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.physical_disk.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.physical_disk.collect.sources.source(2)}"
          - "${source::monitors.physical_disk.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.physical_disk.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/disk
          header: "${source::monitors.physical_disk.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/ABRASIONRATE;;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
          - type: replace
            column: 6
            existingValue: ""
            newValue: 100
          - type: subtract
            column: 6
            value: $5
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.physical_disk.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.physical_disk.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.physical_disk.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="physical_disk"}: $3
          hw.physical_disk.endurance_utilization{state="remaining"}: percent2Ratio($6)
        legacyTextParameters:
          StatusInformation: $4
  logical_disk:
    discovery:
      sources:
        source(1):
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(7)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: ../../Column(2);/ID;/NAME;/PARENTID;/SECTORSIZE;/CAPACITY;/WORKINGCONTROLLER;/ALLOCTYPE;
          # Get disk size (sectors * capacity)
          - type: multiply
            column: 6
            value: $7
          - type: translate
            column: 9
            translationTable: "${translation::LogicalDiskTypeTranslationTable}"
      mapping:
        source: "${source::monitors.logical_disk.discovery.sources.source(1)}"
        attributes:
          id: $3
          __display_id: $4
          type: Volume
          hw.parent.type: disk_controller
          hw.parent.id: $8
          name: "${awk::sprintf(\"%s (%s)\", $4, bytes2HumanFormatBase2($6))}"
        metrics:
          hw.logical_disk.limit: $6
    collect:
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.logical_disk.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.logical_disk.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.logical_disk.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.logical_disk.collect.sources.source(2)}"
          - "${source::monitors.logical_disk.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.logical_disk.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/lun
          header: "${source::monitors.logical_disk.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /data
            properties: ID;/HEALTHSTATUS;/HEALTHSTATUS;
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
        source(7):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.logical_disk.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.logical_disk.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.logical_disk.collect.sources.source(6)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="logical_disk"}: $3
        legacyTextParameters:
          StatusInformation: $4
  network:
    discovery:
      sources:
        source(1):
          # FC Port
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(9)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /PARENTID;/ID;/LOCATION;/WWN;/TYPE;/PARENTTYPE;
          - type: rightConcat
            column: 7
            value: ;FC Port
        source(2):
          # SAS Port
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(10)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /PARENTID;/ID;/LOCATION;/WWN;/TYPE;/PARENTTYPE;
          - type: rightConcat
            column: 7
            value: ;SAS Port
        source(3):
          # ETH Port
          type: copy
          from: "${source::monitors.enclosure.discovery.sources.source(11)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /PARENTID;/ID;/LOCATION;/MACADDRESS;/TYPE;/PARENTTYPE;
          - type: rightConcat
            column: 7
            value: ;Ethernet Port
        source(4):
          # UNION
          type: tableUnion
          tables:
          - "${source::monitors.network.discovery.sources.source(1)}"
          - "${source::monitors.network.discovery.sources.source(2)}"
          - "${source::monitors.network.discovery.sources.source(3)}"
          computes:
          - type: translate
            column: 6
            translationTable: "${translation::TypeTranslationTable}"
          - type: replace
            column: 2
            existingValue: .0
            newValue: ""
          - type: translate
            column: 7
            translationTable: "${translation::TypeTranslationTable}"
      mapping:
        source: "${source::monitors.network.discovery.sources.source(4)}"
        attributes:
          id: $3
          __display_id: $4
          logical_address: $5
          logical_address_type: $8
          device_type: $6
          hw.parent.type: $7
          hw.parent.id: $2
          name: "${awk::sprintf(\"%s (%s)\", $4, $6)}"
    collect:
      type: multiInstance
      sources:
        source(1):
          type: http
          method: POST
          url: deviceManager/rest/xxxxx/sessions
          header: Accept:application/json
          body: "{\"password\":\"%{PASSWORD}\",\"username\":\"%{USERNAME}\",\"scope\": 0}"
          resultContent: all
        source(2):
          # Get Cookies
          type: copy
          from: "${source::monitors.network.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-2}"
        source(3):
          # Get body
          type: copy
          from: "${source::monitors.network.collect.sources.source(1)}"
          computes:
          - type: awk
            script: "${file::embeddedFile-1}"
          - type: json2csv
            entryKey: /data
            properties: /deviceid;/iBaseToken;
          # append key to header value <key>:<value> ibaseToken:<token>
          - type: leftConcat
            column: 3
            value: 'iBaseToken:'
          # Stops sending invalid commands if session did not authenticate.
          - type: excludeMatchingLines
            column: 3
            regExp: ^iBaseToken:$
        source(4):
          # Keep iBaseToken as source 3
          type: copy
          from: "${source::monitors.network.collect.sources.source(3)}"
          computes:
          - type: keepColumns
            columnNumbers: 3
          - type: awk
            script: "${file::embeddedFile-3}"
        source(5):
          # union iBaseToken, cookies and Acccept headers
          type: tableUnion
          tables:
          - Accept:Application/Json
          - "${source::monitors.network.collect.sources.source(2)}"
          - "${source::monitors.network.collect.sources.source(4)}"
        source(6):
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.network.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/fc_port
          header: "${source::monitors.network.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/RUNNINGSTATUS;/RUNSPEED;
        source(7):
          # SAS Port
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.network.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/sas_port
          header: "${source::monitors.network.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/RUNNINGSTATUS;/RUNSPEED;
        source(8):
          # ETH Port
          type: http
          method: GET
          executeForEachEntryOf:
            source: "${source::monitors.network.collect.sources.source(3)}"
            concatMethod: json_array_extended
          url: /deviceManager/rest/$2/eth_port
          header: "${source::monitors.network.collect.sources.source(5)}"
          computes:
          - type: json2csv
            entryKey: /Entry/Value/data
            properties: /ID;/HEALTHSTATUS;/HEALTHSTATUS;/RUNNINGSTATUS;/SPEED;
        source(9):
          type: tableUnion
          tables:
          - "${source::monitors.network.collect.sources.source(6)}"
          - "${source::monitors.network.collect.sources.source(7)}"
          - "${source::monitors.network.collect.sources.source(8)}"
          computes:
          - type: translate
            column: 3
            translationTable: "${translation::HealthStatusTranslationTable}"
          - type: translate
            column: 4
            translationTable: "${translation::HealthStatusInformationTranslationTable}"
          - type: translate
            column: 5
            translationTable: "${translation::LinkStatusTranslationTable}"
          - type: replace
            column: 6
            existingValue: -1
            newValue: 0
        source(10):
          # End Session
          type: http
          method: DELETE
          executeForEachEntryOf:
            source: "${source::monitors.network.collect.sources.source(3)}"
          url: /deviceManager/rest/$2/sessions
          header: "${source::monitors.network.collect.sources.source(5)}"
      mapping:
        source: "${source::monitors.network.collect.sources.source(9)}"
        deviceId: $2
        metrics:
          hw.status{hw.type="network"}: $3
          hw.network.up: legacyLinkStatus($5)
          hw.network.bandwidth.limit: megaBit2Bit($6)
        legacyTextParameters:
          StatusInformation: $4
translations:
  PhysicalDiskTypeTranslationTable:
    "11": NL_SAS_SED
    "12": SLC_SSD_SED
    "13": MLC_SSD_SED
    "0": FC
    "1": SAS
    "2": SATA
    "3": SSD
    "4": NL_SAS
    "5": SLC_SSD
    "6": MLC_SSD
    "7": FC_SED
    "8": SAS_SED
    "9": SATA_SED
    "10": SSD_SED
  EnclosureProductModeTranslationTable:
    "68": 5500 V3
    "70": 5300 V3
    "71": 2800 V3
    "61": 6800 V3
    "72": 18500 V3
    "62": 6900 V3
    "73": 18800 V3
    "63": 5600 V3
    "64": 5800 V3
  HealthStatusInformationTranslationTable:
    "0": Unknown
    "11": no input
    "1": Normal
    "12": low battery
    "2": Faulty
    "3": Failing
    "9": inconsistent
  HealthStatusTranslationTable:
    "0": UNKNOWN
    "11": degraded
    "1": ok
    "12": degraded
    "2": failed
    "3": degraded
    "9": degraded
  TypeTranslationTable:
    "211": Fan
    "212": Fibre Channel
    "213": Ethernet
    "214": SAS
    "206": Enclosure
    "207": DiskController
    "209": DiskController
  LinkStatusTranslationTable:
    "0": degraded
    "11": degraded
    "1": ok
    "2": ok
    "53": degraded
    "10": ok
  LogicalDiskTypeTranslationTable:
    "0": Thick LUN
    "1": Thin LUN
    "2": Snapshot
