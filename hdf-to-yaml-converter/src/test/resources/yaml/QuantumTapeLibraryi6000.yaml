---
embedded:
  EmbeddedFile(1): "BEGIN {FS=\"[;]\"}\n$1 ~ /^[0-9.]+$/ {split($1,ID,\".\");\n\t                deviceID = $1\n\t                displayID = ID[12] \",\" ID[13] \",\" ID[14] \",\" ID[15] \",\" ID[16] \",\" ID[17]\n\t                location = \"Location: Aisle: \" ID[12] \" Frame: \" ID[13] \" Rack: \" ID[14] \" Section: \" ID[15] \" Col: \" ID[16] \" Row: \" ID[17]\n\t                print \"MSHW;\" $0 displayID \";\" location \";\"\n\t               }"
  EmbeddedFile(2): "BEGIN {FS=\";\";}\n{\n\tif ($3 != 0 && $4 !=0)\n\t{\n\t\tprint $0\n\t}\n}"
translations:
  CleaningStatusTranslationTable:
    "1": 1
    "2": 0
    default: UNKNOWN
    "3": 2
  EnclosureStatusTranslationTable:
    "1": degraded
    "2": UNKNOWN
    default: UNKNOWN
    "3": ok
    "4": degraded
    "5": failed
    "6": failed
  StatusInformationTranslationTable:
    "1": ""
    "2": Failed
    default: Unknown Status
    "3": Degraded
    "4": Warning
    "5": Informational
    "6": Unknown
    "7": Invalid
  StatusTranslationTable:
    "1": ok
    "2": failed
    default: UNKNOWN
    "3": degraded
    "4": degraded
    "5": degraded
    "6": UNKNOWN
    "7": failed
  EnclosureStatusInformationTranslationTable:
    "1": Reporting status of 'Other'
    "2": Unknown
    default: Unknown Status
    "3": ""
    "4": Non-Critical
    "5": Critical
    "6": Non-Recoverable
  CleaningStatusInformationTranslationTable:
    "0": ""
    "1": ' Cleaning Required'
    "2": ""
    default: ' Unknown Cleaning Status'
    "3": ' Immediate Cleaning Required'
connector:
  displayName: Quantum (ADIC) Enterprise Level Tape Libraries
  platforms: "Quantum Scalar i2000,Quantum Scalar i6000"
  reliesOn: Quantum SNMP Agent (ADIC-MANAGEMENT-MIB)
  version: 1.0
  information: This connector provides hardware monitoring through the Quantum Scalar's SNMP interface.  It is primarily designed for the i2000 and i6000 libraries.
  detection:
    connectionTypes:
    - remote
    appliesTo:
    - Storage
    supersedes:
    - SMISLibrary
    criteria:
      # DETECTION
      # Does a get_next to see if there are any tape drives
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.3764.1.1.200.20.80.110.1
monitors:
  enclosure:
    discovery:
      sources:
        source(1):
          # Source(1) = FRU information
          # Role;Model;Vendor;Firmware;SerialNumber;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.10
          selectColumns: "1,3,6,8,10"
          computes:
            # Add an identifier to enable table Joints
            # MSHW;Role;Model;Vendor;Firmware;SerialNumber;
          - type: leftConcat
            column: 1
            value: MSHW;
        source(2):
          # Get the Enclosure(s) ID(s)
          # EnclosureID;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.10.10.1
          selectColumns: ID
          computes:
            # Add an identifier to enable table Joints
            # MSHW;EnclosureID;
          - type: leftConcat
            column: 1
            value: MSHW;
        source(3):
          # Join the EnclosureIDs with the FRUs
          # MSHW;EnclosureID;MSHW;Role;Model;Vendor;Firmware;SerialNumber;
          type: tableJoin
          leftTable: $monitors.enclosure.discovery.sources.source(2)$
          rightTable: $monitors.enclosure.discovery.sources.source(1)$
          leftKeyColumn: 1
          rightKeyColumn: 1
          defaultRightLine: ;;;;;;
          computes:
            # Add \"Role: \" to AdditionalInformation1
          - type: leftConcat
            column: 4
            value: "Role: "
      mapping:
        # InstanceTable = Source(1)
        # MSHW;EnclosureID;MSHW;Role;Model;Vendor;Firmware;SerialNumber;
        source: $monitors.enclosure.discovery.sources.source(3)$
        attributes:
          id: $column(2)
          vendor: $column(6)
          model: $column(5)
          serial_number: $column(8)
          bios_version: $column(7)
          type: Storage
          info: $column(4)
          name: "sprintf(\"%s (%s %s - %s)\", $column(2), $column(6), $column(5), \"Storage\")"
    collect:
      type: multiInstance
      sources:
        source(1):
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.10.10.1
          selectColumns: "ID,2"
          computes:
            # Duplicate status, because we will translate it two times
            # EnclosureID;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # EnclosureID;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: EnclosureStatusTranslationTable
            # Translate second Status into more readable string
            # EnclosureID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: EnclosureStatusInformationTranslationTable
      mapping:
        # Value Table
        # EnclosureID;PATROLStatus;StatusInformation;
        source: $monitors.enclosure.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.status{hw.type="enclosure"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  tape_drive:
    discovery:
      sources:
        source(1):
          # Source(1) = \tphDriveEntry SNMP table\nTapedriveID;Vendor;Product;SerialNumber;NeedsCleaning;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.80.110.1
          selectColumns: "ID,6,7,8,9"
          computes:
            # Deactivate Needs Cleaning if value = 0 (autoclean)
            # TapedriveID;Vendor;Product;SerialNumber;NeedsCleaning;
          - type: replace
            column: 5
            existingValue: 0
            newValue: ""
            # Extract the DisplayID and Location
            # TapedriveID;Vendor;Product;SerialNumber;NeedsCleaning;DisplayID;Location;
          - type: awk
            script: EmbeddedFile(1)
            keep: ^MSHW;
            separators: ;
            selectColumns: "2,3,4,5,6,7,8"
      mapping:
        # Instance Table
        # TapedriveID;Vendor;Product;SerialNumber;NeedsCleaning;DisplayID;Location;
        source: $monitors.tape_drive.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          __display_id: $column(6)
          model: $column(3)
          serial_number: $column(4)
          info: $column(7)
          hw.parent.type: enclosure
          name: "sprintf(\"%s (%s)\", $column(1), $column(3))"
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \tphysicalDriveEntry SNMP table\nTapeDriveID;NeedsCleaning;ReadErrors;WriteErrors;RASStatus;Loads;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.80.110.1
          selectColumns: "ID,9,23,24,31,20"
          computes:
            # Duplicate status, because we will translate it two times
            # TapeDriveID;NeedsCleaning;ReadErrors;WriteErrors;RASStatus;RASStatus;Loads;
          - type: duplicateColumn
            column: 5
            # Translate Status into PATROLStatus
            # TapeDriveID;NeedsCleaning;ReadErrors;WriteErrors;PATROLStatus;RASStatus;Loads;
          - type: translate
            column: 5
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # TapeDriveID;NeedsCleaning;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: translate
            column: 6
            translationTable: StatusInformationTranslationTable
            # Duplicate Cleaning status, because we will translate it two times
            # TapeDriveID;NeedsCleaning;NeedsCleaning;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: duplicateColumn
            column: 2
            # Translate Cleaning Status into CleaningStatus
            # TapeDriveID;CleaningStatus;NeedsCleaning;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: translate
            column: 2
            translationTable: CleaningStatusTranslationTable
            # Translate second Status into more readable string
            # TapeDriveID;CleaningStatus;CleaningStatusInformation;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: translate
            column: 3
            translationTable: CleaningStatusInformationTranslationTable
            # Merge Drive Status Information and Cleaning Status Information
            # TapeDriveID;CleaningStatus;CleaningStatusInformation;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: rightConcat
            column: 7
            value: Column(3)
            # Add write errors to read errors
            # TapeDriveID;CleaningStatus;CleaningStatusInformation;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
          - type: add
            column: 4
            value: Column(5)
      mapping:
        # Value Table
        # TapeDriveID;CleaningStatus;CleaningStatusInformation;ReadErrors;WriteErrors;PATROLStatus;StatusInformation;Loads;
        source: $monitors.tape_drive.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.status{hw.type="tape_drive"}: $column(6)
          hw.status{hw.type="tape_drive", state="needs_cleaning"}: legacyNeedsCleaning($column(2))
          hw.tape_drive.operations{type="mount"}: $column(8)
          hw.errors{hw.type="tape_drive"}: $column(4)
        legacyTextParameters:
          StatusInformation: $column(7)
  power_supply:
    discovery:
      sources:
        source(1):
          # Source(1) = \tGlobal RAS SNMP table\nDeviceID
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: ID
          computes:
            # Keep only the correct type of group
            # DeviceID
          - type: keepOnlyMatchingLines
            column: 1
            regExp: 5$
            # Add a Type of "Global"
            # Type;DeviceID;
          - type: leftConcat
            column: 1
            value: Global;
            # Add Marker to the End of the DeviceID
            # Type;DeviceID;
          - type: rightConcat
            column: 2
            value: _MSHW
            # Remove the last digit (the type of sensor) to leave just the system ID
            # Type;DeviceID;
          - type: replace
            column: 2
            existingValue: .5_MSHW
            newValue: ""
      mapping:
        # Instance Table
        # Type;DeviceID;
        source: $monitors.power_supply.discovery.sources.source(1)$
        attributes:
          id: $column(2)
          __display_id: $column(1)
          hw.parent.type: enclosure
          name: "sprintf(\"%s, $column(1))"
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \t\tGlobal RAS SNMP table\nDeviceID;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: "ID,2"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
            # Add Marker to the End of the DeviceID
            # DeviceID;PATROLStatus;StatusInformation;
          - type: rightConcat
            column: 1
            value: _MSHW
            # Remove the last digit (the type of sensor) to leave just the system ID
            # DeviceID;PATROLStatus;StatusInformation;
          - type: replace
            column: 1
            existingValue: .5_MSHW
            newValue: ""
      mapping:
        # Value Table
        # DeviceID;PATROLStatus;StatusInformation;
        source: $monitors.power_supply.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.status{hw.type="power_supply"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  robotics:
    discovery:
      sources:
        source(1):
          # Source(1) = \tGlobal RAS SNMP table\nDeviceID;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: ID
          computes:
            # Keep only the correct type of group
            # DeviceID;
          - type: keepOnlyMatchingLines
            column: 1
            regExp: 6$
            # Add a Type of "Global"
            # Type;DeviceID;
          - type: leftConcat
            column: 1
            value: Global;
            # Add Marker to the End of the DeviceID
            # Type;DeviceID;
          - type: rightConcat
            column: 2
            value: _MSHW
            # Remove the last digit (the type of sensor) to leave just the system ID
            # Type;DeviceID;
          - type: replace
            column: 2
            existingValue: .6_MSHW
            newValue: ""
      mapping:
        # Instance Table
        # Type;DeviceID;
        source: $monitors.robotics.discovery.sources.source(1)$
        attributes:
          id: $column(2)
          __display_id: $column(1)
          hw.parent.type: enclosure
          name: "sprintf(\"%s, $column(2))"
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \t\tGlobal RAS SNMP table\nDeviceID;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: "ID,2"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
            # Add Marker to the End of the DeviceID
            # DeviceID;PATROLStatus;StatusInformation;
          - type: rightConcat
            column: 1
            value: _MSHW
            # Remove the last digit (the type of sensor) to leave just the system ID
            # DeviceID;PATROLStatus;StatusInformation;
          - type: replace
            column: 1
            existingValue: .6_MSHW
            newValue: ""
      mapping:
        # Value Table
        # DeviceID;PATROLStatus;StatusInformation;
        source: $monitors.robotics.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.status{hw.type="robotics"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  other_device:
    discovery:
      sources:
        source(1):
          # Source(1) = \tGlobal RAS SNMP table\nDeviceID;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: ID
          computes:
            # Keep only the correct type of group
            # DeviceID;
          - type: keepOnlyMatchingLines
            column: 1
            regExp: 2$
            # Add a Type of "Global"
            # Type;DeviceID;
          - type: leftConcat
            column: 1
            value: Control System;
            # Add a DisplayID
            # Type;DeviceID;DisplayID;
          - type: rightConcat
            column: 2
            value: ;Global
        source(2):
          # Source(2) = \tComponent Table\nType;DeviceID;DisplayID;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.30.10.1
          selectColumns: "3,ID,5"
        source(3):
          # Union of 1 & 2
          # Type;DeviceID;DisplayID;
          type: tableUnion
          tables:
          - $monitors.other_device.discovery.sources.source(1)$
          - $monitors.other_device.discovery.sources.source(2)$
      mapping:
        # Instance Table
        # Type;DeviceID;DisplayID;
        source: $monitors.other_device.discovery.sources.source(3)$
        attributes:
          id: $column(2)
          __display_id: $column(3)
          device_type: $column(1)
          hw.parent.type: enclosure
          name: "sprintf(\"%s: %s\", $column(1), $column(3))"
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \t\tGlobal RAS SNMP table\nDeviceID;Status;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.20.100.10.1
          selectColumns: "ID,2"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
        source(2):
          # Source(2) = \tComponent Table\nDeviceID;Status
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.30.10.1
          selectColumns: "ID,8"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;
          - type: translate
            column: 2
            translationTable: EnclosureStatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;
          - type: translate
            column: 3
            translationTable: EnclosureStatusInformationTranslationTable
        source(3):
          # Union of 1 & 2
          # DeviceID;PATROLStatus;StatusInformation;
          type: tableUnion
          tables:
          - $monitors.other_device.collect.sources.source(1)$
          - $monitors.other_device.collect.sources.source(2)$
      mapping:
        # Value Table
        # DeviceID;PATROLStatus;StatusInformation;
        source: $monitors.other_device.collect.sources.source(3)$
        deviceId: $column(1)
        metrics:
          hw.status{hw.type="other_device"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  voltage:
    discovery:
      sources:
        source(1):
          # Voltage\nSource(1) = \tVoltage Table\nDeviceID;Name;WarningLow;WarningHigh;location
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.20.1
          selectColumns: "ID,2,8,9,10"
          computes:
            # Add a space and the Location to the Name
            # DeviceID;Name;WarningLow;WarningHigh;location
          - type: rightConcat
            column: 2
            value: ' '
          - type: rightConcat
            column: 2
            value: Column(5)
            # Remove Voltage and Sensor from the Name
            # DeviceID;Name;WarningLow;WarningHigh;location
          - type: replace
            column: 2
            existingValue: voltage
            newValue: ""
          - type: replace
            column: 2
            existingValue: ' Sensor'
            newValue: ""
          - _comment: DeviceID;Type;WarningLow;WarningHigh;location
            type: awk
            script: EmbeddedFile(2)
      mapping:
        # Here is the instance table = source(1)
        # DeviceID;Type;WarningLow;WarningHigh;location
        source: $monitors.voltage.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          __display_id: $column(2)
          hw.parent.type: enclosure
          name: $column(2)
        metrics:
          hw.voltage.limit{limit_type="high.degraded"}: $column(4)
          hw.voltage.limit{limit_type="low.critical"}: $column(3)
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \tVoltage Table\nDeviceID;Status;Voltage;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.20.1
          selectColumns: "ID,3,4"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;Voltage;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;Voltage;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;Voltage;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
      mapping:
        _comment: ValueTable = Source(1)
        source: $monitors.voltage.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.voltage: $column(4)
          hw.status{hw.type="voltage"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  temperature:
    discovery:
      sources:
        source(1):
          # Source(1) = \tTemperature Table\nDeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.30.1
          selectColumns: "ID,2,3,4,6,8,9"
          computes:
            # Exclude Sensors with a Status of "7" (No Data)
            # DeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;Location;
          - type: excludeMatchingLines
            column: 3
            valueList: 7
            # Remove Thresholds of Zero
            # DeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;Location;
          - type: leftConcat
            column: 5
            value: MSHW_
          - type: leftConcat
            column: 6
            value: MSHW_
          - type: replace
            column: 5
            existingValue: MSHW_0
            newValue: ""
          - type: replace
            column: 6
            existingValue: MSHW_0
            newValue: ""
          - _comment: Remove MSHW_ for non blank / non zero values
            type: replace
            column: 5
            existingValue: MSHW_
            newValue: ""
          - type: replace
            column: 6
            existingValue: MSHW_
            newValue: ""
            # Add a space and the Location to the Name
            # DeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;Location;
          - type: rightConcat
            column: 2
            value: ' '
          - type: rightConcat
            column: 2
            value: Column(7)
            # Remove Voltage and Sensor from the Name
            # DeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;Location;
          - type: replace
            column: 2
            existingValue: temperature
            newValue: ""
          - type: replace
            column: 2
            existingValue: ' Sensor'
            newValue: ""
      mapping:
        # Here is the instance table = source(1)
        # DeviceID;Name;Status;Temperature;NominalHigh;WarningHigh;
        source: $monitors.temperature.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          __display_id: $column(2)
          hw.parent.type: enclosure
          name: $column(2)
        metrics:
          hw.temperature.limit{limit_type="high.critical"}: $column(5)
          hw.temperature.limit{limit_type="high.degraded"}: $column(6)
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \tTemperature Table\nDeviceID;Status;Temperature;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.30.1
          selectColumns: "ID,3,4"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;Temperature;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;Temperature;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;Temperature;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
      mapping:
        _comment: ValueTable = Source(1)
        source: $monitors.temperature.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.temperature: $column(4)
          hw.status{hw.type="temperature"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
  fan:
    discovery:
      sources:
        source(1):
          # Fan\nSource(1) = \tFan Table\nDeviceID;Type;Status;Speed;NominalLow;WarningLow;Location;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.40.1
          selectColumns: "ID,2,3,4,5,7,9"
          computes:
            # Exclude Sensors with a Status of "7" (No Data)
            # DeviceID;Type;Status;Speed;NominalLow;WarningLow;
          - type: excludeMatchingLines
            column: 3
            valueList: 7
            # Remove Thresholds of Zero
            # DeviceID;Type;Status;Speed;NominalLow;WarningLow;Location;
          - type: leftConcat
            column: 5
            value: MSHW_
          - type: leftConcat
            column: 6
            value: MSHW_
          - type: replace
            column: 5
            existingValue: MSHW_0
            newValue: ""
          - type: replace
            column: 6
            existingValue: MSHW_0
            newValue: ""
          - _comment: Remove MSHW_ for non blank / non zero values
            type: replace
            column: 5
            existingValue: MSHW_
            newValue: ""
          - type: replace
            column: 6
            existingValue: MSHW_
            newValue: ""
            # Add a space and the Location to the Name
            # DeviceID;Type;Status;Speed;NominalLow;WarningLow;Location;
          - type: rightConcat
            column: 2
            value: ' '
          - type: rightConcat
            column: 2
            value: Column(7)
            # Remove Voltage and Sensor from the Name
            # DeviceID;Type;Status;Speed;NominalLow;WarningLow;Location;
          - type: replace
            column: 2
            existingValue: fan
            newValue: ""
          - type: replace
            column: 2
            existingValue: ' Sensor'
            newValue: ""
      mapping:
        # Here is the instance table = source(1)
        # DeviceID;Type;Status;Speed;NominalLow;WarningLow;
        source: $monitors.fan.discovery.sources.source(1)$
        attributes:
          id: $column(1)
          __display_id: $column(2)
          hw.parent.type: enclosure
          name: $column(2)
        metrics:
          hw.fan.speed.limit{limit_type="low.critical"}: $column(5)
          hw.fan.speed.limit{limit_type="low.degraded"}: $column(6)
    collect:
      type: multiInstance
      sources:
        source(1):
          # Source(1) = \tFan Table\nDeviceID;Status;Speed;
          type: snmpTable
          oid: 1.3.6.1.4.1.3764.1.1.200.200.40.1
          selectColumns: "ID,3,4"
          computes:
            # Duplicate status, because we will translate it two times
            # DeviceID;Status;Status;Speed;
          - type: duplicateColumn
            column: 2
            # Translate Status into PATROLStatus
            # DeviceID;PATROLStatus;Status;Speed;
          - type: translate
            column: 2
            translationTable: StatusTranslationTable
            # Translate second Status into more readable string
            # DeviceID;PATROLStatus;StatusInformation;Speed;
          - type: translate
            column: 3
            translationTable: StatusInformationTranslationTable
      mapping:
        _comment: ValueTable = Source(1)
        source: $monitors.fan.collect.sources.source(1)$
        deviceId: $column(1)
        metrics:
          hw.fan.speed: $column(4)
          hw.status{hw.type="fan"}: $column(2)
        legacyTextParameters:
          StatusInformation: $column(3)
