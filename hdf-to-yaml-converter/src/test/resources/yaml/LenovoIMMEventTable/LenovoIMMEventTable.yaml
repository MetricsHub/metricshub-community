---
connector:
  displayName: Lenovo IMM Event Monitoring (SNMP)
  platforms: Lenovo
  reliesOn: Lenovo IMM's SNMP Service
  version: 1.0
  information: This connector provides hardware monitoring through Lenovo's IMM management card.  It supplements the active monitoring of the Lenovo IMM connector by parsing the Event Log.  This allows older IBM xSeries systems to be fully monitored via their IMM.
  detection:
    connectionTypes:
    - remote
    - local
    appliesTo:
    - OOB
    criteria:
      # Detection
      # Check that the log table is available
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.2.3.51.3.2.1.1.1
monitors:
  other_device:
    discovery:
      sources:
        source(1):
          # Get the current time
          type: snmpGet
          oid: 1.3.6.1.2.1.25.1.2.0
          computes:
          # Add an Identifier
          - type: leftConcat
            column: 1
            value: CurrentDate;
        source(2):
          # This is used for Event Monitoring
          # EventID;EventString;EventSeverity;EventDate;
          type: snmpTable
          oid: 1.3.6.1.4.1.2.3.51.3.2.1.1.1
          selectColumns: "1,2,3,4"
          computes:
          # Replace \" with 
          - type: replace
            column: 2
            existingValue: \"
            newValue: '"'
        source(3):
          # Union 1 and 2
          type: tableUnion
          tables:
          - "${source::monitors.other_device.discovery.sources.source(1)}"
          - "${source::monitors.other_device.discovery.sources.source(2)}"
          computes:
            # Process the log file through an awk script
            # MSHW;ID;Status;StatusInformation;
          - type: awk
            script: "${file::embeddedFile-1}"
            keep: ^MSHW;
            separators: ;
      mapping:
        # The Instance Table
        source: "${source::monitors.other_device.discovery.sources.source(3)}"
        attributes:
          id: $2
          __display_id: EventLog (Hourly Collect)
          hw.parent.type: enclosure
          name: EventLog (Hourly Collect)
    collect:
      sources:
        source(1):
          # Copy the Discovery
          type: copy
          from: "${source::monitors.other_device.discovery.sources.source(3)}"
      mapping:
        # ValueTable = Source(1)
        # MSHW;ID;Status;StatusInformation;
        source: "${source::monitors.other_device.collect.sources.source(1)}"
        attributes:
          id: $2
        metrics:
          hw.status{hw.type="other_device"}: $3
        legacyTextParameters:
          StatusInformation: $4
