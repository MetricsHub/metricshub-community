---
connector:
  displayName: Oracle/Sun InfiniBand DCS Switch (Ports)
  platforms: Oracle/Sun Infiniband DCS
  reliesOn: Oracle/Sun ILOM SNMP Agent
  version: 1.0
  information: This connector provides hardware monitoring for Oracle/Sun InfiniBand DCS switches via SNMP
  detection:
    connectionTypes:
    - remote
    appliesTo:
    - Storage
    - Network
    criteria:
    # Need a DCS Ports OID
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
monitors:
  network:
    discovery:
      sources:
        source(1):
          # Source(1) = ibSmaPortInfoEntry SNMP Table
          # PortID;WidthActive;PhysState;Speed;
          type: snmpTable
          oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
          selectColumns: "ID,5,7,10"
          computes:
            # Translate WidthActive
            # PortID;WidthActive;PhysState;Speed;
          - type: translate
            column: 2
            translationTable: "${translation::WidthActiveTranslationTable}"
            # Exclude disabled ports
            # PortID;WidthActive;PhysState;Speed;
          - type: excludeMatchingLines
            column: 3
            valueList: 3
            # Translate Speed
            # PortID;WidthActive;PhysState;Speed;
          - type: translate
            column: 4
            translationTable: "${translation::SpeedTranslationTable}"
      mapping:
        # Instance Table
        # PortID;WidthActive;PhysState;Speed;
        source: "${source::monitors.network.discovery.sources.source(1)}"
        attributes:
          id: $1
          __display_id: $1
          device_type: $2
          hw.parent.type: enclosure
          name: "${awk::sprintf(\"%s (%s)\", $1, $2)}"
    collect:
      # Collect type = multi-instance
      type: multiInstance
      sources:
        source(1):
          # Source(1) = ibSmaPortInfoEntry SNMP Table
          # PortID;WidthActive;LinkState;Speed;
          type: snmpTable
          oid: 1.3.6.1.4.1.42.2.135.2.2.5.1.1
          selectColumns: "ID,5,6,10"
          computes:
            # Need to Add ibPmaExtPortCntrsEntry  and  ibPmaPortCntrsTable when SNMP v2 is available.
            # Translate Speed
            # PortID;WidthActive;LinkState;Speed;
          - type: translate
            column: 4
            translationTable: "${translation::SpeedTranslationTable}"
            # Translate LinkState
            # PortID;WidthActive;LinkState;Speed;
          - type: translate
            column: 3
            translationTable: "${translation::LinkStateTranslationTable}"
      mapping:
        # ValueTable
        # PortID;WidthActive;LinkState;Speed;
        source: "${source::monitors.network.collect.sources.source(1)}"
        deviceId: $1
        metrics:
          hw.network.up: legacyLinkStatus($3)
          hw.network.bandwidth.limit: megaBit2Bit($4)
translations:
  LinkStateTranslationTable:
    "1": degraded
    "2": ok
    "3": ok
    "4": ok
    Default: ""
  SpeedTranslationTable:
    "1": 2500
    "2": 5000
    "4": 10000
    "8": 30000
    Default: ""
  WidthActiveTranslationTable:
    "1": IB Port 1x
    "2": IB Port 4x
    "4": IB Port 8x
    "8": IB Port 12x
    Default: ""
