BEGIN {tableValid = ""}
$1 ~ /MS_HW_SYSTEM_START/  { systemName = $2 }
# Lightning 9500
$0 ~ /Unit +No. +HDU +No. +Type +Physics +Status/ {tableValid = "9500"}
$0 ~ /Unit +HDU +Type +Status/ {tableValid = "AMS500"}
# AMS 500
$1 ~ /MS_HW_SYSTEM_END/  { if (tableValid == "") {print "No valid table format found"}
                                 else {print "Valid table format found for: " systemName " Type: " tableValid }
                             systemName = "" ; tableValid = ""
                           }

$1 ~ /^[0-9]+$/ && $2 ~ /^[0-9]+$/ && tableValid != "" {
    if (tableValid == "9500") {
        Unit = $1
        HDU = $2 ;
        StatusInformation = $0 ;
        Status = $5 ;
        }
    if (tableValid == "AMS500") {
        Unit = $1
        HDU = $2 ;
        StatusInformation = $0 ;
        Status = $4 ;
        }
    gsub (/^.*[0-9]+ +[0-9]+ +/,"",StatusInformation)
    gsub (/  +/," ",StatusInformation)
    if (Status ~ /100%/) {Status = "Normal"}
        else if (Status ~ /[0-9][0-9]%/) {Status = "Rebuilding"}
#     Watch out - Identifiers must match between the audrive vendor script (discovery) and the audrive status awk script (collect)
    DeviceID = systemName ".Unit-" Unit ".HDU-" HDU  ;
# MSHW;DeviceID;Status;StatusInformation;
    print "MSHW;" DeviceID ";" Status ";" StatusInformation ";"
    }