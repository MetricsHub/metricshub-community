BEGIN {tableValid = ""}
$1 ~ /MS_HW_SYSTEM_START/  { systemName = $2 }
# HUS110
$0 ~ /Group  Level +Groups +Type +Speed +Encryption +Total +Capacity +Free +Capacity +Priority +Status +Reconstruction +Progress/ {
    tableValid = "HUS110"
    statusStartIndex = index($0,"Status"); statusEndIndex = index($0,"Reconstruction");
    }

# HUS130
$0 ~ /Group  Level +Groups +Type +Speed +Total +Capacity +Free +Capacity +Priority +Status +Reconstruction +Progress/ {
    tableValid = "HUS130"
    statusStartIndex = index($0,"Status"); statusEndIndex = index($0,"Reconstruction");
    }


# AMS2100
$0 ~ /Group +Level +Groups +Type +Total +Capacity +Free +Capacity +Priority +Status +Reconstruction +Progress/ {
    tableValid = "AMS2100"
    statusStartIndex = index($0,"Status"); statusEndIndex = index($0,"Reconstruction");
    }



$1 ~ /MS_HW_SYSTEM_END/  { if (tableValid == "") {print "No valid table format found"}
                                 else {print "Valid table format found for: " systemName " Type: " tableValid  }
                             systemName = "" ; tableValid = ""
                           }

$1 ~ /^[0-9]+$/ && $2 ~ /^[0-9]+/ && tableValid != "" {
    if (tableValid == "HUS110") {
        RG = $1
        Capacity = $8 ; CapacityGB = Capacity / 1024 ;
        CapacityFree = $10 ; CapacityFreeGB = CapacityFree / 1024 ;
        StripeSize = "" ;
        RAIDGroup = ""
        RaidLevel = $2 $3
        DiskType = $5
        Status = substr($0,statusStartIndex,statusEndIndex-statusStartIndex);
        }
    if (tableValid == "HUS130") {
        RG = $1
        Capacity = $7 ; CapacityGB = Capacity / 1024 ;
        CapacityFree = $9 ; CapacityFreeGB = CapacityFree / 1024 ;
        StripeSize = "" ;
        RAIDGroup = ""
        RaidLevel = $2 $3
        DiskType = $5
        Status = substr($0,statusStartIndex,statusEndIndex-statusStartIndex);
        }
    if (tableValid == "AMS2100") {
        RG = $1
        Capacity = $6 ; CapacityGB = Capacity / 1024 ;
        CapacityFree = $8 ; CapacityFreeGB = CapacityFree / 1024 ;
        StripeSize = "" ;
        RAIDGroup = ""
        RaidLevel = $2 $3
        DiskType = $5
        Status = substr($0,statusStartIndex,statusEndIndex-statusStartIndex);
        }
    gsub (/^ +/,"",Status);gsub (/ +$/,"",Status);
    StatusInformation = Status
    DeviceID = systemName ".RG-" RG ; DisplayID = "RG-" RG
# MUST MATCH EF6 (Volumes)
# MSHW;systemName;DeviceID;DisplayID;CapacityGB;StripeSize;RAIDGroup;RaidLevel;DiskType;Status;StatusInformation;LogicalDiskType;UseInCapacity;CapacityFreeGB;
    print "MSHW;" systemName";" DeviceID ";" DisplayID ";" CapacityGB ";" StripeSize ";" RAIDGroup ";" RaidLevel ";" DiskType ";" Status ";" StatusInformation ";RaidGroup;1;" CapacityFreeGB ";"
    }