function power(x, n) {
    r = 1;
    #Convert n to integer because if it's a negative value, java considere it as a string (I think :-) )
    n=n*1
    if (n > 0) { for (i = 0; i < n; i++) { r = r * x; } }
    if (n < 0) { for (i = 0; i > n; i--) { r = r / x; } }
    return r;
}

BEGIN { DeviceID = ""; WarningThreshold = ""; OperationalStatus=""; Temperature = ""; Name = ""; }
($2 == "(temperature-sensor,") { DeviceID = substr($3, 1, length($3) - 1); }
($1 == ":HighWarningThreshold") { WarningThreshold = $2 }
($1 == ":OperationalStatus") { OperationalStatus = $2 }
($1 == ":Temperature") { Temperature = $2 }
($1 == ":Exponent") { Exponent = $2 }
($1 == ":name") {
    Name = $2;

    if (Temperature == "<ERROR:")
    {
        Temperature = "UNKNOWN";
    }

    if (WarningThreshold == "<ERROR:")
    {
        WarningThreshold = "";
    }
    if (Exponent ~ /^-?[0-9]+$/)
    {
        if (Temperature ~ /^-?[0-9]+$/) { Temperature = Temperature * power(10,Exponent); }
        if (WarningThreshold ~ /^-?[0-9]+$/) { WarningThreshold = WarningThreshold * power(10,Exponent); }
    }

    if ((DeviceID != "") && (OperationalStatus != "disabled")) {print "MSHW;" DeviceID ";" Name ";" WarningThreshold ";" Temperature ";"}

    DeviceID = ""; WarningThreshold = ""; OperationalStatus=""; Temperature = ""; Name = "";
}