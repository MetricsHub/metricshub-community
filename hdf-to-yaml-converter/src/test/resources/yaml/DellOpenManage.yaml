connector:
  displayName: Dell OpenManage Server Administrator
  platforms: Dell PowerEdge
  reliesOn: Dell OpenManage Server Administrator
  version:  1.0
  projectVersion: 1.0
  information: This connector provides hardware monitoring through the Dell OpenManage Server Administrator SNMP agent which supports almost all Dell PowerEdge servers.
  
  detection:
    connectionTypes: [remote, local]
    disableAutoDetection: false
    appliesTo: [ LINUX, NT ]
    supersedes: [IpmiTool, VMWareESX41, VMwareESXi, VMwareESXiDisksIPMI, VMwareESXiDisksStorage]
    criteria:
    - type: snmpGetNext
      oid: 1.3.6.1.4.1.674.10892.1.300.10.1

metrics:
  hw.energy:
    type: counter
    unit: J
    description: Energy consumption of the hardware component.
  hw.status:
    type:
      stateSet: [degraded, failed, ok]
      output: upDownCounter
    description: Hardware status of the hardware component.
      
monitors:
  enclosure:
    discovery:
      sources:
        source(1):
          # ID, Model, ServiceTag, ServiceCode
          type: snmpTable
          oid: 1.3.6.1.4.1.674.10892.1.300.10.1
          selectColumns: ID,9,11,49
          computes:
          - type: keepOnlyMatchingLines
            column: 1
            valueList: 1
          - type: leftConcat
            column: 3
            value: "Serial Number:"
          - type: leftConcat
            column: 4
            value: "Alternative Serial Number:"
        source(2):
          # ChassisIndex, SystemWattage
          type: snmpTable
          oid: 1.3.6.1.4.1.674.10892.1.600.60.1
          selectColumns: 1,7
        source(3):
          # ID, Model, ServiceTag, ServiceCode, ChassisIndex, SystemWattage
          type: tableJoin
          leftTable: $monitors.enclosure.discovery.sources.source(1)$
          rightTable: $monitors.enclosure.discovery.sources.source(2)$
          leftKeyColumn: 1
          rightKeyColumn: 1
          defaultRightLine: ;;
      mapping:
        source: $monitors.enclosure.discovery.sources.source(3)$
        attributes:
          name: concat(Computer, Dell, $column(2))
          id: buildId($column(1))
          vendor: Dell
          model: $column(2)
          info: concat($column(3), " - ", $column(4))
          type: Computer
        conditionalCollection:
          hw.enclosure.energy: $column(6)
    multiCollect:
      sources:
        source(1):
          # DeviceID, PATROLStatus, StatusInformation
          type: snmpTable
          oid: 1.3.6.1.4.1.674.10892.1.300.10.1
          selectColumns: ID,4
          computes:
          - type: duplicateColumn
            column: 2
          - type: translate
            column: 2
            translationTable: GenericStatusTranslationTable
          - type: translate
            column: 3
            translationTable: GenericStatusInformationTranslationTable
        source(2):
          # ChassisIndex, IntrusionStatus
          type: snmpTable
          oid: 1.3.6.1.4.1.674.10892.1.300.70.1
          selectColumns: 1,5
          computes:
          - type: translate
            column: 2
            translationTable: GenericStatusTranslationTable
        source(3):
          # DeviceID, PATROLStatus, StatusInformation, ChassisIndex, IntrusionStatus
          type: tableJoint
          leftTable: $monitors.enclosure.multiCollect.sources.source(1)$
          rightTable: $monitors.enclosure.multiCollect.sources.source(2)$
          leftKeyColumn: 1
          rightKeyColumn: 1
          defaultRightLine: ;;
        source(4):
          # ChassisIndex, EnergyUsage
          type: snmpTable
          oid: 1.3.6.1.4.1.674.10892.1.600.60.1
          selectColumns: 1,7
          computes:
          - type: divide
            column: 2
            value: 1000
        source(5):
          # DeviceID, PATROLStatus, StatusInformation, ChassisIndex, IntrusionStatus, ChassisIndex, EnergyUsage
          type: tableJoint
          leftTable: $monitors.enclosure.multiCollect.sources.source(3)$
          rightTable: $monitors.enclosure.multiCollect.sources.source(4)$
          leftKeyColumn: 1
          rightKeyColumn: 1
          defaultRightLine: ;;
      mapping:
        deviceId: $column(1)
        source: $monitors.enclosure.multiCollect.sources.source(5)$
        # DeviceID, PATROLStatus, StatusInformation, ChassisIndex, IntrusionStatus, ChassisIndex, EnergyUsage
        metrics:
          hw.status{hw.type="enclosure"}: $column(2)
          hw.status{hw.type="enclosure", state="open"}: LegacyIntrusionStatus($column(4))
          hw.statusInformation: $column(3)
          hw.enclosure.energy: $column(7)
          hw.enclosure.power: Rate($column)7))