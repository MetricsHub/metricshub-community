---
- name: discovery
  input: |
    // First HTTP Discovery Comment
    Enclosure.Discovery.Battery.Source(1).Type="HTTP"
    Enclosure.Discovery.Battery.Source(1).Method="GET"
    Enclosure.Discovery.Battery.Source(1).Url="url1"
    Enclosure.Discovery.Battery.Source(1).Header="header1"
    Enclosure.Discovery.Battery.Source(1).AuthenticationToken="token1"
    Enclosure.Discovery.Battery.Source(1).ResultContent="result1"
    Enclosure.Discovery.Battery.Source(1).ForceSerialization=1
    Enclosure.Discovery.Battery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(1)%
    Enclosure.Discovery.Battery.Source(1).EntryConcatMethod="Custom"
    Enclosure.Discovery.Battery.Source(1).ConcatStart="concatStart"
    Enclosure.Discovery.Battery.Source(1).ConcatEnd="concatEnd"

    // Second HTTP Discovery Comment
    Enclosure.Discovery.Battery.Source(2).Type="HTTP"
    Enclosure.Discovery.Battery.Source(2).Method="GET"
    Enclosure.Discovery.Battery.Source(2).Url="url2"
    Enclosure.Discovery.Battery.Source(2).Header="header2"
    Enclosure.Discovery.Battery.Source(2).AuthenticationToken="token2"
    Enclosure.Discovery.Battery.Source(2).ResultContent="result2"
    Enclosure.Discovery.Battery.Source(2).ForceSerialization=1
    Enclosure.Discovery.Battery.Source(2).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(2)%
    Enclosure.Discovery.Battery.Source(2).EntryConcatMethod="List"
  expected:
    monitors:
      battery:
        discovery:
          sources:
            source(1):
              _comment: First HTTP Discovery Comment
              type: http
              method: Get
              url: url1
              header: header1
              body: body1
              authenticationToken: token1
              resultContent: result1
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.discovery.sources.source(1)$
                concatMethod:
                  custom:
                    concatStart: concatStart
                    concatEnd: concatEnd
            source(2):
              _comment: Second HTTP Discovery Comment
              type: http
              method: Get
              url: url2
              header: header2
              body: body2
              authenticationToken: token2
              resultContent: result2
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.discovery.sources.source(2)$
                concatMethod: list

- name: collect
  input: |
    // First HTTP Collect Comment
    Enclosure.Collect.Battery.Source(1).Type="HTTP"
    Enclosure.Collect.Battery.Source(1).Method="GET"
    Enclosure.Collect.Battery.Source(1).Url="url1"
    Enclosure.Collect.Battery.Source(1).Header="header1"
    Enclosure.Collect.Battery.Source(1).AuthenticationToken="token1"
    Enclosure.Collect.Battery.Source(1).ResultContent="result1"
    Enclosure.Collect.Battery.Source(1).ForceSerialization=1
    Enclosure.Collect.Battery.Source(1).ExecuteForEachEntryOf=%Enclosure.Collect.Source(1)%
    Enclosure.Collect.Battery.Source(1).EntryConcatMethod="Custom"
    Enclosure.Collect.Battery.Source(1).ConcatStart="concatStart"
    Enclosure.Collect.Battery.Source(1).ConcatEnd="concatEnd"

    // Second HTTP Collect Comment
    Enclosure.Collect.Battery.Source(2).Type="HTTP"
    Enclosure.Collect.Battery.Source(2).Method="GET"
    Enclosure.Collect.Battery.Source(2).Url="url2"
    Enclosure.Collect.Battery.Source(2).Header="header2"
    Enclosure.Collect.Battery.Source(2).AuthenticationToken="token2"
    Enclosure.Collect.Battery.Source(2).ResultContent="result2"
    Enclosure.Collect.Battery.Source(2).ForceSerialization=1
    Enclosure.Collect.Battery.Source(2).ExecuteForEachEntryOf=%Enclosure.Collect.Source(2)%
    Enclosure.Collect.Battery.Source(2).EntryConcatMethod="List"
  expected:
    monitors:
      battery:
        collect:
          sources:
            source(1):
              _comment: First HTTP Collect Comment
              type: http
              method: Get
              url: url1
              header: header1
              body: body1
              authenticationToken: token1
              resultContent: result1
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.collect.sources.source(1)$
                concatMethod:
                  custom:
                    concatStart: concatStart
                    concatEnd: concatEnd
            source(2):
              _comment: Second HTTP Collect Comment
              type: http
              method: Get
              url: url2
              header: header2
              body: body2
              authenticationToken: token2
              resultContent: result2
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.collect.sources.source(2)$
                concatMethod: list