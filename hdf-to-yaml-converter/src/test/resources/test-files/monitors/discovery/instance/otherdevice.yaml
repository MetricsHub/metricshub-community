- name: testFull
  input: |
    // InstanceTable = Source(14)
    // Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
    // Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
    OtherDevice.Discovery.InstanceTable=%OtherDevice.Discovery.Source(14)%
    OtherDevice.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    OtherDevice.Discovery.Instance.DeviceType=InstanceTable.Column(1)
    OtherDevice.Discovery.Instance.AdditionalLabel=InstanceTable.Column(3)
    OtherDevice.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(4)
    OtherDevice.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(5)
    OtherDevice.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(6)
    OtherDevice.Discovery.Instance.ValueWarningThreshold="test"
    OtherDevice.Discovery.Instance.ValueAlarmThreshold="test2"
    OtherDevice.Discovery.Instance.UsageCountWarningThreshold="test3"
    OtherDevice.Discovery.Instance.UsageCountAlarmThreshold="test4"
    OtherDevice.Discovery.Instance.AttachedToDeviceID="DIR5"
    OtherDevice.Discovery.Instance.AttachedToDeviceType="Enclosure"
  expected:
    monitors:
      other_device:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(14)
              Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
              Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
            source: ${source::monitors.other_device.discovery.sources.source(14)}
            attributes:
              id: $2
              info: ${awk::join(" ", $4, $5, $6)}
              device_type: $1
              hw.parent.id: DIR5
              hw.parent.type: enclosure
              name: '${awk::sprintf("%s: %s (%s)", $1, $2, $3)}'
              additional_label: $3
            metrics:
              hw.other_device.value.limit{limit_type="degraded"}: test
              hw.other_device.value.limit{limit_type="critical"}: test2
              hw.other_device.uses.limit{limit_type="degraded"}: test3
              hw.other_device.uses.limit{limit_type="critical"}: test4
- name: testDefaultName
  input: |
    // InstanceTable = Source(14)
    // Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
    // Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
    OtherDevice.Discovery.InstanceTable=%OtherDevice.Discovery.Source(14)%
    OtherDevice.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    OtherDevice.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(4)
    OtherDevice.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(5)
    OtherDevice.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(6)
    OtherDevice.Discovery.Instance.ValueWarningThreshold="test"
    OtherDevice.Discovery.Instance.ValueAlarmThreshold="test2"
    OtherDevice.Discovery.Instance.UsageCountWarningThreshold="test3"
    OtherDevice.Discovery.Instance.UsageCountAlarmThreshold="test4"
    OtherDevice.Discovery.Instance.AttachedToDeviceID="DIR5"
    OtherDevice.Discovery.Instance.AttachedToDeviceType="Enclosure"
  expected:
    monitors:
      other_device:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(14)
              Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
              Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
            source: ${source::monitors.other_device.discovery.sources.source(14)}
            attributes:
              id: $2
              info: ${awk::join(" ", $4, $5, $6)}
              hw.parent.id: DIR5
              hw.parent.type: enclosure
              name: $2
            metrics:
              hw.other_device.value.limit{limit_type="degraded"}: test
              hw.other_device.value.limit{limit_type="critical"}: test2
              hw.other_device.uses.limit{limit_type="degraded"}: test3
              hw.other_device.uses.limit{limit_type="critical"}: test4
- name: testNoAdditionalLabel
  input: |
    // InstanceTable = Source(14)
    // Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
    // Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
    OtherDevice.Discovery.InstanceTable=%OtherDevice.Discovery.Source(14)%
    OtherDevice.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    OtherDevice.Discovery.Instance.DeviceType=InstanceTable.Column(1)
    OtherDevice.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(4)
    OtherDevice.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(5)
    OtherDevice.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(6)
    OtherDevice.Discovery.Instance.ValueWarningThreshold="test"
    OtherDevice.Discovery.Instance.ValueAlarmThreshold="test2"
    OtherDevice.Discovery.Instance.UsageCountWarningThreshold="test3"
    OtherDevice.Discovery.Instance.UsageCountAlarmThreshold="test4"
    OtherDevice.Discovery.Instance.AttachedToDeviceID="DIR5"
    OtherDevice.Discovery.Instance.AttachedToDeviceType="Enclosure"
  expected:
    monitors:
      other_device:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(14)
              Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
              Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
            source: ${source::monitors.other_device.discovery.sources.source(14)}
            attributes:
              id: $2
              info: ${awk::join(" ", $4, $5, $6)}
              device_type: $1
              hw.parent.id: DIR5
              hw.parent.type: enclosure
              name: '${awk::sprintf("%s: %s", $1, $2)}'
            metrics:
              hw.other_device.value.limit{limit_type="degraded"}: test
              hw.other_device.value.limit{limit_type="critical"}: test2
              hw.other_device.uses.limit{limit_type="degraded"}: test3
              hw.other_device.uses.limit{limit_type="critical"}: test4

- name: testNoDeviceTypeButAdditionalLabel
  input: |
    // InstanceTable = Source(14)
    // Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
    // Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
    OtherDevice.Discovery.InstanceTable=%OtherDevice.Discovery.Source(14)%
    OtherDevice.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    OtherDevice.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(4)
    OtherDevice.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(5)
    OtherDevice.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(6)
    OtherDevice.Discovery.Instance.ValueWarningThreshold="test"
    OtherDevice.Discovery.Instance.ValueAlarmThreshold="test2"
    OtherDevice.Discovery.Instance.UsageCountWarningThreshold="test3"
    OtherDevice.Discovery.Instance.UsageCountAlarmThreshold="test4"
    OtherDevice.Discovery.Instance.AttachedToDeviceID="DIR5"
    OtherDevice.Discovery.Instance.AttachedToDeviceType="Enclosure"
    OtherDevice.Discovery.Instance.AdditionalLabel=InstanceTable.Column(3)
  expected:
    monitors:
      other_device:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(14)
              Type;Slot           ;ProductName         ;PartNumber  ;Serial;Model;
              Type;PartitionNumber;PrimaryOtherDeviceID;BladeDevices;      ;     ;
            source: ${source::monitors.other_device.discovery.sources.source(14)}
            attributes:
              id: $2
              info: ${awk::join(" ", $4, $5, $6)}
              hw.parent.id: DIR5
              hw.parent.type: enclosure
              name: ${awk::sprintf("%s (%s)", $2, $3)}
              additional_label: $3
            metrics:
              hw.other_device.value.limit{limit_type="degraded"}: test
              hw.other_device.value.limit{limit_type="critical"}: test2
              hw.other_device.uses.limit{limit_type="degraded"}: test3
              hw.other_device.uses.limit{limit_type="critical"}: test4