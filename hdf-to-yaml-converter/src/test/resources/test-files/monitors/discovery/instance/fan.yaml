- name: test1
  input: |
    // Fan
    //tableID;ID;DisplayName;objectType;currentRpm;lowerNormalThreshold;lowerWarningThreshold;statusactivation;controllerID;devicetype
    Fan.Discovery.InstanceTable=%Fan.Discovery.Source(4)%
    Fan.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    Fan.Discovery.Instance.DisplayID=InstanceTable.Column(3)
    Fan.Discovery.Instance.WarningThreshold=InstanceTable.Column(6)
    Fan.Discovery.Instance.AlarmThreshold=InstanceTable.Column(7)
    Fan.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(9)
    Fan.Discovery.Instance.AttachedToDeviceType=InstanceTable.Column(10)
  expected:
    monitors:
      fan:
        discovery:
          mapping:
            _comment: |-
              Fan
              tableID;ID;DisplayName;objectType;currentRpm;lowerNormalThreshold;lowerWarningThreshold;statusactivation;controllerID;devicetype
            source: $monitors.fan.discovery.sources.source(4)$
            attributes:
              id: $column(2)
              __display_id: $column(3)
              hw.parent.type: $column(10)
              hw.parent.id: $column(9)
              name: $column(3)
            metrics:
              hw.fan.speed.limit{limit_type="low.degraded"}: $column(6)
              hw.fan.speed.limit{limit_type="low.critical"}: $column(7)
- name: testFanTypePresent
  input: |
    // Fan
    //tableID;ID;DisplayName;objectType;currentRpm;lowerNormalThreshold;lowerWarningThreshold;statusactivation;controllerID;devicetype
    Fan.Discovery.InstanceTable=%Fan.Discovery.Source(4)%
    Fan.Discovery.Instance.DeviceID=InstanceTable.Column(2)
    Fan.Discovery.Instance.DisplayID=InstanceTable.Column(3)
    Fan.Discovery.Instance.WarningThreshold=InstanceTable.Column(6)
    Fan.Discovery.Instance.AlarmThreshold=InstanceTable.Column(7)
    Fan.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(9)
    Fan.Discovery.Instance.AttachedToDeviceType=InstanceTable.Column(10)
    Fan.Discovery.Instance.FanType=InstanceTable.Column(11)
  expected:
    monitors:
      fan:
        discovery:
          mapping:
            _comment: |-
              Fan
              tableID;ID;DisplayName;objectType;currentRpm;lowerNormalThreshold;lowerWarningThreshold;statusactivation;controllerID;devicetype
            source: $monitors.fan.discovery.sources.source(4)$
            attributes:
              id: $column(2)
              __display_id: $column(3)
              hw.parent.type: $column(10)
              hw.parent.id: $column(9)
              name: sprintf("%s (%s)", $column(3), $column(11))
              sensor_location: $column(11)
            metrics:
              hw.fan.speed.limit{limit_type="low.degraded"}: $column(6)
              hw.fan.speed.limit{limit_type="low.critical"}: $column(7)