- name: test1
  input: |
    // InstanceTable = Source(1)
    // DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
    CPU.Discovery.InstanceTable=%CPU.Discovery.Source(4)%
    CPU.Discovery.Instance.DeviceID=InstanceTable.Column(1)
    CPU.Discovery.Instance.DisplayID=InstanceTable.Column(2)
    CPU.Discovery.Instance.Vendor=InstanceTable.Column(5)
    CPU.Discovery.Instance.Model=InstanceTable.Column(3)
    CPU.Discovery.Instance.MaximumSpeed=InstanceTable.Column(4)
    CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(7)
    CPU.Discovery.Instance.MaxPowerConsumption=InstanceTable.Column(8)
    CPU.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(9)
    CPU.Discovery.Instance.CorrectedErrorWarningThreshold=InstanceTable.Column(10)
    CPU.Discovery.Instance.CorrectedErrorAlarmThreshold=InstanceTable.Column(11)
  expected:
    monitors:
      cpu:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(1)
              DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
            source: ${source::monitors.cpu.discovery.sources.source(4)}
            attributes:
              id: $1
              __display_id: $2
              hw.parent.id: $7
              hw.parent.type: enclosure
              vendor: $5
              model: $3
              info: $9
              name: ${awk::sprintf("%s (%s - %s - %s)", $2, $5, $3, megaHertz2HumanFormat($4))}
            metrics:
              hw.cpu.speed.limit{limit_type="max"}: megaHertz2Hertz($4)
              hw.power.limit{hw.type="cpu"}: $8
              hw.errors.limit{hw.type="cpu", limit_type="degraded"}: $10
              hw.errors.limit{hw.type="cpu", limit_type="critical"}: $11
- name: testNameNoDisplayId
  input: |
    // InstanceTable = Source(1)
    // DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
    CPU.Discovery.InstanceTable=%CPU.Discovery.Source(4)%
    CPU.Discovery.Instance.DeviceID=InstanceTable.Column(1)
    CPU.Discovery.Instance.Vendor=InstanceTable.Column(5)
    CPU.Discovery.Instance.Model=InstanceTable.Column(3)
    CPU.Discovery.Instance.MaximumSpeed=InstanceTable.Column(4)
    CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(7)
    CPU.Discovery.Instance.MaxPowerConsumption=InstanceTable.Column(8)
    CPU.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(9)
    CPU.Discovery.Instance.CorrectedErrorWarningThreshold=InstanceTable.Column(10)
    CPU.Discovery.Instance.CorrectedErrorAlarmThreshold=InstanceTable.Column(11)
  expected:
    monitors:
      cpu:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(1)
              DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
            source: ${source::monitors.cpu.discovery.sources.source(4)}
            attributes:
              id: $1
              hw.parent.id: $7
              hw.parent.type: enclosure
              vendor: $5
              model: $3
              info: $9
              name: ${awk::sprintf("%s (%s - %s - %s)", $1, $5, $3, megaHertz2HumanFormat($4))}
            metrics:
              hw.cpu.speed.limit{limit_type="max"}: megaHertz2Hertz($4)
              hw.power.limit{hw.type="cpu"}: $8
              hw.errors.limit{hw.type="cpu", limit_type="degraded"}: $10
              hw.errors.limit{hw.type="cpu", limit_type="critical"}: $11
- name: testNameNoVendor
  input: |
    // InstanceTable = Source(1)
    // DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
    CPU.Discovery.InstanceTable=%CPU.Discovery.Source(4)%
    CPU.Discovery.Instance.DeviceID=InstanceTable.Column(1)
    CPU.Discovery.Instance.DisplayID=InstanceTable.Column(2)
    CPU.Discovery.Instance.Model=InstanceTable.Column(3)
    CPU.Discovery.Instance.MaximumSpeed=InstanceTable.Column(4)
    CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(7)
    CPU.Discovery.Instance.MaxPowerConsumption=InstanceTable.Column(8)
    CPU.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(9)
    CPU.Discovery.Instance.CorrectedErrorWarningThreshold=InstanceTable.Column(10)
    CPU.Discovery.Instance.CorrectedErrorAlarmThreshold=InstanceTable.Column(11)
  expected:
    monitors:
      cpu:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(1)
              DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
            source: ${source::monitors.cpu.discovery.sources.source(4)}
            attributes:
              id: $1
              __display_id: $2
              hw.parent.id: $7
              hw.parent.type: enclosure
              model: $3
              info: $9
              name: ${awk::sprintf("%s (%s - %s)", $2, $3, megaHertz2HumanFormat($4))}
            metrics:
              hw.cpu.speed.limit{limit_type="max"}: megaHertz2Hertz($4)
              hw.power.limit{hw.type="cpu"}: $8
              hw.errors.limit{hw.type="cpu", limit_type="degraded"}: $10
              hw.errors.limit{hw.type="cpu", limit_type="critical"}: $11
- name: testNameNoVendorNoModel
  input: |
    // InstanceTable = Source(1)
    // DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
    CPU.Discovery.InstanceTable=%CPU.Discovery.Source(4)%
    CPU.Discovery.Instance.DeviceID=InstanceTable.Column(1)
    CPU.Discovery.Instance.DisplayID=InstanceTable.Column(2)
    CPU.Discovery.Instance.MaximumSpeed=InstanceTable.Column(4)
    CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(7)
    CPU.Discovery.Instance.MaxPowerConsumption=InstanceTable.Column(8)
    CPU.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(9)
    CPU.Discovery.Instance.CorrectedErrorWarningThreshold=InstanceTable.Column(10)
    CPU.Discovery.Instance.CorrectedErrorAlarmThreshold=InstanceTable.Column(11)
  expected:
    monitors:
      cpu:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(1)
              DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
            source: ${source::monitors.cpu.discovery.sources.source(4)}
            attributes:
              id: $1
              __display_id: $2
              hw.parent.id: $7
              hw.parent.type: enclosure
              info: $9
              name: ${awk::sprintf("%s (%s)", $2, megaHertz2HumanFormat($4))}
            metrics:
              hw.cpu.speed.limit{limit_type="max"}: megaHertz2Hertz($4)
              hw.power.limit{hw.type="cpu"}: $8
              hw.errors.limit{hw.type="cpu", limit_type="degraded"}: $10
              hw.errors.limit{hw.type="cpu", limit_type="critical"}: $11
- name: testNameNoVendorNoModelNoMaxSpeed
  input: |
    // InstanceTable = Source(1)
    // DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
    CPU.Discovery.InstanceTable=%CPU.Discovery.Source(4)%
    CPU.Discovery.Instance.DeviceID=InstanceTable.Column(1)
    CPU.Discovery.Instance.DisplayID=InstanceTable.Column(2)
    CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(7)
    CPU.Discovery.Instance.MaxPowerConsumption=InstanceTable.Column(8)
    CPU.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(9)
    CPU.Discovery.Instance.CorrectedErrorWarningThreshold=InstanceTable.Column(10)
    CPU.Discovery.Instance.CorrectedErrorAlarmThreshold=InstanceTable.Column(11)
  expected:
    monitors:
      cpu:
        discovery:
          mapping:
            _comment: |-
              InstanceTable = Source(1)
              DN;RN;Model;Speed;Vendor;OperState;attachedDeviceID;DN
            source: ${source::monitors.cpu.discovery.sources.source(4)}
            attributes:
              id: $1
              __display_id: $2
              hw.parent.id: $7
              hw.parent.type: enclosure
              info: $9
              name: $2
            metrics:
              hw.power.limit{hw.type="cpu"}: $8
              hw.errors.limit{hw.type="cpu", limit_type="degraded"}: $10
              hw.errors.limit{hw.type="cpu", limit_type="critical"}: $11