- name: test1ControllerNumber
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Model=InstanceTable.Column(1)
    Battery.Discovery.Instance.Vendor="APC"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.ControllerNumber=InstanceTable.Column(2)
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(6)
    Battery.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(7)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              vendor: APC
              type: UPS
              id: bat
              model: $1
              chemistry: LiFePO4
              hw.parent.type: disk_controller
              hw.parent.id: lookup("disk_controller", "id", "controller_number", $2)
              __display_id: testname
              info: ${awk::join(" ", $5, $6, $7)}
              name: ${awk::sprintf("%s (%s %s - %s)", "testname", "APC", $1, "UPS")}
- name: test2AttachedToDeviceIdAndType
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Model=InstanceTable.Column(1)
    Battery.Discovery.Instance.Vendor="APC"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(6)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
    Battery.Discovery.Instance.AttachedToDeviceType=InstanceTable.Column(4)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              vendor: APC
              type: UPS
              id: bat
              model: $1
              chemistry: LiFePO4
              hw.parent.type: $4
              hw.parent.id: $3
              __display_id: testname
              info: ${awk::join(" ", $5, $6)}
              name: ${awk::sprintf("%s (%s %s - %s)", "testname", "APC", $1, "UPS")}
- name: test3AttachedToDeviceIdOnly
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Model=InstanceTable.Column(1)
    Battery.Discovery.Instance.Vendor="APC"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              vendor: APC
              type: UPS
              id: bat
              model: $1
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              __display_id: testname
              info: $5
              name: ${awk::sprintf("%s (%s %s - %s)", "testname", "APC", $1, "UPS")} # The name contains __display_id, vendor, model and type
- name: test4NameNoDisplayId
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Model=InstanceTable.Column(1)
    Battery.Discovery.Instance.Vendor="APC"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              vendor: APC
              type: UPS
              id: bat
              model: $1
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              info: $5
              name: ${awk::sprintf("%s (%s %s - %s)", "bat", "APC", $1, "UPS")} # The name contains id, vendor, model and type
- name: test4NameNoModel
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Vendor="APC"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              vendor: APC
              type: UPS
              id: bat
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              __display_id: testname
              info: $5
              name: ${awk::sprintf("%s (%s - %s)", "testname", "APC", "UPS")} # The name contains __display_id, vendor and type
- name: test5NameNoVendor
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Model=InstanceTable.Column(1)
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              type: UPS
              id: bat
              model: $1
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              __display_id: testname
              info: $5
              name: ${awk::sprintf("%s (%s - %s)", "testname", $1, "UPS")} # The name contains __display_id, model and type
- name: test5NameNoModelNoVendor
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.Type="UPS"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              type: UPS
              id: bat
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              __display_id: testname
              info: $5
              name: ${awk::sprintf("%s (%s)", "testname", "UPS")} # The name contains __display_id and type
- name: test5NameNoModelNoVendorNoType
  input: |
    // InstanceTable = Source(1)
    Battery.Discovery.InstanceTable=%Battery.Discovery.Source(1)%
    Battery.Discovery.Instance.DeviceID="bat"
    Battery.Discovery.Instance.DisplayID="testname"
    Battery.Discovery.Instance.Chemistry="LiFePO4"
    Battery.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
    Battery.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(3)
  expected:
    monitors:
      battery:
        discovery:
          mapping:
            _comment: InstanceTable = Source(1)
            source: ${source::monitors.battery.discovery.sources.source(1)}
            attributes:
              id: bat
              chemistry: LiFePO4
              hw.parent.type: enclosure
              hw.parent.id: $3
              __display_id: testname
              info: $5
              name: testname # The name is the __display_id