---
- name: discovery
  input: |
    // First HTTP Discovery Comment
    Battery.Discovery.Source(1).Type="HTTP"
    Battery.Discovery.Source(1).Method="GET"
    Battery.Discovery.Source(1).Url="url1"
    Battery.Discovery.Source(1).Header="header1"
    Battery.Discovery.Source(1).AuthenticationToken="token1"
    Battery.Discovery.Source(1).ResultContent="all"
    Battery.Discovery.Source(1).ForceSerialization=1
    Battery.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(1)%
    Battery.Discovery.Source(1).EntryConcatMethod="Custom"
    Battery.Discovery.Source(1).ConcatStart="concatStart"
    Battery.Discovery.Source(1).ConcatEnd="concatEnd"

    // Second HTTP Discovery Comment
    Battery.Discovery.Source(2).Type="HTTP"
    Battery.Discovery.Source(2).Method="GET"
    Battery.Discovery.Source(2).Url="url2"
    Battery.Discovery.Source(2).Header="header2"
    Battery.Discovery.Source(2).AuthenticationToken="token2"
    Battery.Discovery.Source(2).ResultContent="all"
    Battery.Discovery.Source(2).ForceSerialization=1
    Battery.Discovery.Source(2).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(2)%
    Battery.Discovery.Source(2).EntryConcatMethod="List"
  expected:
    monitors:
      battery:
        discovery:
          sources:
            source(1):
              _comment: First HTTP Discovery Comment
              type: http
              method: Get
              url: url1
              header: header1
              body: body1
              authenticationToken: token1
              resultContent: all
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.discovery.sources.source(1)$
                concatMethod:
                  concatStart: concatStart
                  concatEnd: concatEnd
            source(2):
              _comment: Second HTTP Discovery Comment
              type: http
              method: Get
              url: url2
              header: header2
              body: body2
              authenticationToken: token2
              resultContent: all
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.discovery.sources.source(2)$
                concatMethod: list

- name: collect
  input: |
    // First HTTP Collect Comment
    Battery.Collect.Source(1).Type="HTTP"
    Battery.Collect.Source(1).Method="GET"
    Battery.Collect.Source(1).Url="url1"
    Battery.Collect.Source(1).Header="header1"
    Battery.Collect.Source(1).AuthenticationToken="token1"
    Battery.Collect.Source(1).ResultContent="all"
    Battery.Collect.Source(1).ForceSerialization=1
    Battery.Collect.Source(1).ExecuteForEachEntryOf=%Enclosure.Collect.Source(1)%
    Battery.Collect.Source(1).EntryConcatMethod="Custom"
    Battery.Collect.Source(1).ConcatStart="concatStart"
    Battery.Collect.Source(1).ConcatEnd="concatEnd"

    // Second HTTP Collect Comment
    Battery.Collect.Source(2).Type="HTTP"
    Battery.Collect.Source(2).Method="GET"
    Battery.Collect.Source(2).Url="url2"
    Battery.Collect.Source(2).Header="header2"
    Battery.Collect.Source(2).AuthenticationToken="token2"
    Battery.Collect.Source(2).ResultContent="all"
    Battery.Collect.Source(2).ForceSerialization=1
    Battery.Collect.Source(2).ExecuteForEachEntryOf=%Enclosure.Collect.Source(2)%
    Battery.Collect.Source(2).EntryConcatMethod="List"
  expected:
    monitors:
      battery:
        collect:
          sources:
            source(1):
              _comment: First HTTP Collect Comment
              type: http
              method: Get
              url: url1
              header: header1
              body: body1
              authenticationToken: token1
              resultContent: all
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.collect.sources.source(1)$
                concatMethod:
                  concatStart: concatStart
                  concatEnd: concatEnd
            source(2):
              _comment: Second HTTP Collect Comment
              type: http
              method: Get
              url: url2
              header: header2
              body: body2
              authenticationToken: token2
              resultContent: all
              forceSerialization: true
              executeForEachEntryOf:
                source: $monitors.enclosure.collect.sources.source(2)$
                concatMethod: list