////////////////////////////////////////////////////////////////
//
//    H a r d w a r e   D e f i n i t i o n   F i l e
//
//                       f o r
//
//                 Hardware Sentry
//
//                 by Sentry Software (c)
//
//
//      Supports: Raritan PDU
//                Connects to an SNMP agent
//
//


//
// Header
//

hdf.DisplayName="Raritan PDU (SNMP)"
hdf.TypicalPlatform="Raritan PDU"
hdf.ReliesOn="PDU SNMP Enabled"
hdf.Version="1.0"
hdf.Comments="This connector provides hardware monitoring through Raritan PDU SNMP interface."
hdf.RemoteSupport="true"
hdf.LocalSupport="false"
hdf.AppliesToOS="OOB"

//
// DETECTION
// Does a SnmpGet to see if this device is an Raritan PDU device

Detection.Criteria(1).Type="SNMP"
Detection.Criteria(1).SnmpGet="1.3.6.1.4.1.13742.4.1.1.12.0"
Detection.Criteria(1).ExpectedResult="."

//
// Enclosure
//

// Source(1)
// firmwareVersion; serialNumber; hardwareRevision; model; ID;

Enclosure.Discovery.Source(1).Type="SnmpTable"
Enclosure.Discovery.Source(1).SnmpTableOid="1.3.6.1.4.1.13742.4.1.1"
Enclosure.Discovery.Source(1).SnmpTableSelectColumns="1,2,7,12,13"

// Add "Firmware Version: " to firmwareVersion

Enclosure.Discovery.Source(1).Compute(1).Type="LeftConcat"
Enclosure.Discovery.Source(1).Compute(1).Column=1
Enclosure.Discovery.Source(1).Compute(1).String="Firmware Version: "

// Add "Hardware Revision: " to HardwareRevision

Enclosure.Discovery.Source(1).Compute(2).Type="LeftConcat"
Enclosure.Discovery.Source(1).Compute(2).Column=3
Enclosure.Discovery.Source(1).Compute(2).String="Hardware Revision: "

// InstanceTable = Source(1)
//firmwareVersion; serialNumber; hardwareRevision; model; ID;

Enclosure.Discovery.InstanceTable=%Enclosure.Discovery.Source(1)%
Enclosure.Discovery.Instance.DeviceID=InstanceTable.Column(5)
Enclosure.Discovery.Instance.Vendor="Raritan"
Enclosure.Discovery.Instance.Model=InstanceTable.Column(4)
Enclosure.Discovery.Instance.SerialNumber=InstanceTable.Column(2)
Enclosure.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(1)
Enclosure.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(3)
Enclosure.Discovery.Instance.Type="PDU"

// Collect
// ID;

Enclosure.Collect.Source(1).Type="SnmpGet"
Enclosure.Collect.Source(1).SnmpOid="1.3.6.1.4.1.13742.4.1.1.13.0"

// Add an identifier to enable table Joints
// MSHW; ID;

Enclosure.Collect.Source(1).Compute(1).Type="LeftConcat"
Enclosure.Collect.Source(1).Compute(1).Column=1
Enclosure.Collect.Source(1).Compute(1).String="MSHW;"

// Source(2) = Power Consumption;
// powerConsumption;

Enclosure.Collect.Source(2).Type="SnmpGet"
Enclosure.Collect.Source(2).SnmpOid="1.3.6.1.4.1.13742.4.1.3.1.3.0"

// Add an identifier to enable table Joints
// MSHW; powerConsumption;

Enclosure.Collect.Source(2).Compute(1).Type="LeftConcat"
Enclosure.Collect.Source(2).Compute(1).Column=1
Enclosure.Collect.Source(2).Compute(1).String="MSHW;"

// TableJoin of Source(1) and Source(2) into Source(3)
// MSHW; ID; MSHW; powerConsumption;

Enclosure.Collect.Source(3).Type="TableJoint"
Enclosure.Collect.Source(3).LeftTable=%Enclosure.Collect.Source(1)%
Enclosure.Collect.Source(3).RightTable=%Enclosure.Collect.Source(2)%
Enclosure.Collect.Source(3).LeftKeyColumn=1
Enclosure.Collect.Source(3).RightKeyColumn=1


// ValueTable = Source(3)
// MSHW; ID; MSHW; powerConsumption;

Enclosure.Collect.ValueTable=%Enclosure.Collect.Source(3)%
Enclosure.Collect.DeviceID=ValueTable.Column(2)
Enclosure.Collect.PowerConsumption=ValueTable.Column(4)

//
// Temperature
//

// Source(1) = EnclosureID
// enclosureID;

Temperature.Discovery.Source(1).Type="SnmpGet"
Temperature.Discovery.Source(1).SnmpOid="1.3.6.1.4.1.13742.4.1.1.13.0"

// Source(2) = Temperature Thresholds
// unitTempUpperWarning; unitTempUpperCritical;

Temperature.Discovery.Source(2).Type="SnmpTable"
Temperature.Discovery.Source(2).SnmpTableOid="1.3.6.1.4.1.13742.4.1.3.1"
Temperature.Discovery.Source(2).SnmpTableSelectColumns="82,83"

// Add an identifier to enable table Joints
// MSHW; enclosureID;

Temperature.Discovery.Source(1).Compute(1).Type="LeftConcat"
Temperature.Discovery.Source(1).Compute(1).Column=1
Temperature.Discovery.Source(1).Compute(1).String="MSHW;"

// Add an identifier to enable table Joints
// MSHW; unitTempUpperWarning; unitTempUpperCritical;

Temperature.Discovery.Source(2).Compute(1).Type="LeftConcat"
Temperature.Discovery.Source(2).Compute(1).Column=1
Temperature.Discovery.Source(2).Compute(1).String="MSHW;"

// Join the Enclosure ID with the collected data
// MSHW; enclosureID; MSHW; unitTempUpperWarning; unitTempUpperCritical;

Temperature.Discovery.Source(3).Type="TableJoint"
Temperature.Discovery.Source(3).LeftTable=%Temperature.Discovery.Source(1)%
Temperature.Discovery.Source(3).RightTable=%Temperature.Discovery.Source(2)%
Temperature.Discovery.Source(3).LeftKeyColumn=1
Temperature.Discovery.Source(3).RightKeyColumn=1

// Mapping to Instance table for source(3)
// MSHW;enclosureID;MSHW;ID;

Temperature.Discovery.InstanceTable=%Temperature.Discovery.Source(3)%
Temperature.Discovery.Instance.DeviceID=InstanceTable.Column(2)
Temperature.Discovery.Instance.DisplayID=InstanceTable.Column(2)
Temperature.Discovery.Instance.WarningThreshold=InstanceTable.Column(4)
Temperature.Discovery.Instance.AlarmThreshold=InstanceTable.Column(5)
Temperature.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)
Temperature.Discovery.Instance.TemperatureType="Enclosure"

// Collect
// Source(1) = ID
// ID;

Temperature.Collect.Source(1).Type="SnmpGet"
Temperature.Collect.Source(1).SnmpOid="1.3.6.1.4.1.13742.4.1.1.13.0"

// Source(2) = Temperature
// temperature;

Temperature.Collect.Source(2).Type="SnmpGet"
Temperature.Collect.Source(2).SnmpOid="1.3.6.1.4.1.13742.4.1.3.1.5.0"

// Add an identifier to enable table Joints
// MSHW; ID;

Temperature.Collect.Source(1).Compute(1).Type="LeftConcat"
Temperature.Collect.Source(1).Compute(1).Column=1
Temperature.Collect.Source(1).Compute(1).String="MSHW;"

// Add an identifier to enable table Joints
// MSHW; temperature;

Temperature.Collect.Source(2).Compute(1).Type="LeftConcat"
Temperature.Collect.Source(2).Compute(1).Column=1
Temperature.Collect.Source(2).Compute(1).String="MSHW;"

// Join the Enclosure ID with the collected data
// MSHW; ID; MSHW; temperature;

Temperature.Collect.Source(3).Type="TableJoint"
Temperature.Collect.Source(3).LeftTable=%Temperature.Discovery.Source(1)%
Temperature.Collect.Source(3).RightTable=%Temperature.Discovery.Source(2)%
Temperature.Collect.Source(3).LeftKeyColumn=1
Temperature.Collect.Source(3).RightKeyColumn=1

// ValueTable = Source(3)
// MSHW; ID; MSHW; temperature;

Temperature.Collect.ValueTable=%Temperature.Collect.Source(3)%
Temperature.Collect.DeviceID=ValueTable.Column(2)
Temperature.Collect.Temperature=ValueTable.Column(4)

//
// Voltage
//

// Source(1) = EnclosureID
// enclosureID;

Voltage.Discovery.Source(1).Type="SnmpGet"
Voltage.Discovery.Source(1).SnmpOid="1.3.6.1.4.1.13742.4.1.1.13.0"

// Add an identifier to enable table Joints
// MSHW; enclosureID;

Voltage.Discovery.Source(1).Compute(1).Type="LeftConcat"
Voltage.Discovery.Source(1).Compute(1).Column=1
Voltage.Discovery.Source(1).Compute(1).String="MSHW;"

// Source(2) = Voltage thresholds
// lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(2).Type="SnmpTable"
Voltage.Discovery.Source(2).SnmpTableOid="1.3.6.1.4.1.13742.4.1.20.2.1"
Voltage.Discovery.Source(2).SnmpTableSelectColumns="27,25"

// Add an identifier to enable table Joints
// MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(2).Compute(1).Type="LeftConcat"
Voltage.Discovery.Source(2).Compute(1).Column=1
Voltage.Discovery.Source(2).Compute(1).String="MSHW;"

// Source(3) = Join the Enclosure ID with the thresholds
// MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(3).Type="TableJoint"
Voltage.Discovery.Source(3).LeftTable=%Voltage.Discovery.Source(1)%
Voltage.Discovery.Source(3).RightTable=%Voltage.Discovery.Source(2)%
Voltage.Discovery.Source(3).LeftKeyColumn=1
Voltage.Discovery.Source(3).RightKeyColumn=1

// Source(4) = Copy of Source(3) for inletID
// MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(4)=%Voltage.Discovery.Source(3)%

// Add an identifier to match outlet table as well as the inlet ID
// MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical; MSHW; inletID;

Voltage.Discovery.Source(4).Compute(1).Type="LeftConcat"
Voltage.Discovery.Source(4).Compute(1).Column=1
Voltage.Discovery.Source(4).Compute(1).String="MSHW;Inlet;"

// Source(5) = outletID
// outletID;

Voltage.Discovery.Source(5).Type="SnmpTable"
Voltage.Discovery.Source(5).SnmpTableOid="1.3.6.1.4.1.13742.4.1.2.2.1"
Voltage.Discovery.Source(5).SnmpTableSelectColumns="2"

// Add an identifier to enable table Joints
// MSHW; outletID;

Voltage.Discovery.Source(5).Compute(1).Type="LeftConcat"
Voltage.Discovery.Source(5).Compute(1).Column=1
Voltage.Discovery.Source(5).Compute(1).String="MSHW;"

// Source(7) = Join all the information for the outlets
// MSHW; inletID; MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(6).Type="TableJoint"
Voltage.Discovery.Source(6).LeftTable=%Voltage.Discovery.Source(5)%
Voltage.Discovery.Source(6).RightTable=%Voltage.Discovery.Source(3)%
Voltage.Discovery.Source(6).LeftKeyColumn=1
Voltage.Discovery.Source(6).RightKeyColumn=1

// Source(7) = Union of inlets and outlets
// MSHW; outletID; MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.Source(7).Type="TableUnion"
Voltage.Discovery.Source(7).Table1=%Voltage.Discovery.Source(4)%
Voltage.Discovery.Source(7).Table2=%Voltage.Discovery.Source(6)%

// Mapping to Instance table for source(5)
// MSHW; ID; MSHW; enclosureID; MSHW; lowerVoltageCritical; upperVoltageCritical;

Voltage.Discovery.InstanceTable=%Voltage.Discovery.Source(7)%
Voltage.Discovery.Instance.DeviceID=InstanceTable.Column(2)
Voltage.Discovery.Instance.DisplayID=InstanceTable.Column(2)
Voltage.Discovery.Instance.LowerThreshold=InstanceTable.Column(6)
Voltage.Discovery.Instance.UpperThreshold=InstanceTable.Column(7)
Voltage.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(4)
Voltage.Discovery.Instance.VoltageType="Enclosure"

// Collect
// Collect type = multi-instance

Voltage.Collect.Type="MultiInstance"

// Source(1) = Inlet Voltage
// inletVoltage;

Voltage.Collect.Source(1).Type="SnmpGet"
Voltage.Collect.Source(1).SnmpOid="1.3.6.1.4.1.13742.4.1.20.2.1.8.1"

// Add the ID to the voltage
// inletID; inletVoltage

Voltage.Collect.Source(1).Compute(1).Type="LeftConcat"
Voltage.Collect.Source(1).Compute(1).Column=1
Voltage.Collect.Source(1).Compute(1).String="Inlet;"

// Source(2) = Outlet ID and Voltage
// outletID; outletVoltage

Voltage.Collect.Source(2).Type="SnmpTable"
Voltage.Collect.Source(2).SnmpTableOid="1.3.6.1.4.1.13742.4.1.2.2.1"
Voltage.Collect.Source(2).SnmpTableSelectColumns="2,6"

// Source(3) = Union of inlets and outlets
// ID; Voltage

Voltage.Collect.Source(3).Type="TableUnion"
Voltage.Collect.Source(3).Table1=%Voltage.Collect.Source(1)%
Voltage.Collect.Source(3).Table2=%Voltage.Collect.Source(2)%

// ValueTable = Source(3)
// ID; Voltage

Voltage.Collect.ValueTable=%Voltage.Collect.Source(3)%
Voltage.Collect.DeviceID=ValueTable.Column(1)
Voltage.Collect.Voltage=ValueTable.Column(2)
