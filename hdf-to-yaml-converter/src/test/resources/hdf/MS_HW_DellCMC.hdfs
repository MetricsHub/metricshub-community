//
//
//                 C O N N E C T O R
//
//                       f o r
//
//                 Hardware Sentry
//
//              by Sentry Software (c)
//
//                  MS_HW_DellCMC.hdf
//
//      Supports: Dell Blade chassis with DRAC
//		Monitors: the chassis'environment (temperatures, fans, power supplies)
//      Connects to: the DRAC through Telnet
//
//

//
// HEADER
//
hdf.DisplayName="Dell CMC (Dell Chassis Management Controller)"
hdf.TypicalPlatform="Dell M1000E"
hdf.ReliesOn="Dell Chassis Management Controller (CMC)"
hdf.Comments="Provides environmental information (temperatures, fans and power supplies) on Dell Blade servers through the Dell Chassis Management Controller (CMC)"
hdf.Version="1.0"
hdf.RemoteSupport="true"
hdf.LocalSupport="false"
hdf.AppliesToOS="OOB"

// Includes
#include MS_HW_DellCMC.hhdf

//
// DETECTION
//

// Host should respond to telnet the way described below
Detection.Criteria(1).Type="TelnetInteractive"
Detection.Criteria(1).ForceSerialization=1

Detection.Criteria(1).Step(1).Type="Sleep"
Detection.Criteria(1).Step(1).Duration=1

Detection.Criteria(1).Step(2).Type="WaitFor"
Detection.Criteria(1).Step(2).Text="ogin:"
Detection.Criteria(1).Step(2).TimeOut=20
Detection.Criteria(1).Step(2).TelnetOnly=1

Detection.Criteria(1).Step(3).Type="Sleep"
Detection.Criteria(1).Step(3).Duration=3

Detection.Criteria(1).Step(4).Type="SendUsername"
Detection.Criteria(1).Step(4).TelnetOnly=1

Detection.Criteria(1).Step(5).Type="Sleep"
Detection.Criteria(1).Step(5).Duration=3

Detection.Criteria(1).Step(6).Type="WaitFor"
Detection.Criteria(1).Step(6).Text="assword:"
Detection.Criteria(1).Step(6).TimeOut=10
Detection.Criteria(1).Step(6).TelnetOnly=1

Detection.Criteria(1).Step(7).Type="SendPassword"
Detection.Criteria(1).Step(7).TelnetOnly=1

Detection.Criteria(1).Step(8).Type="WaitFor"
Detection.Criteria(1).Step(8).Text="$"
Detection.Criteria(1).Step(8).TimeOut=30
Detection.Criteria(1).Step(8).Capture=True

Detection.Criteria(1).Step(9).Type="Sleep"
Detection.Criteria(1).Step(9).Duration=3

Detection.Criteria(1).Step(10).Type="SendText"
Detection.Criteria(1).Step(10).Text="quit\nlogout\nexit\n"
Detection.Criteria(1).Step(10).Capture=False

Detection.Criteria(1).ExpectedResult="CMC firmware"


//
// Discovery

// Source(1) = Output of the getsysinfo command through telnet
// Look for the "System Model=" line
Enclosure.Discovery.Source(1).Type="TelnetInteractive"
Enclosure.Discovery.Source(1).ForceSerialization=1

Enclosure.Discovery.Source(1).Step(1).Type="Sleep"
Enclosure.Discovery.Source(1).Step(1).Duration=1

Enclosure.Discovery.Source(1).Step(2).Type="WaitFor"
Enclosure.Discovery.Source(1).Step(2).Text="ogin:"
Enclosure.Discovery.Source(1).Step(2).Timeout=20
Enclosure.Discovery.Source(1).Step(2).TelnetOnly=1

Enclosure.Discovery.Source(1).Step(3).Type="Sleep"
Enclosure.Discovery.Source(1).Step(3).Duration=3

Enclosure.Discovery.Source(1).Step(4).Type="SendUsername"
Enclosure.Discovery.Source(1).Step(4).TelnetOnly=1

Enclosure.Discovery.Source(1).Step(5).Type="WaitFor"
Enclosure.Discovery.Source(1).Step(5).Text="assword:"
Enclosure.Discovery.Source(1).Step(5).TimeOut=10
Enclosure.Discovery.Source(1).Step(5).TelnetOnly=1

Enclosure.Discovery.Source(1).Step(6).Type="Sleep"
Enclosure.Discovery.Source(1).Step(6).Duration=3

Enclosure.Discovery.Source(1).Step(7).Type="SendPassword"
Enclosure.Discovery.Source(1).Step(7).TelnetOnly=1

Enclosure.Discovery.Source(1).Step(8).Type="WaitFor"
Enclosure.Discovery.Source(1).Step(8).Text="$"
Enclosure.Discovery.Source(1).Step(8).TimeOut=30

Enclosure.Discovery.Source(1).Step(9).Type="Sleep"
Enclosure.Discovery.Source(1).Step(9).Duration=3

Enclosure.Discovery.Source(1).Step(10).Type="SendText"
Enclosure.Discovery.Source(1).Step(10).Text="getsysinfo -c\n"

Enclosure.Discovery.Source(1).Step(11).Type="WaitFor"
Enclosure.Discovery.Source(1).Step(11).Text="$"
Enclosure.Discovery.Source(1).Step(11).TimeOut=360
Enclosure.Discovery.Source(1).Step(11).Capture=True

Enclosure.Discovery.Source(1).Step(12).Type="Sleep"
Enclosure.Discovery.Source(1).Step(12).Duration=3

Enclosure.Discovery.Source(1).Step(13).Type="SendText"
Enclosure.Discovery.Source(1).Step(13).Text="quit\nlogout\nexit\n"
Enclosure.Discovery.Source(1).Step(13).Capture=False

//Enclosure.Discovery.Source(1).Separators="ï¿½"

// Parse the output of getsysinfo with an AWK script
// Model;SerialNumber
Enclosure.Discovery.Source(1).Compute(1).Type="Awk"
Enclosure.Discovery.Source(1).Compute(1).AwkScript=EmbeddedFile(1)
Enclosure.Discovery.Source(1).Compute(1).KeepOnlyRegExp="MSHW;"
Enclosure.Discovery.Source(1).Compute(1).Separators=";"
Enclosure.Discovery.Source(1).Compute(1).SelectColumns="2,3"


// Source(2) = Output of getsensorinfo, getmodinfo and getpbinfo
Enclosure.Discovery.Source(2).Type="TelnetInteractive"
Enclosure.Discovery.Source(2).ForceSerialization=1

Enclosure.Discovery.Source(2).Step(1).Type="Sleep"
Enclosure.Discovery.Source(2).Step(1).Duration=1

Enclosure.Discovery.Source(2).Step(2).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(2).Text="ogin:"
Enclosure.Discovery.Source(2).Step(2).Timeout=20
Enclosure.Discovery.Source(2).Step(2).TelnetOnly=1

Enclosure.Discovery.Source(2).Step(3).Type="Sleep"
Enclosure.Discovery.Source(2).Step(3).Duration=3

Enclosure.Discovery.Source(2).Step(4).Type="SendUsername"
Enclosure.Discovery.Source(2).Step(4).TelnetOnly=1

Enclosure.Discovery.Source(2).Step(5).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(5).Text="assword:"
Enclosure.Discovery.Source(2).Step(5).TimeOut=10
Enclosure.Discovery.Source(2).Step(5).TelnetOnly=1

Enclosure.Discovery.Source(2).Step(6).Type="Sleep"
Enclosure.Discovery.Source(2).Step(6).Duration=3

Enclosure.Discovery.Source(2).Step(7).Type="SendPassword"
Enclosure.Discovery.Source(2).Step(7).TelnetOnly=1

Enclosure.Discovery.Source(2).Step(8).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(8).Text="$"
Enclosure.Discovery.Source(2).Step(8).TimeOut=30

Enclosure.Discovery.Source(2).Step(9).Type="Sleep"
Enclosure.Discovery.Source(2).Step(9).Duration=3

Enclosure.Discovery.Source(2).Step(10).Type="SendText"
Enclosure.Discovery.Source(2).Step(10).Text="getsensorinfo\n"

Enclosure.Discovery.Source(2).Step(11).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(11).Text="$"
Enclosure.Discovery.Source(2).Step(11).TimeOut=360
Enclosure.Discovery.Source(2).Step(11).Capture=True

Enclosure.Discovery.Source(2).Step(12).Type="Sleep"
Enclosure.Discovery.Source(2).Step(12).Duration=3

Enclosure.Discovery.Source(2).Step(13).Type="SendText"
Enclosure.Discovery.Source(2).Step(13).Text="getmodinfo -A\n"

Enclosure.Discovery.Source(2).Step(14).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(14).Text="$"
Enclosure.Discovery.Source(2).Step(14).TimeOut=360

Enclosure.Discovery.Source(2).Step(15).Type="Sleep"
Enclosure.Discovery.Source(2).Step(15).Duration=3

Enclosure.Discovery.Source(2).Step(16).Type="SendText"
Enclosure.Discovery.Source(2).Step(16).Text="getpbinfo\n"

Enclosure.Discovery.Source(2).Step(17).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(17).Text="$"
Enclosure.Discovery.Source(2).Step(17).TimeOut=360

Enclosure.Discovery.Source(2).Step(18).Type="Sleep"
Enclosure.Discovery.Source(2).Step(18).Duration=3

Enclosure.Discovery.Source(2).Step(19).Type="SendText"
Enclosure.Discovery.Source(2).Step(19).Text="raid get vdisks -o\n"

Enclosure.Discovery.Source(2).Step(20).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(20).Text="$"
Enclosure.Discovery.Source(2).Step(20).TimeOut=360

Enclosure.Discovery.Source(2).Step(21).Type="Sleep"
Enclosure.Discovery.Source(2).Step(21).Duration=3

Enclosure.Discovery.Source(2).Step(22).Type="SendText"
Enclosure.Discovery.Source(2).Step(22).Text="raid get pdisks -o\n"

Enclosure.Discovery.Source(2).Step(23).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(23).Text="$"
Enclosure.Discovery.Source(2).Step(23).TimeOut=360

Enclosure.Discovery.Source(2).Step(24).Type="Sleep"
Enclosure.Discovery.Source(2).Step(24).Duration=3

Enclosure.Discovery.Source(2).Step(25).Type="SendText"
Enclosure.Discovery.Source(2).Step(25).Text="raid get tempprobes -o\n"

Enclosure.Discovery.Source(2).Step(26).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(26).Text="$"
Enclosure.Discovery.Source(2).Step(26).TimeOut=360

Enclosure.Discovery.Source(2).Step(27).Type="Sleep"
Enclosure.Discovery.Source(2).Step(27).Duration=3

Enclosure.Discovery.Source(2).Step(28).Type="SendText"
Enclosure.Discovery.Source(2).Step(28).Text="raid get controllers -o\n"

Enclosure.Discovery.Source(2).Step(29).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(29).Text="$"
Enclosure.Discovery.Source(2).Step(29).TimeOut=360

Enclosure.Discovery.Source(2).Step(30).Type="Sleep"
Enclosure.Discovery.Source(2).Step(30).Duration=3

Enclosure.Discovery.Source(2).Step(31).Type="SendText"
Enclosure.Discovery.Source(2).Step(31).Text="raid get batteries -o\n"

Enclosure.Discovery.Source(2).Step(32).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(32).Text="$"
Enclosure.Discovery.Source(2).Step(32).TimeOut=360

Enclosure.Discovery.Source(2).Step(33).Type="Sleep"
Enclosure.Discovery.Source(2).Step(33).Duration=3

Enclosure.Discovery.Source(2).Step(34).Type="SendText"
Enclosure.Discovery.Source(2).Step(34).Text="chassislog view -s critical\n"

Enclosure.Discovery.Source(2).Step(35).Type="WaitFor"
Enclosure.Discovery.Source(2).Step(35).Text="$"
Enclosure.Discovery.Source(2).Step(35).TimeOut=360

Enclosure.Discovery.Source(2).Step(36).Type="Sleep"
Enclosure.Discovery.Source(2).Step(36).Duration=3

Enclosure.Discovery.Source(2).Step(37).Type="SendText"
Enclosure.Discovery.Source(2).Step(37).Text="quit\nlogout\nexit\n"
Enclosure.Discovery.Source(2).Step(37).Capture=False


//
// Collect

Enclosure.Collect.Type="MonoInstance"

// Source(2) = Output of getsensorinfo, getmodinfo and getpbinfo
Enclosure.Collect.Source(1).Type="TelnetInteractive"
Enclosure.Collect.Source(1).ForceSerialization=1

Enclosure.Collect.Source(1).Step(1).Type="Sleep"
Enclosure.Collect.Source(1).Step(1).Duration=1

Enclosure.Collect.Source(1).Step(2).Type="WaitFor"
Enclosure.Collect.Source(1).Step(2).Text="ogin:"
Enclosure.Collect.Source(1).Step(2).Timeout=20
Enclosure.Collect.Source(1).Step(2).TelnetOnly=1

Enclosure.Collect.Source(1).Step(3).Type="Sleep"
Enclosure.Collect.Source(1).Step(3).Duration=3

Enclosure.Collect.Source(1).Step(4).Type="SendUsername"
Enclosure.Collect.Source(1).Step(4).TelnetOnly=1

Enclosure.Collect.Source(1).Step(5).Type="WaitFor"
Enclosure.Collect.Source(1).Step(5).Text="assword:"
Enclosure.Collect.Source(1).Step(5).TimeOut=10
Enclosure.Collect.Source(1).Step(5).TelnetOnly=1

Enclosure.Collect.Source(1).Step(6).Type="Sleep"
Enclosure.Collect.Source(1).Step(6).Duration=3

Enclosure.Collect.Source(1).Step(7).Type="SendPassword"
Enclosure.Collect.Source(1).Step(7).TelnetOnly=1

Enclosure.Collect.Source(1).Step(8).Type="WaitFor"
Enclosure.Collect.Source(1).Step(8).Text="$"
Enclosure.Collect.Source(1).Step(8).TimeOut=30

Enclosure.Collect.Source(1).Step(9).Type="Sleep"
Enclosure.Collect.Source(1).Step(9).Duration=3

Enclosure.Collect.Source(1).Step(10).Type="SendText"
Enclosure.Collect.Source(1).Step(10).Text="getsensorinfo\n"

Enclosure.Collect.Source(1).Step(11).Type="WaitFor"
Enclosure.Collect.Source(1).Step(11).Text="$"
Enclosure.Collect.Source(1).Step(11).TimeOut=360
Enclosure.Collect.Source(1).Step(11).Capture=True

Enclosure.Collect.Source(1).Step(12).Type="Sleep"
Enclosure.Collect.Source(1).Step(12).Duration=3

Enclosure.Collect.Source(1).Step(13).Type="SendText"
Enclosure.Collect.Source(1).Step(13).Text="getmodinfo -A\n"

Enclosure.Collect.Source(1).Step(14).Type="WaitFor"
Enclosure.Collect.Source(1).Step(14).Text="$"
Enclosure.Collect.Source(1).Step(14).TimeOut=360

Enclosure.Collect.Source(1).Step(15).Type="Sleep"
Enclosure.Collect.Source(1).Step(15).Duration=3

Enclosure.Collect.Source(1).Step(16).Type="SendText"
Enclosure.Collect.Source(1).Step(16).Text="getpbinfo\n"

Enclosure.Collect.Source(1).Step(17).Type="WaitFor"
Enclosure.Collect.Source(1).Step(17).Text="$"
Enclosure.Collect.Source(1).Step(17).TimeOut=360

Enclosure.Collect.Source(1).Step(18).Type="Sleep"
Enclosure.Collect.Source(1).Step(18).Duration=3

Enclosure.Collect.Source(1).Step(19).Type="SendText"
Enclosure.Collect.Source(1).Step(19).Text="raid get vdisks -o\n"

Enclosure.Collect.Source(1).Step(20).Type="WaitFor"
Enclosure.Collect.Source(1).Step(20).Text="$"
Enclosure.Collect.Source(1).Step(20).TimeOut=360

Enclosure.Collect.Source(1).Step(21).Type="Sleep"
Enclosure.Collect.Source(1).Step(21).Duration=3

Enclosure.Collect.Source(1).Step(22).Type="SendText"
Enclosure.Collect.Source(1).Step(22).Text="raid get pdisks -o\n"

Enclosure.Collect.Source(1).Step(23).Type="WaitFor"
Enclosure.Collect.Source(1).Step(23).Text="$"
Enclosure.Collect.Source(1).Step(23).TimeOut=360

Enclosure.Collect.Source(1).Step(24).Type="Sleep"
Enclosure.Collect.Source(1).Step(24).Duration=3

Enclosure.Collect.Source(1).Step(25).Type="SendText"
Enclosure.Collect.Source(1).Step(25).Text="raid get tempprobes -o\n"

Enclosure.Collect.Source(1).Step(26).Type="WaitFor"
Enclosure.Collect.Source(1).Step(26).Text="$"
Enclosure.Collect.Source(1).Step(26).TimeOut=360

Enclosure.Collect.Source(1).Step(27).Type="Sleep"
Enclosure.Collect.Source(1).Step(27).Duration=3

Enclosure.Collect.Source(1).Step(28).Type="SendText"
Enclosure.Collect.Source(1).Step(28).Text="raid get controllers -o\n"

Enclosure.Collect.Source(1).Step(29).Type="WaitFor"
Enclosure.Collect.Source(1).Step(29).Text="$"
Enclosure.Collect.Source(1).Step(29).TimeOut=360

Enclosure.Collect.Source(1).Step(30).Type="Sleep"
Enclosure.Collect.Source(1).Step(30).Duration=3

Enclosure.Collect.Source(1).Step(31).Type="SendText"
Enclosure.Collect.Source(1).Step(31).Text="raid get batteries -o\n"

Enclosure.Collect.Source(1).Step(32).Type="WaitFor"
Enclosure.Collect.Source(1).Step(32).Text="$"
Enclosure.Collect.Source(1).Step(32).TimeOut=360

Enclosure.Collect.Source(1).Step(33).Type="Sleep"
Enclosure.Collect.Source(1).Step(33).Duration=3

Enclosure.Collect.Source(1).Step(34).Type="SendText"
Enclosure.Collect.Source(1).Step(34).Text="chassislog view -s critical\n"

Enclosure.Collect.Source(1).Step(35).Type="WaitFor"
Enclosure.Collect.Source(1).Step(35).Text="$"
Enclosure.Collect.Source(1).Step(35).TimeOut=360

Enclosure.Collect.Source(1).Step(36).Type="Sleep"
Enclosure.Collect.Source(1).Step(36).Duration=3

Enclosure.Collect.Source(1).Step(37).Type="SendText"
Enclosure.Collect.Source(1).Step(37).Text="quit\nlogout\nexit\n"
Enclosure.Collect.Source(1).Step(37).Capture=False




// Source(2) = Getslotname
Blade.Discovery.Source(2).Type="TelnetInteractive"
Blade.Discovery.Source(2).ForceSerialization=1

Blade.Discovery.Source(2).Step(1).Type="Sleep"
Blade.Discovery.Source(2).Step(1).Duration=1

Blade.Discovery.Source(2).Step(2).Type="WaitFor"
Blade.Discovery.Source(2).Step(2).Text="ogin:"
Blade.Discovery.Source(2).Step(2).Timeout=20
Blade.Discovery.Source(2).Step(2).TelnetOnly=1

Blade.Discovery.Source(2).Step(3).Type="Sleep"
Blade.Discovery.Source(2).Step(3).Duration=3

Blade.Discovery.Source(2).Step(4).Type="SendUsername"
Blade.Discovery.Source(2).Step(4).TelnetOnly=1

Blade.Discovery.Source(2).Step(5).Type="WaitFor"
Blade.Discovery.Source(2).Step(5).Text="assword:"
Blade.Discovery.Source(2).Step(5).TimeOut=10
Blade.Discovery.Source(2).Step(5).TelnetOnly=1

Blade.Discovery.Source(2).Step(6).Type="Sleep"
Blade.Discovery.Source(2).Step(6).Duration=3

Blade.Discovery.Source(2).Step(7).Type="SendPassword"
Blade.Discovery.Source(2).Step(7).TelnetOnly=1

Blade.Discovery.Source(2).Step(8).Type="WaitFor"
Blade.Discovery.Source(2).Step(8).Text="$"
Blade.Discovery.Source(2).Step(8).TimeOut=30

Blade.Discovery.Source(2).Step(9).Type="Sleep"
Blade.Discovery.Source(2).Step(9).Duration=3

Blade.Discovery.Source(2).Step(10).Type="SendText"
Blade.Discovery.Source(2).Step(10).Text="getslotname \n"

Blade.Discovery.Source(2).Step(11).Type="WaitFor"
Blade.Discovery.Source(2).Step(11).Text="$"
Blade.Discovery.Source(2).Step(11).TimeOut=360
Blade.Discovery.Source(2).Step(11).Capture=True

Blade.Discovery.Source(2).Step(12).Type="Sleep"
Blade.Discovery.Source(2).Step(12).Duration=3

Blade.Discovery.Source(2).Step(13).Type="SendText"
Blade.Discovery.Source(2).Step(13).Text="quit\nlogout\nexit\n"
Blade.Discovery.Source(2).Step(13).Capture=False
