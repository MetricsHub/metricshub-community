
Enclosure.Discovery.Source(1).Type="HTTP"
Enclosure.Discovery.Source(1).Method="GET"
Enclosure.Discovery.Source(1).Url="redfish/v1/Chassis/"
Enclosure.Discovery.Source(1).Header=EmbeddedFile(1)
Enclosure.Discovery.Source(1).ResultContent="body"

// Extract data
// JSONID;@odata.id;
Enclosure.Discovery.Source(1).Compute(1).Type="Json2Csv"
Enclosure.Discovery.Source(1).Compute(1).EntryKey="/Members"
Enclosure.Discovery.Source(1).Compute(1).Properties="/@odata.id;"

//remove empty URLs to avoid empty redirection
Enclosure.Discovery.Source(1).Compute(2).Type="KeepOnlyMatchingLines"
Enclosure.Discovery.Source(1).Compute(2).Column=2
Enclosure.Discovery.Source(1).Compute(2).RegExp="."

// Query /Chassis/?/
Enclosure.Discovery.Source(2).Type="HTTP"
Enclosure.Discovery.Source(2).Method="GET"
Enclosure.Discovery.Source(2).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(1)%
Enclosure.Discovery.Source(2).Url="%Entry.Column(2)%"
Enclosure.Discovery.Source(2).Header=EmbeddedFile(1)
Enclosure.Discovery.Source(2).ResultContent="body"
Enclosure.Discovery.Source(2).EntryConcatMethod="JSONArrayExtended"

Enclosure.Discovery.Source(3)=%Enclosure.Discovery.Source(2)%

// Extract data
//   1      2         3            4                5                  6              7               8
// JSONID;ChassisID;SystemId;ChassisName;ChassisModel;ChassisSerialNumber;ChassisManufacturer;PowerMetrics;ThermalMetrics;
Enclosure.Discovery.Source(3).Compute(1).Type="Json2Csv"
Enclosure.Discovery.Source(3).Compute(1).EntryKey="Entry/Value/links/ComputerSystems"
Enclosure.Discovery.Source(3).Compute(1).Properties="../../../Column(2);/_REF;../../Name;../../Model;../../SerialNumber;../../Manufacturer;../../Power/@odata.id;../../Thermal/@odata.id;"

// Enclosure Instance Table
// JSONID;ChassisID;SystemId;ChassisName;ChassisModel;ChassisSerialNumber;ChassisManufacturer;PowerMetrics;ThermalMetrics;
Enclosure.Discovery.InstanceTable=%Enclosure.Discovery.Source(3)%
Enclosure.Discovery.Instance.DeviceID=InstanceTable.Column(2)
Enclosure.Discovery.Instance.DisplayID=InstanceTable.Column(4)
Enclosure.Discovery.Instance.Model=InstanceTable.Column(5)
Enclosure.Discovery.Instance.SerialNumber=InstanceTable.Column(6)
Enclosure.Discovery.Instance.Vendor=InstanceTable.Column(7)
Enclosure.Discovery.Instance.Type="Server"

// Query
// Systems/?/SmartStorage/ArrayControllers/
Enclosure.Discovery.Source(4).Type="HTTP"
Enclosure.Discovery.Source(4).Method="GET"
Enclosure.Discovery.Source(4).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
Enclosure.Discovery.Source(4).Url="%Entry.Column(3)%SmartStorage/ArrayControllers/"
Enclosure.Discovery.Source(4).Header=EmbeddedFile(1)
Enclosure.Discovery.Source(4).ResultContent="body"
Enclosure.Discovery.Source(4).EntryConcatMethod="JSONArrayExtended"

// Extract data
// JSONID;ChassisID;DiskControllerID;
Enclosure.Discovery.Source(4).Compute(1).Type="Json2Csv"
Enclosure.Discovery.Source(4).Compute(1).EntryKey="/Entry/Value/Members"
Enclosure.Discovery.Source(4).Compute(1).Properties="../../Column(2);/@odata.id;"

//remove empty URLs to avoid empty redirection
Enclosure.Discovery.Source(4).Compute(2).Type="KeepOnlyMatchingLines"
Enclosure.Discovery.Source(4).Compute(2).Column=3
Enclosure.Discovery.Source(4).Compute(2).RegExp="."

// Query
// /Systems/?/SmartStorage/ArrayControllers/?/
Enclosure.Discovery.Source(5).Type="HTTP"
Enclosure.Discovery.Source(5).Method="GET"
Enclosure.Discovery.Source(5).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(4)%
Enclosure.Discovery.Source(5).Url="%Entry.Column(3)%"
Enclosure.Discovery.Source(5).Header=EmbeddedFile(1)
Enclosure.Discovery.Source(5).ResultContent="body"
Enclosure.Discovery.Source(5).EntryConcatMethod="JSONArrayExtended"


// Extract data
// JSONID;ChassisID;ControllerID;LogicalDiskURL;PhysicalDiskURL;Name;Model;SerialNumber;FirmwareVersion;
Enclosure.Discovery.Source(5).Compute(1).Type="Json2Csv"
Enclosure.Discovery.Source(5).Compute(1).EntryKey="/Entry/Value"
Enclosure.Discovery.Source(5).Compute(1).Properties="../Column(2);/@odata.id;/Links/LogicalDrives/_REF;/Links/PhysicalDrives/_REF;/Name;/Model;/SerialNumber;/FirmwareVersion/Current/VersionString;"

Enclosure.Discovery.Source(6).Type="HTTP"
Enclosure.Discovery.Source(6).Method="GET"
Enclosure.Discovery.Source(6).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
Enclosure.Discovery.Source(6).Url="%Entry.Column(9)%"
Enclosure.Discovery.Source(6).Header=EmbeddedFile(1)
Enclosure.Discovery.Source(6).ResultContent="body"
Enclosure.Discovery.Source(6).EntryConcatMethod="JSONArrayExtended"


// Collect

Enclosure.Collect.Type="MultiInstance"


// For each Chassis found; Query it's specific address.
Enclosure.Collect.Source(1).Type="HTTP"
Enclosure.Collect.Source(1).Method="GET"
Enclosure.Collect.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(1)%
Enclosure.Collect.Source(1).Url="%Entry.Column(2)%"
Enclosure.Collect.Source(1).Header=EmbeddedFile(1)
Enclosure.Collect.Source(1).ResultContent="body"
Enclosure.Collect.Source(1).EntryConcatMethod="JSONArray"

Enclosure.Collect.Source(2)=%Enclosure.Collect.Source(1)%

// Collect @odata.id, StatusHealth from Chassis
Enclosure.Collect.Source(2).Compute(1).Type="Json2Csv"
Enclosure.Collect.Source(2).Compute(1).EntryKey="/"
Enclosure.Collect.Source(2).Compute(1).Properties="@odata.id;/Status/Health;/Status/Health;"
Enclosure.Collect.Source(2).Compute(1).Separator=";"

Enclosure.Collect.Source(2).Compute(2).Type="Translate"
Enclosure.Collect.Source(2).Compute(2).Column=3
Enclosure.Collect.Source(2).Compute(2).TranslationTable="StatusTranslationTable"

Enclosure.Collect.Source(2).Compute(3).Type="Translate"
Enclosure.Collect.Source(2).Compute(3).Column=4
Enclosure.Collect.Source(2).Compute(3).TranslationTable="StatusInformationTranslationTable"

// For each Chassis found; Query it's Power address.
Enclosure.Collect.Source(3).Type="HTTP"
Enclosure.Collect.Source(3).Method="GET"
Enclosure.Collect.Source(3).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
Enclosure.Collect.Source(3).Url="%Entry.Column(8)%"
Enclosure.Collect.Source(3).Header=EmbeddedFile(1)
Enclosure.Collect.Source(3).ResultContent="body"
Enclosure.Collect.Source(3).EntryConcatMethod="JSONArrayExtended"

Enclosure.Collect.Source(3).Compute(1).Type="Json2Csv"
Enclosure.Collect.Source(3).Compute(1).EntryKey="/Entry/Value/PowerSupplies"
Enclosure.Collect.Source(3).Compute(1).Properties="../../Column(2);../_POWER_CONSUMPTION_PATH;/_PS_ID;/Status/Health;/Status/Health;"
Enclosure.Collect.Source(3).Compute(1).Separator=";"

// JSONID;ChassisID;Status;Status;JSONID;ChassisID;PowerConsumption;
Enclosure.Collect.Source(4).Type="TableJoint"
Enclosure.Collect.Source(4).LeftTable=%Enclosure.Collect.Source(2)%
Enclosure.Collect.Source(4).RightTable=%Enclosure.Collect.Source(3)%
Enclosure.Collect.Source(4).LeftKeyColumn="2"
Enclosure.Collect.Source(4).RightKeyColumn="2"

// Enclosure Value Table
// JSONID;ChassisID;Status;Status;JSONID;ChassisID;PowerConsumption;
Enclosure.Collect.ValueTable=%Enclosure.Collect.Source(4)%
Enclosure.Collect.DeviceID=ValueTable.Column(2)
Enclosure.Collect.Status=ValueTable.Column(3)
Enclosure.Collect.StatusInformation=ValueTable.Column(4)
Enclosure.Collect.PowerConsumption=ValueTable.Column(7)

Enclosure.Collect.Source(5).Type="HTTP"
Enclosure.Collect.Source(5).Method="GET"
Enclosure.Collect.Source(5).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
Enclosure.Collect.Source(5).Url="%Entry.Column(9)%"
Enclosure.Collect.Source(5).Header=EmbeddedFile(1)
Enclosure.Collect.Source(5).ResultContent="body"
Enclosure.Collect.Source(5).EntryConcatMethod="JSONArray"


//
// Memory
//

// Memory.Discovery.Source(1)
// Column(2) = /redfish/v1/Chassis/?/
// Column(3) = /redfish/v1/Systems/?/Memory/?/

Memory.Discovery.Source(1).Type="HTTP"
Memory.Discovery.Source(1).Method="GET"
Memory.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
Memory.Discovery.Source(1).Url="%Entry.Column(3)%Memory/"
Memory.Discovery.Source(1).Header=EmbeddedFile(1)
Memory.Discovery.Source(1).ResultContent="body"
Memory.Discovery.Source(1).EntryConcatMethod="JSONArrayExtended"

// extract odata.id for each instance
// JSONID;ChassisID;MemoryID;
Memory.Discovery.Source(1).Compute(1).Type="Json2Csv"
Memory.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Members"
Memory.Discovery.Source(1).Compute(1).Properties="../../Column(2);/@odata.id;"
Memory.Discovery.Source(1).Compute(1).Separator=";"

//remove empty URLs to avoid empty redirection
Memory.Discovery.Source(1).Compute(2).Type="KeepOnlyMatchingLines"
Memory.Discovery.Source(1).Compute(2).Column=3
Memory.Discovery.Source(1).Compute(2).RegExp="."

// query odata.id from previous results
Memory.Discovery.Source(2).Type="HTTP"
Memory.Discovery.Source(2).Method="GET"
Memory.Discovery.Source(2).ExecuteForEachEntryOf=%Memory.Discovery.Source(1)%
Memory.Discovery.Source(2).Url="%Entry.Column(3)%"
Memory.Discovery.Source(2).Header=EmbeddedFile(1)
Memory.Discovery.Source(2).ResultContent="body"
Memory.Discovery.Source(2).EntryConcatMethod="JSONArrayExtended"

// extract data
// JSONID;ChassisId;MemoryID;Name;PartNumber;Manufacturer;Size;
Memory.Discovery.Source(2).Compute(1).Type="Json2Csv"
Memory.Discovery.Source(2).Compute(1).EntryKey="/Entry/Value"
Memory.Discovery.Source(2).Compute(1).Properties="../Column(2);/@odata.id;/Name;/SerialNumber;/PartNumber;/Manufacturer;/_MEMORY_SIZE_PARAMETER;/Status/State;"

Memory.Discovery.Source(2).Compute(2).Type="ExcludeMatchingLines"
Memory.Discovery.Source(2).Compute(2).Column=9
Memory.Discovery.Source(2).Compute(2).RegExp="Absent"

//Exclude entries where Manufacturer is empty
Memory.Discovery.Source(2).Compute(3).Type="KeepOnlyMatchingLines"
Memory.Discovery.Source(2).Compute(3).Column=7
Memory.Discovery.Source(2).Compute(3).RegExp="."

// Memory Instance Table
// JsonId;ChassisID;MemoryID;Name;SerialNumber;PartNumber;Manufacturer;sizeParameter;
Memory.Discovery.InstanceTable=%Memory.Discovery.Source(2)%
Memory.Discovery.Instance.DeviceID=InstanceTable.Column(3)
Memory.Discovery.Instance.DisplayID=InstanceTable.Column(4)
Memory.Discovery.Instance.SerialNumber=InstanceTable.Column(5)
Memory.Discovery.Instance.Model=InstanceTable.Column(6)
Memory.Discovery.Instance.Vendor=InstanceTable.Column(7)
Memory.Discovery.Instance.Size=InstanceTable.Column(8)

Memory.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)

// Collect

Memory.Collect.Type="MultiInstance"

// Query /Systems/?/Memory/?
Memory.Collect.Source(1).Type="HTTP"
Memory.Collect.Source(1).Method="GET"
Memory.Collect.Source(1).ExecuteForEachEntryOf=%Memory.Discovery.Source(1)%
Memory.Collect.Source(1).Url="%Entry.Column(3)%"
Memory.Collect.Source(1).Header=EmbeddedFile(1)
Memory.Collect.Source(1).ResultContent="body"
Memory.Collect.Source(1).EntryConcatMethod="JsonArray"

// Extract odata.id
Memory.Collect.Source(1).Compute(1).Type="Json2Csv"
Memory.Collect.Source(1).Compute(1).EntryKey="/"
Memory.Collect.Source(1).Compute(1).Properties="/@odata.id;_MEMORY_STATUS_PATH;_MEMORY_STATUS_PATH;"

Memory.Collect.Source(1).Compute(2).Type="Translate"
Memory.Collect.Source(1).Compute(2).Column=3
Memory.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

Memory.Collect.Source(1).Compute(3).Type="Translate"
Memory.Collect.Source(1).Compute(3).Column=4
Memory.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

Memory.Collect.ValueTable=%Memory.Collect.Source(1)%
Memory.Collect.DeviceID=ValueTable.Column(2)
Memory.Collect.Status=ValueTable.Column(3)
Memory.Collect.StatusInformation=ValueTable.Column(4)



//
// DiskController
//

// Discovery

// DiskController Instance Table
// JSONID;ChassisID;ControllerID;LogicalDiskURL;PhysicalDiskURL;Name;Model;SerialNumber;FirmwareVersion;
DiskController.Discovery.InstanceTable=%Enclosure.Discovery.Source(5)%
DiskController.Discovery.Instance.DeviceID=InstanceTable.Column(3)
DiskController.Discovery.Instance.DisplayID=InstanceTable.Column(6)
DiskController.Discovery.Instance.Model=InstanceTable.Column(7)
DiskController.Discovery.Instance.SerialNumber=InstanceTable.Column(8)
DiskController.Discovery.Instance.FirmwareVersion=InstanceTable.Column(9)

DiskController.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)

// Collect

DiskController.Collect.Type="MultiInstance"

DiskController.Collect.Source(1).Type="HTTP"
DiskController.Collect.Source(1).Method="GET"
DiskController.Collect.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(4)%
DiskController.Collect.Source(1).Url="%Entry.Column(3)%"
DiskController.Collect.Source(1).Header=EmbeddedFile(1)
DiskController.Collect.Source(1).ResultContent="body"
DiskController.Collect.Source(1).EntryConcatMethod="JSONArray"

// Extract data
// JSONID;id;Health;Health;
DiskController.Collect.Source(1).Compute(1).Type="Json2Csv"
DiskController.Collect.Source(1).Compute(1).EntryKey="/"
DiskController.Collect.Source(1).Compute(1).Properties="/@odata.id;/Status/Health;/Status/Health;"

DiskController.Collect.Source(1).Compute(2).Type="Translate"
DiskController.Collect.Source(1).Compute(2).Column=3
DiskController.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

DiskController.Collect.Source(1).Compute(3).Type="Translate"
DiskController.Collect.Source(1).Compute(3).Column=4
DiskController.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// DiskController Value Table
// JsonID;Id;PatrolStatus;StatusInformation;
DiskController.Collect.ValueTable=%DiskController.Collect.Source(1)%
DiskController.Collect.DeviceID=ValueTable.Column(2)
DiskController.Collect.ControllerStatus=ValueTable.Column(3)
DiskController.Collect.StatusInformation=ValueTable.Column(4)



//
// PhysicalDisk
//

// Discovery

// Query /Systems/?/SmartStorage/ArrayControllers/?/PhysicalDrives
PhysicalDisk.Discovery.Source(1).Type="HTTP"
PhysicalDisk.Discovery.Source(1).Method="GET"
PhysicalDisk.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(5)%
PhysicalDisk.Discovery.Source(1).Url="%Entry.Column(5)%"
PhysicalDisk.Discovery.Source(1).Header=EmbeddedFile(1)
PhysicalDisk.Discovery.Source(1).ResultContent="body"
PhysicalDisk.Discovery.Source(1).EntryConcatMethod="JSONArrayExtended"

// Extract data
// JSONID;ControllerID;odata.id
PhysicalDisk.Discovery.Source(1).Compute(1).Type="Json2Csv"
PhysicalDisk.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Members"
PhysicalDisk.Discovery.Source(1).Compute(1).Properties="../../Column(3);/@odata.id;"

//remove empty URLs to avoid empty redirection
PhysicalDisk.Discovery.Source(1).Compute(2).Type="KeepOnlyMatchingLines"
PhysicalDisk.Discovery.Source(1).Compute(2).Column=3
PhysicalDisk.Discovery.Source(1).Compute(2).RegExp="."

// Query /Systems/?/SmartStorage/ArrayControllers/?/DiskDrives/?
PhysicalDisk.Discovery.Source(2).Type="HTTP"
PhysicalDisk.Discovery.Source(2).Method="GET"
PhysicalDisk.Discovery.Source(2).ExecuteForEachEntryOf=%PhysicalDisk.Discovery.Source(1)%
PhysicalDisk.Discovery.Source(2).Url="%Entry.Column(3)%"
PhysicalDisk.Discovery.Source(2).Header=EmbeddedFile(1)
PhysicalDisk.Discovery.Source(2).ResultContent="body"
PhysicalDisk.Discovery.Source(2).EntryConcatMethod="JSONArrayExtended"

// Extract data
// JSONID;Controller;DiskID;Name;Model;SerialNumber;FirmwareVersion;MediaType;CapacityMiB;
PhysicalDisk.Discovery.Source(2).Compute(1).Type="Json2Csv"
PhysicalDisk.Discovery.Source(2).Compute(1).EntryKey="/Entry/Value"
PhysicalDisk.Discovery.Source(2).Compute(1).Properties="../Column(2);/@odata.id;/Name;/Model;/SerialNumber;/FirmwareVersion/Current/VersionString;/MediaType;/CapacityMiB;/Id;"
PhysicalDisk.Discovery.Source(2).Compute(1).Separator=";"

// Add label for DiskType
PhysicalDisk.Discovery.Source(2).Compute(2).Type="LeftConcat"
PhysicalDisk.Discovery.Source(2).Compute(2).Column=8
PhysicalDisk.Discovery.Source(2).Compute(2).String="Disk Type: "

// Convert from MiB to Bytes
PhysicalDisk.Discovery.Source(2).Compute(3).Type="Multiply"
PhysicalDisk.Discovery.Source(2).Compute(3).Column=9
PhysicalDisk.Discovery.Source(2).Compute(3).MultiplyBy=1048576

// PhysicalDisk Name fix.
PhysicalDisk.Discovery.Source(2).Compute(4).Type="RightConcat"
PhysicalDisk.Discovery.Source(2).Compute(4).Column=4
PhysicalDisk.Discovery.Source(2).Compute(4).String=" "

PhysicalDisk.Discovery.Source(2).Compute(5).Type="RightConcat"
PhysicalDisk.Discovery.Source(2).Compute(5).Column=4
PhysicalDisk.Discovery.Source(2).Compute(5).String=Column(10)

// PhysicalDisk Instance Table
// JSONID;Controller;DiskID;Name;Model;SerialNumber;FirmwareVersion;MediaType;CapacityMiB;
PhysicalDisk.Discovery.InstanceTable=%PhysicalDisk.Discovery.Source(2)%
PhysicalDisk.Discovery.Instance.DeviceID=InstanceTable.Column(3)
PhysicalDisk.Discovery.Instance.DisplayID=InstanceTable.Column(4)
PhysicalDisk.Discovery.Instance.Model=InstanceTable.Column(5)
PhysicalDisk.Discovery.Instance.SerialNumber=InstanceTable.Column(6)
PhysicalDisk.Discovery.Instance.FirmwareVersion=InstanceTable.Column(7)
PhysicalDisk.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(8)
PhysicalDisk.Discovery.Instance.Size=InstanceTable.Column(9)

PhysicalDisk.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)
PhysicalDisk.Discovery.Instance.AttachedToDeviceType="DiskController"

// Collect

PhysicalDisk.Collect.Type="MultiInstance"

// Query /Systems/?/SmartStorage/ArrayControllers/?/DiskDrives
PhysicalDisk.Collect.Source(1).Type="HTTP"
PhysicalDisk.Collect.Source(1).Method="GET"
PhysicalDisk.Collect.Source(1).ExecuteForEachEntryOf=%PhysicalDisk.Discovery.Source(1)%
PhysicalDisk.Collect.Source(1).Url="%Entry.Column(3)%"
PhysicalDisk.Collect.Source(1).Header=EmbeddedFile(1)
PhysicalDisk.Collect.Source(1).ResultContent="body"
PhysicalDisk.Collect.Source(1).EntryConcatMethod="JSONArray"

// Extract data
// JSONID;DiskID;Health;Health;SSDEnduranceUtilizationPercentage
PhysicalDisk.Collect.Source(1).Compute(1).Type="Json2Csv"
PhysicalDisk.Collect.Source(1).Compute(1).EntryKey="/"
PhysicalDisk.Collect.Source(1).Compute(1).Properties="/@odata.id;/Status/Health;/Status/Health;/SSDEnduranceUtilizationPercentage;"

PhysicalDisk.Collect.Source(1).Compute(2).Type="Translate"
PhysicalDisk.Collect.Source(1).Compute(2).Column=3
PhysicalDisk.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

PhysicalDisk.Collect.Source(1).Compute(3).Type="Translate"
PhysicalDisk.Collect.Source(1).Compute(3).Column=4
PhysicalDisk.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// Parameter is Endurance remaining, but it is expressed as endurance used.
// The following computes transform the value.

// JSONID;DiskID;Health;Health;SSDEnduranceUtilizationPercentage;100
PhysicalDisk.Collect.Source(1).Compute(4).Type="RightConcat"
PhysicalDisk.Collect.Source(1).Compute(4).Column=5
PhysicalDisk.Collect.Source(1).Compute(4).String=";100"

// JSONID;DiskID;Health;Health;SSDEnduranceUtilizationPercentage;EnduranceRemaining
PhysicalDisk.Collect.Source(1).Compute(5).Type="Substract"
PhysicalDisk.Collect.Source(1).Compute(5).Column=6
PhysicalDisk.Collect.Source(1).Compute(5).Substract=Column(5)

// PhysicalDisk Value Table
// JsonID;Name;PatrolStatus;StatusInformation;
PhysicalDisk.Collect.ValueTable=%PhysicalDisk.Collect.Source(1)%
PhysicalDisk.Collect.DeviceID=ValueTable.Column(2)
PhysicalDisk.Collect.Status=ValueTable.Column(3)
PhysicalDisk.Collect.StatusInformation=ValueTable.Column(4)
PhysicalDisk.Collect.EnduranceRemaining=ValueTable.Column(6)

//
// LogicalDisk
//

// Discovery

// Query /Systems/?/SmartStorage/ArrayControllers/?/LogicalDrives
LogicalDisk.Discovery.Source(1).Type="HTTP"
LogicalDisk.Discovery.Source(1).Method="GET"
LogicalDisk.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(5)%
LogicalDisk.Discovery.Source(1).Url="%Entry.Column(4)%"
LogicalDisk.Discovery.Source(1).Header=EmbeddedFile(1)
LogicalDisk.Discovery.Source(1).ResultContent="body"
LogicalDisk.Discovery.Source(1).EntryConcatMethod="JSONArrayExtended"

// Extract data
// JSONID;ControllerID;odata.id
LogicalDisk.Discovery.Source(1).Compute(1).Type="Json2Csv"
LogicalDisk.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Members"
LogicalDisk.Discovery.Source(1).Compute(1).Properties="../../Column(3);/@odata.id;"

//remove empty URLs to avoid empty redirection
LogicalDisk.Discovery.Source(1).Compute(2).Type="KeepOnlyMatchingLines"
LogicalDisk.Discovery.Source(1).Compute(2).Column=3
LogicalDisk.Discovery.Source(1).Compute(2).RegExp="."

// Query /Systems/?/SmartStorage/ArrayControllers/?/DiskDrives/?
LogicalDisk.Discovery.Source(2).Type="HTTP"
LogicalDisk.Discovery.Source(2).Method="GET"
LogicalDisk.Discovery.Source(2).ExecuteForEachEntryOf=%LogicalDisk.Discovery.Source(1)%
LogicalDisk.Discovery.Source(2).Url="%Entry.Column(3)%"
LogicalDisk.Discovery.Source(2).Header=EmbeddedFile(1)
LogicalDisk.Discovery.Source(2).ResultContent="body"
LogicalDisk.Discovery.Source(2).EntryConcatMethod="JSONArrayExtended"

// Extract data
// JSONID;Controller;Name;Model;SerialNumber;FirmwareVersion;MediaType;
LogicalDisk.Discovery.Source(2).Compute(1).Type="Json2Csv"
LogicalDisk.Discovery.Source(2).Compute(1).EntryKey="/Entry/Value"
LogicalDisk.Discovery.Source(2).Compute(1).Properties="../Column(2);/@odata.id;/Name;/Raid;/CapacityMiB;"

LogicalDisk.Discovery.Source(2).Compute(2).Type="Multiply"
LogicalDisk.Discovery.Source(2).Compute(2).Column=6
LogicalDisk.Discovery.Source(2).Compute(2).MultiplyBy=1048576

// LogicalDisk Instance Table
// JSONID;Controller;Name;RaidLevel;CapacityMiB;
LogicalDisk.Discovery.InstanceTable=%LogicalDisk.Discovery.Source(2)%
LogicalDisk.Discovery.Instance.DeviceID=InstanceTable.Column(3)
LogicalDisk.Discovery.Instance.DisplayID=InstanceTable.Column(4)
LogicalDisk.Discovery.Instance.RaidLevel=InstanceTable.Column(5)
LogicalDisk.Discovery.Instance.Size=InstanceTable.Column(6)

LogicalDisk.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)
LogicalDisk.Discovery.Instance.AttachedToDeviceType="DiskController"

// Collect

LogicalDisk.Collect.Type="MultiInstance"

// Query /Systems/?/SmartStorage/ArrayControllers/?/DiskDrives/?
LogicalDisk.Collect.Source(1).Type="HTTP"
LogicalDisk.Collect.Source(1).Method="GET"
LogicalDisk.Collect.Source(1).ExecuteForEachEntryOf=%LogicalDisk.Discovery.Source(1)%
LogicalDisk.Collect.Source(1).Url="%Entry.Column(3)%"
LogicalDisk.Collect.Source(1).Header=EmbeddedFile(1)
LogicalDisk.Collect.Source(1).ResultContent="body"
LogicalDisk.Collect.Source(1).EntryConcatMethod="JSONArray"

// Extract data
// JSONID;Controller;Name;Model;SerialNumber;FirmwareVersion;MediaType;
LogicalDisk.Collect.Source(1).Compute(1).Type="Json2Csv"
LogicalDisk.Collect.Source(1).Compute(1).EntryKey="/"
LogicalDisk.Collect.Source(1).Compute(1).Properties="/@odata.id;/Status/Health;/Status/Health;"

LogicalDisk.Collect.Source(1).Compute(2).Type="Translate"
LogicalDisk.Collect.Source(1).Compute(2).Column=3
LogicalDisk.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

LogicalDisk.Collect.Source(1).Compute(3).Type="Translate"
LogicalDisk.Collect.Source(1).Compute(3).Column=4
LogicalDisk.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// LogicalDisk Value Table
// JsonID;Name;PatrolStatus;StatusInformation;
LogicalDisk.Collect.ValueTable=%LogicalDisk.Collect.Source(1)%
LogicalDisk.Collect.DeviceID=ValueTable.Column(2)
LogicalDisk.Collect.Status=ValueTable.Column(3)
LogicalDisk.Collect.StatusInformation=ValueTable.Column(4)


//
// CPU
//

// Discovery

// Query each instance of Systems/?/Processors
CPU.Discovery.Source(1).Type="HTTP"
CPU.Discovery.Source(1).Method="GET"
CPU.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
CPU.Discovery.Source(1).Url="%Entry.Column(3)%Processors/"
CPU.Discovery.Source(1).Header=EmbeddedFile(1)
CPU.Discovery.Source(1).ResultContent="body"
CPU.Discovery.Source(1).EntryConcatMethod="JSONArrayExtended"

// Extract odata.id
// JSONID;ChassisID;ProcessorURL
CPU.Discovery.Source(1).Compute(1).Type="Json2Csv"
CPU.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Members"
CPU.Discovery.Source(1).Compute(1).Properties="../../Column(2);/@odata.id;"

//remove empty URLs to avoid empty redirection
CPU.Discovery.Source(1).Compute(2).Type="KeepOnlyMatchingLines"
CPU.Discovery.Source(1).Compute(2).Column=3
CPU.Discovery.Source(1).Compute(2).RegExp="."

// Query each odata.id
CPU.Discovery.Source(2).Type="HTTP"
CPU.Discovery.Source(2).Method="GET"
CPU.Discovery.Source(2).ExecuteForEachEntryOf=%CPU.Discovery.Source(1)%
CPU.Discovery.Source(2).Url="%Entry.Column(3)%"
CPU.Discovery.Source(2).Header=EmbeddedFile(1)
CPU.Discovery.Source(2).ResultContent="body"
CPU.Discovery.Source(2).EntryConcatMethod="JSONArrayExtended"

// Extract data
// ChassisID, Id, Manufacturer, Model, Name, MaxSpeedMHz
CPU.Discovery.Source(2).Compute(1).Type="Json2Csv"
CPU.Discovery.Source(2).Compute(1).EntryKey="/Entry/Value"
CPU.Discovery.Source(2).Compute(1).Properties="../Column(2);/@odata.id;/Manufacturer;/Model;/Name;/MaxSpeedMHz;"

// CPU Instance Table
// JsonID;<System>;Manufacturer;Model;Name;CurrentClockSpeedMhz;
CPU.Discovery.InstanceTable=%CPU.Discovery.Source(2)%
CPU.Discovery.Instance.DeviceID=InstanceTable.Column(3)
CPU.Discovery.Instance.Vendor=InstanceTable.Column(4)
CPU.Discovery.Instance.Model=InstanceTable.Column(5)
CPU.Discovery.Instance.DisplayID=InstanceTable.Column(6)
CPU.Discovery.Instance.MaximumSpeed=InstanceTable.Column(7)

CPU.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)
CPU.Discovery.Instance.AttachedToDeviceType="Enclosure"

// Collect

CPU.Collect.Type="MultiInstance"

// Query Systems/?/Processors
CPU.Collect.Source(1).Type="HTTP"
CPU.Collect.Source(1).Method="GET"
CPU.Collect.Source(1).ExecuteForEachEntryOf=%CPU.Discovery.Source(1)%
CPU.Collect.Source(1).Url="%Entry.Column(3)%"
CPU.Collect.Source(1).Header=EmbeddedFile(1)
CPU.Collect.Source(1).ResultContent="body"
CPU.Collect.Source(1).EntryConcatMethod="JsonArray"

// Extract data
// Id, StatusHealth
CPU.Collect.Source(1).Compute(1).Type="Json2Csv"
CPU.Collect.Source(1).Compute(1).EntryKey="/"
CPU.Collect.Source(1).Compute(1).Properties="/@odata.id;/Status/Health;/Status/Health;"
CPU.Collect.Source(1).Compute(1).Separator=";"

CPU.Collect.Source(1).Compute(2).Type="Translate"
CPU.Collect.Source(1).Compute(2).Column=3
CPU.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

CPU.Collect.Source(1).Compute(3).Type="Translate"
CPU.Collect.Source(1).Compute(3).Column=4
CPU.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// CPU collect value table
// JsonId;Id;PatrolStatus;StatusInformation;
CPU.Collect.ValueTable=%CPU.Collect.Source(1)%
CPU.Collect.DeviceID=ValueTable.Column(2)
CPU.Collect.Status=ValueTable.Column(3)
CPU.Collect.StatusInformation=ValueTable.Column(4)


//
// FANS
//

// Discovery

Fan.Discovery.Source(1)=%Enclosure.Discovery.Source(6)%

// Extract data
// JSONID;ChassisID;MemberId;Name;Location;State;
Fan.Discovery.Source(1).Compute(1).Type="Json2Csv"
Fan.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Fans"
Fan.Discovery.Source(1).Compute(1).Properties="../../Column(2);/_FAN_ID;/_FAN_LOCATION;/Status/State;"

Fan.Discovery.Source(1).Compute(2).Type="ExcludeMatchingLines"
Fan.Discovery.Source(1).Compute(2).Column=5
Fan.Discovery.Source(1).Compute(2).RegExp="Absent"

// Add Location label
Fan.Discovery.Source(1).Compute(3).Type="LeftConcat"
Fan.Discovery.Source(1).Compute(3).Column=4
Fan.Discovery.Source(1).Compute(3).String="Location: "

// Fan Instance Table
// JsonID;ChassisID;FanName;Location;
Fan.Discovery.InstanceTable=%Fan.Discovery.Source(1)%
Fan.Discovery.Instance.DeviceID=InstanceTable.Column(3)
Fan.Discovery.Instance.DisplayID=InstanceTable.Column(3)
Fan.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(4)

Fan.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)


// Collect

Fan.Collect.Type="MultiInstance"

Fan.Collect.Source(1)=%Enclosure.Collect.Source(5)%

// Extract data
// JSONID;MemberId;Health;Health;
Fan.Collect.Source(1).Compute(1).Type="Json2Csv"
Fan.Collect.Source(1).Compute(1).EntryKey="/Fans"
Fan.Collect.Source(1).Compute(1).Properties="/_FAN_ID;/Status/Health;/Status/Health;"
Fan.Collect.Source(1).Compute(1).Separator=";"

Fan.Collect.Source(1).Compute(2).Type="Translate"
Fan.Collect.Source(1).Compute(2).Column=3
Fan.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

Fan.Collect.Source(1).Compute(3).Type="Translate"
Fan.Collect.Source(1).Compute(3).Column=4
Fan.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// Fan Value Table
// JsonID;PatrolStatus;StatusInformation
Fan.Collect.ValueTable=%Fan.Collect.Source(1)%
Fan.Collect.DeviceID=ValueTable.Column(2)
Fan.Collect.Status=ValueTable.Column(3)
Fan.Collect.StatusInformation=ValueTable.Column(4)


//
// Temperatures
//

// Discovery

Temperature.Discovery.Source(1)=%Enclosure.Discovery.Source(6)%

// Extract data
// JSONID;ChassisID;MemberId;Name;Location;State;
Temperature.Discovery.Source(1).Compute(1).Type="Json2Csv"
Temperature.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/Temperatures"
Temperature.Discovery.Source(1).Compute(1).Properties="../../Column(2);/_TEMP_ID;/Name;/PhysicalContext;/Status/State;/UpperThresholdCritical;/UpperThresholdFatal;/UpperThresholdCritical;"

Temperature.Discovery.Source(1).Compute(2).Type="ExcludeMatchingLines"
Temperature.Discovery.Source(1).Compute(2).Column=6
Temperature.Discovery.Source(1).Compute(2).RegExp="Absent"

// Add Location label
Temperature.Discovery.Source(1).Compute(3).Type="LeftConcat"
Temperature.Discovery.Source(1).Compute(3).Column=5
Temperature.Discovery.Source(1).Compute(3).String="Location: "

// When threshold is 0, deactivate Temperature reading
Temperature.Discovery.Source(1).Compute(4).Type="Replace"
Temperature.Discovery.Source(1).Compute(4).Column=8
Temperature.Discovery.Source(1).Compute(4).Replace="0"
Temperature.Discovery.Source(1).Compute(4).ReplaceBy=""

// Temperature Instance Table
// JSONID;ChassisID;MemberId;Name;Location;State;
Temperature.Discovery.InstanceTable=%Temperature.Discovery.Source(1)%
Temperature.Discovery.Instance.DeviceID=InstanceTable.Column(3)
Temperature.Discovery.Instance.DisplayID=InstanceTable.Column(4)
Temperature.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
Temperature.Discovery.Instance.WarningThreshold=InstanceTable.Column(6)
Temperature.Discovery.Instance.AlarmThreshold=InstanceTable.Column(7)
Temperature.Discovery.Instance.ParameterActivation.Temperature=InstanceTable.Column(8)

Temperature.Discovery.Instance.AttachedToDeviceID=InstanceTable.Column(2)

// Collect

Temperature.Collect.Type="MultiInstance"

Temperature.Collect.Source(1)=%Enclosure.Collect.Source(5)%

// Extract data
// JSONID;MemberId;Health;Health;
Temperature.Collect.Source(1).Compute(1).Type="Json2Csv"
Temperature.Collect.Source(1).Compute(1).EntryKey="/Temperatures"
Temperature.Collect.Source(1).Compute(1).Properties="/_TEMP_ID;/Status/Health;/Status/Health;/ReadingCelsius;"
Temperature.Collect.Source(1).Compute(1).Separator=";"

Temperature.Collect.Source(1).Compute(2).Type="Translate"
Temperature.Collect.Source(1).Compute(2).Column=3
Temperature.Collect.Source(1).Compute(2).TranslationTable="StatusTranslationTable"

Temperature.Collect.Source(1).Compute(3).Type="Translate"
Temperature.Collect.Source(1).Compute(3).Column=4
Temperature.Collect.Source(1).Compute(3).TranslationTable="StatusInformationTranslationTable"

// Temperature Value Table
// JsonID;PatrolStatus;StatusInformation
Temperature.Collect.ValueTable=%Temperature.Collect.Source(1)%
Temperature.Collect.DeviceID=ValueTable.Column(2)
Temperature.Collect.Status=ValueTable.Column(3)
Temperature.Collect.StatusInformation=ValueTable.Column(4)
Temperature.Collect.Temperature=ValueTable.Column(5)



//
// PowerSupply
//

// Discovery

// Query /Chassis/?/Power/
PowerSupply.Discovery.Source(1).Type="HTTP"
PowerSupply.Discovery.Source(1).Method="GET"
PowerSupply.Discovery.Source(1).ExecuteForEachEntryOf=%Enclosure.Discovery.Source(3)%
PowerSupply.Discovery.Source(1).Url="%Entry.Column(8)%"
PowerSupply.Discovery.Source(1).Header=EmbeddedFile(1)
PowerSupply.Discovery.Source(1).ResultContent="body"
PowerSupply.Discovery.Source(1).EntryConcatMethod="JSONArrayExtended"

// Extract Data
// JSONID;ChassisID;Name;Model;SerialNumber;PowerSupplyType;PowerSupplyPower;Part Number;
PowerSupply.Discovery.Source(1).Compute(1).Type="Json2Csv"
PowerSupply.Discovery.Source(1).Compute(1).EntryKey="/Entry/Value/PowerSupplies"
PowerSupply.Discovery.Source(1).Compute(1).Properties="../../Column(2);/_PS_ID;/Name;/Model;/SerialNumber;/PowerSupplyType;/PowerCapacityWatts;/SparePartNumber;"
PowerSupply.Discovery.Source(1).Compute(1).Separator=";"

// Add Model label
PowerSupply.Discovery.Source(1).Compute(2).Type="LeftConcat"
PowerSupply.Discovery.Source(1).Compute(2).Column=5
PowerSupply.Discovery.Source(1).Compute(2).String="Model: "

// Add Part Number label
PowerSupply.Discovery.Source(1).Compute(3).Type="LeftConcat"
PowerSupply.Discovery.Source(1).Compute(3).Column=9
PowerSupply.Discovery.Source(1).Compute(3).String="Part Number: "

// Add Serial Number label
PowerSupply.Discovery.Source(1).Compute(4).Type="LeftConcat"
PowerSupply.Discovery.Source(1).Compute(4).Column=6
PowerSupply.Discovery.Source(1).Compute(4).String="Serial Number: "

// PowerSupply Instance Table
// JsonID;<System>;Name;SerialNumber;PowerCapacityWatts;InputType;"
PowerSupply.Discovery.InstanceTable=%PowerSupply.Discovery.Source(1)%
PowerSupply.Discovery.Instance.DeviceID=InstanceTable.Column(3)
PowerSupply.Discovery.Instance.DisplayID=InstanceTable.Column(4)
PowerSupply.Discovery.Instance.PowerSupplyType=InstanceTable.Column(7)
PowerSupply.Discovery.Instance.PowerSupplyPower=InstanceTable.Column(8)
PowerSupply.Discovery.Instance.AdditionalInformation1=InstanceTable.Column(5)
PowerSupply.Discovery.Instance.AdditionalInformation2=InstanceTable.Column(6)
PowerSupply.Discovery.Instance.AdditionalInformation3=InstanceTable.Column(9)


// Collect

PowerSupply.Collect.Type="MultiInstance"

PowerSupply.Collect.Source(1)=%Enclosure.Collect.Source(3)%

PowerSupply.Collect.Source(1).Compute(1).Type="Translate"
PowerSupply.Collect.Source(1).Compute(1).Column=5
PowerSupply.Collect.Source(1).Compute(1).TranslationTable="StatusTranslationTable"

PowerSupply.Collect.Source(1).Compute(2).Type="Translate"
PowerSupply.Collect.Source(1).Compute(2).Column=6
PowerSupply.Collect.Source(1).Compute(2).TranslationTable="StatusInformationTranslationTable"

// Power Supply Value Table
// JsonID;PatrolStatus;StatusInformation;
PowerSupply.Collect.ValueTable=%PowerSupply.Collect.Source(1)%
PowerSupply.Collect.DeviceID=ValueTable.Column(4)
PowerSupply.Collect.Status=ValueTable.Column(5)
PowerSupply.Collect.StatusInformation=ValueTable.Column(6)


//
// NetworkCard
//

NetworkCardStatusTranslationTable("OK")="OK"
NetworkCardStatusTranslationTable("null")="UNKNOWN"
NetworkCardStatusTranslationTable("Enabled")="OK"
NetworkCardStatusTranslationTable("StandbyOffline")="OK"
NetworkCardStatusTranslationTable("Offline")="OK"
NetworkCardStatusTranslationTable("none")="OK"
NetworkCardStatusTranslationTable("up")="OK"
NetworkCardStatusTranslationTable("down")="OK"
NetworkCardStatusTranslationTable("failed")="ALARM"
NetworkCardStatusTranslationTable("Critical")="ALARM"
NetworkCardStatusTranslationTable(Default)="UNKNOWN"

LinkStatusTranslationTable("Enabled")="OK"
LinkStatusTranslationTable("Offline")="WARN"
LinkStatusTranslationTable("null")="WARN"
LinkStatusTranslationTable("")="WARN"
LinkStatusTranslationTable("Offline")="WARN"
LinkStatusTranslationTable("LinkUp")="OK"
LinkStatusTranslationTable("StandbyOffline")="WARN"
LinkStatusTranslationTable("none")="WARN"
LinkStatusTranslationTable("up")="OK"
LinkStatusTranslationTable("Up")="OK"
LinkStatusTranslationTable("down")="WARN"
LinkStatusTranslationTable("failed")="ALARM"
LinkStatusTranslationTable(Default)="UNKNOWN"

NetworkCardStatusInformationTranslationTable("Enabled")="Enabled"
NetworkCardStatusInformationTranslationTable("StandbyOffline")="StandbyOffline"
NetworkCardStatusInformationTranslationTable("Offline")="Offline"
NetworkCardStatusInformationTranslationTable("none")="None"
NetworkCardStatusInformationTranslationTable("null")="None"
NetworkCardStatusInformationTranslationTable("OK")="OK"
NetworkCardStatusInformationTranslationTable("up")="Up"
NetworkCardStatusInformationTranslationTable("down")="Administratively Down"
NetworkCardStatusInformationTranslationTable("failed")="Failed"
NetworkCardStatusInformationTranslationTable("Critical")="Failed"
NetworkCardStatusInformationTranslationTable(Default)="Unknown Status"


// Status Translation Table for all classes
StatusTranslationTable("OK")="OK"
StatusTranslationTable("GoodInUse")="OK"
StatusTranslationTable("optimal")="OK"
StatusTranslationTable("null")="UNKNOWN"
StatusTranslationTable("Warning")="WARN"
StatusTranslationTable("Critical")="ALARM"
StatusTranslationTable("maintenanceCharging")="OK"
StatusTranslationTable("needsAttn")="WARN"
StatusTranslationTable("Degraded")="WARN"
StatusTranslationTable("Error")="ALARM"
StatusTranslationTable("Unknown")="WARN"
StatusTranslationTable(Default)="UNKNOWN"

StatusInformationTranslationTable("OK")="The device is running normal."
StatusInformationTranslationTable("GoodInUse")="The device is running normal."
StatusInformationTranslationTable("optimal")="The device is running normal."
StatusInformationTranslationTable("Good")="The device is running normal."
StatusInformationTranslationTable("null")="The device is not reporting a status."
StatusInformationTranslationTable("Warning")="The device is in a warning state."
StatusInformationTranslationTable("Critical")="The device is in critical state."
StatusInformationTranslationTable("maintenanceCharging")="The device is performing routine maintenance."
StatusInformationTranslationTable("needsAttn")="The device needs attention."
StatusInformationTranslationTable("Degraded")="The device needs attention."
StatusInformationTranslationTable("Error")="The device is in a critical state."
StatusInformationTranslationTable("Unknown")="The device is not reporting a status."
StatusInformationTranslationTable(Default)="The device is not reporting a status"


/////////////////////////////////////////////////////////
///
///    E M B E D D E D   F I L E ! ! !
///
///    EmbeddedFile(1) = Headers
/////////////////////////////////////////////////////////
EmbeddedFile(1):
authorization: Basic %{BASIC_AUTH_BASE64}
Accept:application/json
EmbeddedFile(1).End
/////////////////////////////////////////////////////////
