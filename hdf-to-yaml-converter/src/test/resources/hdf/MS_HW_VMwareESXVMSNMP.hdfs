//
//
//    H a r d w a r e   D e f i n i t i o n   F i l e
//
//                       f o r
//
//                 Hardware Sentry
//
//                 by Sentry Software (c)
//
//                MS_HW_VMwareESXVMSNMP.hdf
//
//      Supports: Any Server running a VMware ESX 4i
//
//
//

// HEADER

hdf.DisplayName="VMware ESXi - Virtual Machines (SNMP)"
hdf.TypicalPlatform="VMware ESXi"
hdf.ReliesOn="SNMP"
hdf.Comments="This connector provides Virtual Machine monitoring (Power consumption and State) through VMWare SNMP agent."
hdf.RemoteSupport="true"
hdf.LocalSupport="false"
hdf.AppliesToOS="OOB,Linux"


// Hardware Sentry v11.3.00+
Detection.Criteria(1).Type="KMVersion"
Detection.Criteria(1).Version="11.3.00"

// Checking if we have VM
Detection.Criteria(2).Type="SNMP"
Detection.Criteria(2).SnmpGetNext="1.3.6.1.4.1.6876.2.1.1"


//discover the VM
// ID, DisplayName,Powershare
VM.Discovery.Source(1).Type="SnmpTable"
VM.Discovery.Source(1).SnmpTableOid="1.3.6.1.4.1.6876.2.1.1"
VM.Discovery.Source(1).SnmpTableSelectColumns="ID,2,9"



// The Instance table
VM.Discovery.InstanceTable=%VM.Discovery.Source(1)%
VM.Discovery.Instance.DeviceID=InstanceTable.Column(1)
VM.Discovery.Instance.DisplayID=InstanceTable.Column(2)
VM.Discovery.Instance.ParameterActivation.PowerConsumption=InstanceTable.Column(3)
VM.Discovery.Instance.AttachedToDeviceType="Enclosure"


// Collect type is: multi-instance
VM.Collect.Type="MultiInstance"

// ID, Vcpu (for powershare),Power state
VM.Collect.Source(1).Type="SnmpTable"
VM.Collect.Source(1).SnmpTableOid="1.3.6.1.4.1.6876.2.1.1"
VM.Collect.Source(1).SnmpTableSelectColumns="ID,9,6"

//remove the powered  word from the power state so we can have on off suspended without mapping table
/// ID, Vcpu (for powershare),Power state
VM.Collect.Source(1).Compute(1).Type="Translate"
VM.Collect.Source(1).Compute(1).Column=3
VM.Collect.Source(1).Compute(1).TranslationTable="PowerStateTranslationTable"

// GenericStatusTranslationTable
PowerStateTranslationTable("powered on")="ON"
PowerStateTranslationTable("powered off")="OFF"
PowerStateTranslationTable("suspended")="SUSPENDED"


/// ID, Vcpu (for powershare),Power state
VM.Collect.ValueTable=%VM.Collect.Source(1)%
VM.Collect.DeviceID=ValueTable.Column(1)
VM.Collect.Powershare=ValueTable.Column(2)
VM.Collect.PowerState=ValueTable.Column(3)
